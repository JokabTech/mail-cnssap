import{a as z,b as H}from"./chunk-OYAAD6H2.js";import{a as U}from"./chunk-NS5OZLHL.js";import{a as L}from"./chunk-XHZ33VBC.js";import{R as k,V as F,_ as j,aa as O,ha as B,ia as P,la as Q}from"./chunk-4LHVJXPR.js";import{w as A,y as $}from"./chunk-SMWCLUEH.js";import{$a as c,Ab as v,Bb as C,Cb as b,Db as y,Fb as l,Gb as a,Hb as M,Mb as V,Qb as S,S as g,Sb as s,Wa as m,Wb as w,Xb as E,Yb as D,ec as f,f as h,fc as T,ga as u,gb as _,ha as p,ic as I,jc as R,kc as N,zb as x}from"./chunk-JOOEKZTP.js";import"./chunk-2VMXMS7J.js";var q=["inputs"];function J(i,t){if(i&1){let e=V();l(0,"input",9,0),N("ngModelChange",function(n){let r=u(e).$index,d=s();return R(d.codeDigits[r],n)||(d.codeDigits[r]=n),p(n)}),S("input",function(n){let r=u(e).$index,d=s();return p(d.moveToNext(r,n))})("paste",function(n){u(e);let r=s();return p(r.pasteCode(n))}),a()}if(i&2){let e=t.$index,o=s();I("ngModel",o.codeDigits[e])}}function G(i,t){i&1&&M(0,"mat-progress-bar",8)}function K(i,t){if(i&1&&(l(0,"p",10),f(1),a()),i&2){let e=s(2);m(),T(e.errorMessage)}}function X(i,t){if(i&1&&x(0,K,2,1,"p",10),i&2){let e=s();v(e.errorMessage?0:-1)}}var W=class i{constructor(t,e,o,n){this.http=t;this.router=e;this.message=o;this.route=n}codeDigits=new Array(5).fill(null);errorMessage="";inputs;unsubscribe$=new h;loader=!1;ngOnInit(){this.route.paramMap.pipe(g(this.unsubscribe$)).subscribe(t=>{let e=t.get("code");e&&/^\d{5}$/.test(e)?(this.codeDigits=e.split("").map(Number),this.errorMessage="",this.validateToken()):e&&(this.errorMessage="Code invalide dans l'URL. Le code doit \xEAtre compos\xE9 de 5 chiffres.")})}moveToNext(t,e){e.target.value.length===1&&t<this.codeDigits.length-1&&this.inputs.toArray()[t+1].nativeElement.focus(),this.codeDigits.every(r=>r!=null)&&this.validateToken()}validateToken(){this.loader=!0;let t=Number(this.codeDigits.join(""));this.http.url="auth/verification",this.unsubscribe$.next(),this.http.login({token:t}).pipe(g(this.unsubscribe$)).subscribe({next:e=>{sessionStorage.setItem("authentication",JSON.stringify(e))},error:e=>{this.loader=!1,e.status===0?this.message.openSnackBar("Aucune connexion internet. veillez r\xE9essayer plus tard","Fermer",6e3):this.errorMessage=e.error.message},complete:()=>{this.loader=!1,this.message.openSnackBar("Votre compte vient d'\xEAtre activer avec succ\xE8s","Fermer",6e3),this.router.navigateByUrl("/dashboard")}}),console.log(t)}pasteCode(t){t.preventDefault();let e=t.clipboardData?.getData("text")||"";/^\d{5}$/.test(e)?(this.codeDigits=e.split("").map(Number),this.errorMessage="",this.inputs.length===6&&this.inputs.last.nativeElement.focus(),this.validateToken()):this.errorMessage="Code invalide. Copiez un code \xE0 6 chiffres."}static \u0275fac=function(e){return new(e||i)(c(L),c($),c(U),c(A))};static \u0275cmp=_({type:i,selectors:[["app-validation-component"]],viewQuery:function(e,o){if(e&1&&w(q,5),e&2){let n;E(n=D())&&(o.inputs=n)}},decls:12,vars:1,consts:[["inputs",""],[1,"bg-gray-100","h-full","lg:h-auto"],[1,"container","mx-auto","py-10","xl:py-14","xl:px-32"],[1,"lg:bg-white","lg:rounded-md","lg:border","lg:border-gray-300","w-full","min-h-96","p-5","flex","flex-col","items-center","justify-center","lg:mt-5"],[1,"font-medium","text-2xl","text-blue-950","text-center"],[1,"mt-3","lg:mt-2","text-center"],[1,"flex","justify-center","space-x-2","mb-4","mt-10"],["type","number","min","0","max","9",1,"w-14","h-14","border","border-gray-300","rounded-lg","text-center","text-xl","font-bold","focus:ring-2","focus:ring-blue-500","no-spinner",3,"ngModel"],["mode","indeterminate"],["type","number","min","0","max","9",1,"w-14","h-14","border","border-gray-300","rounded-lg","text-center","text-xl","font-bold","focus:ring-2","focus:ring-blue-500","no-spinner",3,"ngModelChange","input","paste","ngModel"],[1,"text-red-500","text-lg"]],template:function(e,o){e&1&&(l(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1",4),f(4,"V\xC9RIFICATION DE VOTRE COMPTE COURRIERS CNSSAP"),a(),l(5,"p",5),f(6," Un code de validation \xE0 5 chiffres vous a \xE9t\xE9 envoy\xE9 par e-mail. Veuillez l'entrer ci-dessous pour v\xE9rifier votre compte. "),a(),l(7,"div",6),b(8,J,2,1,"input",7,C),a(),x(10,G,1,0,"mat-progress-bar",8)(11,X,1,1),a()()()),e&2&&(m(8),y(o.codeDigits),m(2),v(o.loader?10:11))},dependencies:[Q,k,O,F,P,B,j,H,z],encapsulation:2})};export{W as ValidationComponent};
