import{a as je}from"./chunk-7GLP3X6H.js";import{a as qe}from"./chunk-6JCGAI3C.js";import"./chunk-2XMF3NCH.js";import{b as Fe,c as De,f as we,i as Oe,j as Te,k as Pe,o as ke,p as Ae,q as Ve,r as Re}from"./chunk-I2SFVS3Z.js";import{b as Ie}from"./chunk-YOSYX5R3.js";import{a as ye}from"./chunk-RA4HR7YG.js";import{B as xe,D as ve,F as be,G as Ee,I as Ce,K as Se,a as H,b as Q,g as ae,l as le,n as me,o as se,p as de,r as ue,s as ce,u as pe,v as fe,x as ge,y as _e,z as he}from"./chunk-LN33XJJG.js";import{a as Me}from"./chunk-2KDJOZPQ.js";import{$ as ie,M as X,O as K,P as W,R as Y,T as _,V as Z,W as ee,X as te,Z as b,ca as ne,da as re,ma as oe}from"./chunk-6K6YQ32S.js";import{D as J,e as B,l as z,r as I,z as G}from"./chunk-DDJAZSWD.js";import"./chunk-WRDENF74.js";import{Ab as c,Cb as D,Db as w,Eb as x,Fb as i,Gb as t,Hb as E,Mb as y,Qb as v,S,Sb as d,Wa as a,Wb as R,Xb as q,Yb as j,ac as N,ba as M,bc as U,ec as o,f as C,ga as p,gb as V,gc as g,ha as f,hc as O,mc as $,oc as L,u as A,zb as u}from"./chunk-D6M5U3FV.js";import"./chunk-MGTJOKXF.js";var Ue=["fileInput"],$e=n=>({"bg-gray-100 border-blue-500":n}),T=(n,r)=>r.id;function Le(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),g(" ",e.getErrorSubject()," ")}}function Be(n,r){if(n&1&&(i(0,"mat-option",20),o(1),t()),n&2){let e=r.$implicit;x("value",e.id),a(),g(" ",e.designation," ")}}function ze(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),g(" ",e.getErrorRequired("document_type_id")," ")}}function Ge(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),g(" ",e.getErrorRequired("mail_date")," ")}}function Je(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),g(" ",e.getErrorReference()," ")}}function He(n,r){if(n&1&&(i(0,"mat-option",26),o(1),t()),n&2){let e=r.$implicit;x("disabled",!e.department)("value",e.id),a(),O(" ",e.full_name," (",e.department?e.department.designation:"Aucune direction",") ")}}function Qe(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),g(" ",e.getErrorRequired("sender_id")," ")}}function Xe(n,r){if(n&1&&(i(0,"mat-option",20),o(1),t()),n&2){let e=r.$implicit;x("value",e.id),a(),O(" ",e.full_name," (",e.department?e.department.designation:"(Aucune Direction)",") ")}}function Ke(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),g(" ",e.getErrorRequired("recipient_id")," ")}}function We(n,r){if(n&1&&(i(0,"p",33),o(1),t()),n&2){let e=d(2);a(),g("Fichier : ",e.pdfService.localPdf.name," ")}}function Ye(n,r){if(n&1&&(i(0,"mat-error",34),o(1),t()),n&2){let e=d(2);a(),g(" ",e.errorMessage," ")}}function Ze(n,r){if(n&1&&(i(0,"div",35)(1,"div",39),E(2,"div",40),t(),i(3,"p",41),o(4),t()()),n&2){let e=d(2);a(2),U("width",e.uploadProgress,"%"),a(2),O("",e.uploadProgress," % - ",e.statusMessage)}}function et(n,r){if(n&1){let e=y();i(0,"button",42),v("click",function(){p(e);let l=d(2);return f(l.onDisplayOnlinePdf())}),i(1,"div",43)(2,"mat-icon",44),o(3,"remove_red_eye"),t(),i(4,"span"),o(5,"Aper\xE7u de l'ancien fichier"),t()()()}}function tt(n,r){if(n&1){let e=y();i(0,"button",42),v("click",function(){p(e);let l=d(2);return f(l.onDisplayLocalPdf())}),i(1,"div",43)(2,"mat-icon",44),o(3,"remove_red_eye"),t(),i(4,"span"),o(5,"Aper\xE7u du nouveau fichier"),t()()()}}function it(n,r){if(n&1){let e=y();i(0,"form",13),v("ngSubmit",function(){p(e);let l=d();return f(l.onSubmit())}),i(1,"div",14)(2,"h1",15),o(3,"Objet du courrier"),t(),i(4,"p"),o(5," Indiquez ici le sujet principal du courrier. Il s'agit de l'objet tel qu'il figure sur le courrier scann\xE9. Ce titre appara\xEEtra dans les listes et les recherches. "),t()(),i(6,"div",16)(7,"mat-form-field",17)(8,"mat-label"),o(9,"Objet du courrier"),t(),E(10,"input",18),u(11,Le,2,1,"mat-error"),t()(),i(12,"div",14)(13,"h1",15),o(14,"Type de document"),t(),i(15,"p"),o(16," Il s'agit du type de courrier que vous \xEAtes sur le point d'ajouter "),t()(),i(17,"div",16)(18,"mat-form-field",17)(19,"mat-label"),o(20,"Type de courrier"),t(),i(21,"mat-select",19),D(22,Be,2,2,"mat-option",20,T),t(),u(24,ze,2,1,"mat-error"),t()(),i(25,"div",14)(26,"h1",15),o(27,"Date et R\xE9f\xE9rence du courrier"),t(),i(28,"p"),o(29," Saisissez la date d\u2019\xE9mission du courrier ainsi que sa f\xE9r\xE9rence ici "),t()(),i(30,"div",21)(31,"mat-form-field",17)(32,"mat-label"),o(33,"Date du courrier"),t(),E(34,"input",22)(35,"mat-datepicker-toggle",23)(36,"mat-datepicker",null,1),u(38,Ge,2,1,"mat-error"),t()(),i(39,"div",21)(40,"mat-form-field",17)(41,"mat-label"),o(42,"R\xE9f\xE9rence du courrier"),t(),E(43,"input",24),u(44,Je,2,1,"mat-error"),t()(),i(45,"div",14)(46,"h1",15),o(47,"Exp\xE9diteur et Destinataire du courrier"),t(),i(48,"p"),o(49," S\xE9l\xE9ctionner le l'exp\xE9diteur et saissize le destinatair du courier "),t()(),i(50,"div",21)(51,"mat-form-field",17)(52,"mat-label"),o(53,"Exp\xE9diteur du courrier (Directeur)"),t(),i(54,"mat-select",25),D(55,He,2,4,"mat-option",26,T),t(),u(57,Qe,2,1,"mat-error"),t()(),i(58,"div",21)(59,"mat-form-field",17)(60,"mat-label"),o(61,"Destinaire du courrier (Agent)"),t(),i(62,"mat-select",27),D(63,Xe,2,3,"mat-option",20,T),t(),u(65,Ke,2,1,"mat-error"),t(),i(66,"div",28)(67,"a",29),v("click",function(){p(e);let l=d();return f(l.onSearchUser())}),o(68,"Afficher les filtres"),t()()(),i(69,"div",14)(70,"h1",15),o(71,"Courrier Scann\xE9"),t(),i(72,"p"),o(73," Il s'agit d'une lettre ou d\u2019un document papier qui a \xE9t\xE9 num\xE9ris\xE9 \xE0 l\u2019aide d\u2019un scanner, afin d\u2019\xEAtre conserv\xE9 ou envoy\xE9 sous format \xE9lectronique. Nous acceptons uniquement les fichiers au format PDF ou image (JPEG, PNG). "),t()(),i(74,"div",16)(75,"div",30),v("click",function(){p(e);let l=d();return f(l.triggerFileInput())})("dragover",function(l){p(e);let h=d();return f(h.onDragOver(l))})("dragleave",function(l){p(e);let h=d();return f(h.onDragLeave(l))})("drop",function(l){p(e);let h=d();return f(h.onDrop(l))}),i(76,"mat-icon",4),o(77,"attach_file"),t(),i(78,"p",31),o(79," D\xE9posez ici un fichier au format PDF ou image, ou "),i(80,"span",32),o(81," cliquez "),t(),o(82," pour le s\xE9lectionner. "),t(),u(83,We,2,1,"p",33),t(),u(84,Ye,2,1,"mat-error",34),t(),u(85,Ze,5,4,"div",35),i(86,"div",36),u(87,et,6,0,"button",37),u(88,tt,6,0,"button",37),i(89,"button",38),o(90),t()()()}if(n&2){let e,m,l,h,F,P,k=N(37),s=d();x("formGroup",s.form),a(11),c((e=s.form.get("subject"))!=null&&e.hasError?11:-1),a(11),w(s.documentTypes),a(2),c((m=s.form.get("document_type_id"))!=null&&m.hasError?24:-1),a(10),x("matDatepicker",k),a(),x("for",k),a(3),c((l=s.form.get("mail_date"))!=null&&l.hasError?38:-1),a(6),c((h=s.form.get("reference"))!=null&&h.hasError?44:-1),a(11),w(s.directors),a(2),c((F=s.form.get("sender_id"))!=null&&F.hasError?57:-1),a(6),w(s.recipients),a(2),c((P=s.form.get("recipient_id"))!=null&&P.hasError?65:-1),a(10),x("ngClass",L(16,$e,s.isDragging)),a(8),c(s.pdfService.localPdf?83:-1),a(),c(s.errorMessage!==""?84:-1),a(),c(s.uploadProgress>0?85:-1),a(2),c(s.formActionPayload&&s.formActionPayload.data&&s.formActionPayload.data.scanned_document?87:-1),a(),c(s.pdfService.localPdf?88:-1),a(2),g(" ",s.formActionPayload&&s.formActionPayload.action==="add"?"Enregister le courrier":"Modifier le courrier"," ")}}function nt(n,r){n&1&&(i(0,"div",11),E(1,"mat-spinner"),t())}var Ne=class n{form;pdfService=M(qe);http=M(Me);message=M(ye);router=M(G);isDragging=!1;supportedTypes=["application/pdf","image/png","image/jpeg"];errorMessage="";uploadProgress=0;statusMessage="";fileInput;unsubscribeDir$=new C;unsubscribeDoc$=new C;unsubscribeSender$=new C;unsubscribeMail$=new C;directors=[];recipients=[];documentTypes=[];isFormReady=!1;formActionPayload;mail;constructor(){this.formActionPayload=JSON.parse(sessionStorage.getItem("formActionPayload")),this.mail=this.formActionPayload.data}ngOnInit(){this.loadData()}ngOnDestroy(){sessionStorage.removeItem("incomingExternalMail"),this.pdfService.localPdf=null,this.pdfService.onLinePdf=null,this.unsubscribeDir$.next(),this.unsubscribeDir$.complete(),this.unsubscribeDoc$.next(),this.unsubscribeDoc$.complete(),this.unsubscribeSender$.next(),this.unsubscribeSender$.complete(),this.unsubscribeMail$.next(),this.unsubscribeMail$.complete()}initForm(){this.form=new te({subject:new b(this.mail?this.mail.subject:"",[_.required,_.minLength(5),_.maxLength(200)]),mail_date:new b(this.mail?this.mail.mail_date:"",[_.required]),reference:new b(this.mail?this.mail.reference:"",[_.required,_.minLength(3),_.maxLength(30)]),recipient_id:new b(this.mail&&this.mail.recipient?this.mail.recipient.id:"",[_.required]),sender_id:new b(this.mail&&this.mail.sender?this.mail.sender.id:"",[_.required]),document_type_id:new b(this.mail&&this.mail.documentType?this.mail.documentType.id:"",[_.required])})}getErrorSubject(){return this.form.get("subject").hasError("required")?"Ce champ est requis":this.form.get("subject").hasError("minlength")?"L'objet doit contenir au moins 5 caract\xE8res.":this.form.get("subject").hasError("maxlength")?"L'objet ne peut pas d\xE9passer 200 caract\xE8res.":""}getErrorReference(){return this.form.get("reference").hasError("required")?"Ce champ est requis":this.form.get("reference").hasError("minlength")?"L doit contenir au moins 3 caract\xE8res.":this.form.get("reference").hasError("maxlength")?"La r\xE9ference ne peut pas d\xE9passer 30 caract\xE8res.":""}getErrorRequired(r){return this.form.get(r).hasError("required")?"Ce champ est requis":""}triggerFileInput(){this.fileInput.nativeElement.value="",this.fileInput.nativeElement.click()}onDragOver(r){r.preventDefault(),this.isDragging=!0}onDragLeave(r){r.preventDefault(),this.isDragging=!1}onDrop(r){r.preventDefault(),this.isDragging=!1;let e=r.dataTransfer?.files;e&&this.pdfService.handleFile(e[0])}onFileSelected(r){let m=r.target.files;m&&this.pdfService.handleFile(m[0])}onDisplayLocalPdf(){this.pdfService.displayLocalPdf()}onDisplayOnlinePdf(){this.pdfService.displayOnlinePdf(this.formActionPayload.data.id,"document","outgoing-internal-mails")}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.message.openSnackBar("Veuillez corriger les erreurs du formulaire.","Fermer",4e3);return}this.formActionPayload.action==="add"?this.add():this.update()}add(){this.http.url="outgoing-internal-mails",this.http.sendFormData(JSON.stringify(this.form.value),this.pdfService.localPdf,"post").subscribe({next:r=>{r.type===I.UploadProgress?this.uploadProgress=Math.round(r.loaded/(r.total||1)*100):r.type===I.Response&&(this.message.openSnackBar("Enregistrement effectu\xE9 avec succ\xE8s !","Fermer",4e3),this.form.reset(),this.pdfService.localPdf=null)},error:r=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0},complete:()=>{this.router.navigateByUrl("/mails/outgoing/internal")}})}update(){this.http.url=`outgoing-internal-mails/${this.formActionPayload.data.id}`,this.http.sendFormData(JSON.stringify(this.form.value),this.pdfService.localPdf,"patch").subscribe({next:r=>{r.type===I.UploadProgress?this.uploadProgress=Math.round(r.loaded/(r.total||1)*100):r.type===I.Response&&this.message.openSnackBar("Modification effectu\xE9 avec succ\xE8s !","Fermer",4e3)},error:r=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0},complete:()=>{this.router.navigateByUrl("/mails/outgoing/internal")}})}onSearchUser(){}loadData(){let r={directors:this.getDirectors(),documentTypes:this.getDocumentTypes(),recipients:this.getSenders()};this.formActionPayload.action==="edit_mail"&&(r.mail=this.getMail()),A(r).subscribe({next:e=>{this.directors=e.directors,this.documentTypes=e.documentTypes,this.recipients=e.recipients,this.formActionPayload.action==="edit_mail"&&(this.mail=e.mail),this.initForm(),this.isFormReady=!0},error:e=>{this.message.openSnackBar("Une erreur est survenue lors du chargement des donn\xE9es. Veuillez r\xE9essayer.","Fermer",800)}})}getDirectors(){return this.http.url="users/by-role/DIRECTOR",this.http.get().pipe(S(this.unsubscribeDir$))}getDocumentTypes(){return this.http.url="document-types",this.http.get().pipe(S(this.unsubscribeDoc$))}getSenders(){return this.http.url="users/with-roles",this.http.get().pipe(S(this.unsubscribeSender$))}getMail(){return this.http.url=`outgoing-internal-mails/${this.formActionPayload.data.id}`,this.http.get().pipe(S(this.unsubscribeMail$))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-outgoing-internal-mail-form-component"]],viewQuery:function(e,m){if(e&1&&R(Ue,5),e&2){let l;q(l=j())&&(m.fileInput=l.first)}},features:[$([je()])],decls:20,vars:2,consts:[["fileInput",""],["picker1",""],[1,"flex","items-center","justify-between","md:h-14","md:px-4","md:bg-gray-50","border-b","border-b-gray-300","md:border-b-0"],["mat-icon-button",""],[1,"mat-18"],[1,"px-3","py-1","text-xs","md:text-sm","text-blue-600","bg-blue-100","rounded-full","dark:bg-gray-800","dark:text-blue-400"],["mat-icon-button","","matTooltip","Actualiser"],["mat-icon-button","","matTooltip","Imprimmer",3,"click","disabled"],[1,"w-full","md:px-16"],[1,"mt-7","text-lg","md:px-4","hidden","md:block"],[1,"w-full","flex","flex-wrap","mt-4",3,"formGroup"],[1,"flex","items-center","justify-center","my-10"],["type","file","accept",".jpg, .jpeg, .png, application/pdf",1,"hidden",3,"change"],[1,"w-full","flex","flex-wrap","mt-4",3,"ngSubmit","formGroup"],[1,"w-full","md:px-4","mb-4"],[1,"text-lg","font-bold"],[1,"w-full","md:px-4"],[1,"w-full"],["type","text","matInput","","formControlName","subject"],["matInput","","formControlName","document_type_id"],[3,"value"],[1,"w-full","md:w-6/12","md:px-4"],["matInput","","formControlName","mail_date",3,"matDatepicker"],["matIconSuffix","",3,"for"],["type","text","matInput","","formControlName","reference"],["matInput","","formControlName","sender_id"],[3,"disabled","value"],["matInput","","formControlName","recipient_id"],[1,"w-full","flex","justify-end","-mt-5"],["mat-button","",3,"click"],[1,"w-full","h-56","flex","flex-col","items-center","justify-center","border-2","border-dashed","border-gray-400","bg-[#e0e2ec]","rounded-lg","cursor-pointer","hover:border-blue-500","transition",3,"click","dragover","dragleave","drop","ngClass"],[1,"text-gray-600","text-lg","text-center","mt-2","px-1"],[1,"text-blue-500","font-bold"],[1,"text-lg","border-t-4","border-r-gray-100","mt-0.5"],[1,"mt-1.5"],[1,"w-full","md:px-4","mt-3.5"],[1,"w-full","md:px-4","mt-4","flex","flex-col-reverse","md:flex-row","justify-end","items-center","gap-2.5"],["type","button","mat-stroked-button","","color","primary",1,"w-full","sm:w-auto"],["matTooltip","Cliquez pour Enregister le courrier","mat-flat-button","",1,"w-full","sm:w-auto"],[1,"w-full","bg-gray-200","rounded-full","h-2.5"],[1,"bg-blue-600","h-2.5","rounded-full","transition-all","duration-300","ease-in-out"],[1,"text-center","text-sm","text-gray-500","mt-2"],["type","button","mat-stroked-button","","color","primary",1,"w-full","sm:w-auto",3,"click"],[1,"flex","items-center"],[1,"me-2"]],template:function(e,m){if(e&1){let l=y();i(0,"section",2)(1,"button",3)(2,"mat-icon",4),o(3,"arrow_back_ios"),t()(),i(4,"span",5),o(5," CNSSAP "),t(),i(6,"div")(7,"button",6)(8,"mat-icon"),o(9,"refresh"),t()(),i(10,"button",7),v("click",function(){return p(l),f(m.onDisplayLocalPdf())}),i(11,"mat-icon"),o(12,"remove_red_eye"),t()()()(),i(13,"div",8)(14,"h1",9),o(15,"FORMULAIRE D'AJOUT D'UN NOUVEAU COURRIER SORTANT EXTERNE"),t(),u(16,it,91,18,"form",10)(17,nt,2,0,"div",11),i(18,"input",12,0),v("change",function(F){return p(l),f(m.onFileSelected(F))}),t()()}e&2&&(a(10),x("disabled",!m.pdfService.localPdf),a(6),c(m.isFormReady?16:17))},dependencies:[Fe,De,we,Oe,Pe,Te,ce,ue,me,se,de,le,Ie,Re,ke,Ae,Ve,z,B,Q,H,W,K,X,J,oe,ie,Y,Z,ee,ne,re,ae,fe,pe,ge,he,_e,xe,Ee,be,ve,Ce,Se],encapsulation:2})};export{Ne as OutgoingInternalMailFormComponent};
