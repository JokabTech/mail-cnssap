import{a as Ae}from"./chunk-7GLP3X6H.js";import{a as Ve}from"./chunk-6JCGAI3C.js";import"./chunk-2XMF3NCH.js";import{b as ye,c as Fe,f as De,i as we,j as Oe,k as Pe,o as Ie,p as Te,q as ke,r as Re}from"./chunk-I2SFVS3Z.js";import{b as Se}from"./chunk-YOSYX5R3.js";import{a as Me}from"./chunk-RA4HR7YG.js";import{B as xe,D as _e,F as he,G as Ee,I as ve,K as Ce,a as $,b as J,g as ne,l as oe,n as ae,o as le,p as me,r as se,s as de,u as ue,v as ce,x as pe,y as fe,z as ge}from"./chunk-LN33XJJG.js";import{a as be}from"./chunk-2KDJOZPQ.js";import{$ as ee,M as H,O as Q,P as X,R as K,T as p,V as W,W as Y,X as Z,Z as C,ca as te,da as ie,ma as re}from"./chunk-6K6YQ32S.js";import{D as G,e as U,l as B,r as S,z}from"./chunk-DDJAZSWD.js";import"./chunk-WRDENF74.js";import{Ab as c,Cb as T,Db as k,Eb as h,Fb as i,Gb as t,Hb as E,Mb as M,Qb as v,S as P,Sb as d,Wa as a,Wb as R,Xb as V,Yb as A,ac as q,ba as b,bc as j,ec as o,f as w,ga as g,gb as I,gc as _,ha as x,hc as F,mc as N,oc as L,u as O,zb as u}from"./chunk-D6M5U3FV.js";import"./chunk-MGTJOKXF.js";var je=["fileInput"],Ne=n=>({"bg-gray-100 border-blue-500":n}),Le=(n,r)=>r.id;function Ue(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),_(" ",e.getErrorSubject()," ")}}function Be(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),_(" ",e.getErrorRequired("mail_date")," ")}}function ze(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),_(" ",e.getErrorReference()," ")}}function Ge(n,r){if(n&1&&(i(0,"mat-option",24),o(1),t()),n&2){let e=r.$implicit;h("disabled",!e.department)("value",e.id),a(),F(" ",e.full_name," (",e.department?e.department.designation:"Aucune direction",") ")}}function $e(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),_(" ",e.getErrorRequired("sender_id")," ")}}function Je(n,r){if(n&1&&(i(0,"mat-error"),o(1),t()),n&2){let e=d(2);a(),_(" ",e.getErrorRecipient()," ")}}function He(n,r){if(n&1&&(i(0,"p",29),o(1),t()),n&2){let e=d(2);a(),_("Fichier : ",e.pdfService.localPdf.name," ")}}function Qe(n,r){if(n&1&&(i(0,"mat-error",30),o(1),t()),n&2){let e=d(2);a(),_(" ",e.errorMessage," ")}}function Xe(n,r){if(n&1&&(i(0,"div",31)(1,"div",35),E(2,"div",36),t(),i(3,"p",37),o(4),t()()),n&2){let e=d(2);a(2),j("width",e.uploadProgress,"%"),a(2),F("",e.uploadProgress," % - ",e.statusMessage)}}function Ke(n,r){if(n&1){let e=M();i(0,"button",38),v("click",function(){g(e);let l=d(2);return x(l.onDisplayOnlinePdf())}),i(1,"div",39)(2,"mat-icon",40),o(3,"remove_red_eye"),t(),i(4,"span"),o(5,"Aper\xE7u de l'ancien fichier"),t()()()}}function We(n,r){if(n&1){let e=M();i(0,"button",38),v("click",function(){g(e);let l=d(2);return x(l.onDisplayLocalPdf())}),i(1,"div",39)(2,"mat-icon",40),o(3,"remove_red_eye"),t(),i(4,"span"),o(5,"Aper\xE7u du nouveau fichier"),t()()()}}function Ye(n,r){if(n&1){let e=M();i(0,"form",13),v("ngSubmit",function(){g(e);let l=d();return x(l.onSubmit())}),i(1,"div",14)(2,"h1",15),o(3,"Objet du courrier"),t(),i(4,"p"),o(5," Indiquez ici le sujet principal du courrier. Il s'agit de l'objet tel qu'il figure sur le courrier scann\xE9. Ce titre appara\xEEtra dans les listes et les recherches. "),t()(),i(6,"div",16)(7,"mat-form-field",17)(8,"mat-label"),o(9,"Objet du courrier"),t(),E(10,"input",18),u(11,Ue,2,1,"mat-error"),t()(),i(12,"div",14)(13,"h1",15),o(14,"Date et R\xE9f\xE9rence du courrier"),t(),i(15,"p"),o(16," Saisissez la date d\u2019\xE9mission du courrier ainsi que sa f\xE9r\xE9rence ici "),t()(),i(17,"div",19)(18,"mat-form-field",17)(19,"mat-label"),o(20,"Date du courrier"),t(),E(21,"input",20)(22,"mat-datepicker-toggle",21)(23,"mat-datepicker",null,1),u(25,Be,2,1,"mat-error"),t()(),i(26,"div",19)(27,"mat-form-field",17)(28,"mat-label"),o(29,"R\xE9f\xE9rence du courrier"),t(),E(30,"input",22),u(31,ze,2,1,"mat-error"),t()(),i(32,"div",14)(33,"h1",15),o(34,"Exp\xE9diteur et Destinataire du courrier"),t(),i(35,"p"),o(36," S\xE9l\xE9ctionner le l'exp\xE9diteur et saissize le destinatair du courier "),t()(),i(37,"div",19)(38,"mat-form-field",17)(39,"mat-label"),o(40,"Directeur"),t(),i(41,"mat-select",23),T(42,Ge,2,4,"mat-option",24,Le),t(),u(44,$e,2,1,"mat-error"),t()(),i(45,"div",19)(46,"mat-form-field",17)(47,"mat-label"),o(48,"Destinataire du courrier"),t(),E(49,"input",25),u(50,Je,2,1,"mat-error"),t()(),i(51,"div",14)(52,"h1",15),o(53,"Courrier Scann\xE9"),t(),i(54,"p"),o(55," Il s'agit d'une lettre ou d\u2019un document papier qui a \xE9t\xE9 num\xE9ris\xE9 \xE0 l\u2019aide d\u2019un scanner, afin d\u2019\xEAtre conserv\xE9 ou envoy\xE9 sous format \xE9lectronique. Nous acceptons uniquement les fichiers au format PDF ou image (JPEG, PNG). "),t()(),i(56,"div",16)(57,"div",26),v("click",function(){g(e);let l=d();return x(l.triggerFileInput())})("dragover",function(l){g(e);let f=d();return x(f.onDragOver(l))})("dragleave",function(l){g(e);let f=d();return x(f.onDragLeave(l))})("drop",function(l){g(e);let f=d();return x(f.onDrop(l))}),i(58,"mat-icon",4),o(59,"attach_file"),t(),i(60,"p",27),o(61," D\xE9posez ici un fichier au format PDF ou image, ou "),i(62,"span",28),o(63," cliquez "),t(),o(64," pour le s\xE9lectionner. "),t(),u(65,He,2,1,"p",29),t(),u(66,Qe,2,1,"mat-error",30),t(),u(67,Xe,5,4,"div",31),i(68,"div",32),u(69,Ke,6,0,"button",33),u(70,We,6,0,"button",33),i(71,"button",34),o(72),t()()()}if(n&2){let e,m,l,f,y,D=q(24),s=d();h("formGroup",s.form),a(11),c((e=s.form.get("subject"))!=null&&e.hasError?11:-1),a(10),h("matDatepicker",D),a(),h("for",D),a(3),c((m=s.form.get("mail_date"))!=null&&m.hasError?25:-1),a(6),c((l=s.form.get("reference"))!=null&&l.hasError?31:-1),a(11),k(s.directors),a(2),c((f=s.form.get("sender_id"))!=null&&f.hasError?44:-1),a(6),c((y=s.form.get("recipient"))!=null&&y.hasError?50:-1),a(7),h("ngClass",L(15,Ne,s.isDragging)),a(8),c(s.pdfService.localPdf?65:-1),a(),c(s.errorMessage!==""?66:-1),a(),c(s.uploadProgress>0?67:-1),a(2),c(s.formActionPayload&&s.formActionPayload.data&&s.formActionPayload.data.scanned_document?69:-1),a(),c(s.pdfService.localPdf?70:-1),a(2),_(" ",s.formActionPayload&&s.formActionPayload.action==="add"?"Enregister le courrier":"Modifier le courrier"," ")}}function Ze(n,r){n&1&&(i(0,"div",11),E(1,"mat-spinner"),t())}var qe=class n{form;pdfService=b(Ve);http=b(be);message=b(Me);router=b(z);isDragging=!1;supportedTypes=["application/pdf","image/png","image/jpeg"];errorMessage="";uploadProgress=0;statusMessage="";fileInput;unsubscribeDir$=new w;directors=[];isFormReady=!1;formActionPayload;mail;constructor(){this.formActionPayload=JSON.parse(sessionStorage.getItem("formActionPayload")),this.mail=this.formActionPayload.data}ngOnInit(){this.loadData()}ngOnDestroy(){sessionStorage.removeItem("incomingExternalMail"),this.pdfService.localPdf=null,this.pdfService.onLinePdf=null,this.unsubscribeDir$.next(),this.unsubscribeDir$.complete()}initForm(){this.form=new Z({subject:new C(this.mail?this.mail.subject:"",[p.required,p.minLength(5),p.maxLength(200)]),mail_date:new C(this.mail?this.mail.mail_date:"",[p.required]),reference:new C(this.mail?this.mail.reference:"",[p.required,p.minLength(3),p.maxLength(30)]),recipient:new C(this.mail?this.mail.recipient:"",[p.required,p.minLength(3),p.maxLength(150)]),sender_id:new C(this.mail&&this.mail.sender?this.mail.sender.id:"",[p.required])})}getErrorSubject(){return this.form.get("subject").hasError("required")?"Ce champ est requis":this.form.get("subject").hasError("minlength")?"L'objet doit contenir au moins 5 caract\xE8res.":this.form.get("subject").hasError("maxlength")?"L'objet ne peut pas d\xE9passer 200 caract\xE8res.":""}getErrorReference(){return this.form.get("reference").hasError("required")?"Ce champ est requis":this.form.get("reference").hasError("minlength")?"L doit contenir au moins 3 caract\xE8res.":this.form.get("reference").hasError("maxlength")?"La r\xE9ference ne peut pas d\xE9passer 30 caract\xE8res.":""}getErrorRecipient(){return this.form.get("recipient").hasError("required")?"Ce champ est requis":this.form.get("recipient").hasError("minlength")?"Le destinataire doit contenir au moins 5 caract\xE8res.":this.form.get("recipient").hasError("maxlength")?"Le destinataire ne peut pas d\xE9passer 150 caract\xE8res.":""}getErrorRequired(r){return this.form.get(r).hasError("required")?"Ce champ est requis":""}triggerFileInput(){this.fileInput.nativeElement.value="",this.fileInput.nativeElement.click()}onDragOver(r){r.preventDefault(),this.isDragging=!0}onDragLeave(r){r.preventDefault(),this.isDragging=!1}onDrop(r){r.preventDefault(),this.isDragging=!1;let e=r.dataTransfer?.files;e&&this.pdfService.handleFile(e[0])}onFileSelected(r){let m=r.target.files;m&&this.pdfService.handleFile(m[0])}onDisplayLocalPdf(){this.pdfService.displayLocalPdf()}onDisplayOnlinePdf(){this.pdfService.displayOnlinePdf(this.formActionPayload.data.id,"document","outgoing-external-mails")}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.message.openSnackBar("Veuillez corriger les erreurs du formulaire.","Fermer",4e3);return}this.formActionPayload.action==="add"?this.add():this.update()}add(){this.http.url="outgoing-external-mails",this.http.sendFormData(JSON.stringify(this.form.value),this.pdfService.localPdf,"post").subscribe({next:r=>{r.type===S.UploadProgress?this.uploadProgress=Math.round(r.loaded/(r.total||1)*100):r.type===S.Response&&(this.message.openSnackBar("Enregistrement effectu\xE9 avec succ\xE8s !","Fermer",4e3),this.form.reset(),this.pdfService.localPdf=null)},error:r=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0},complete:()=>{this.router.navigateByUrl("/mails/outgoing/external")}})}update(){this.http.url=`outgoing-external-mails/${this.formActionPayload.data.id}`,this.http.sendFormData(JSON.stringify(this.form.value),this.pdfService.localPdf,"patch").subscribe({next:r=>{r.type===S.UploadProgress?this.uploadProgress=Math.round(r.loaded/(r.total||1)*100):r.type===S.Response&&this.message.openSnackBar("Modification effectu\xE9 avec succ\xE8s !","Fermer",4e3)},error:r=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0},complete:()=>{this.router.navigateByUrl("/mails/outgoing/external")}})}loadData(){let r={directors:this.getDirectors()};O(r).subscribe({next:e=>{this.directors=e.directors,this.initForm(),this.isFormReady=!0},error:e=>{this.message.openSnackBar("Une erreur est survenue lors du chargement des donn\xE9es. Veuillez r\xE9essayer.","Fermer",800)}})}getDirectors(){return this.http.url="users/by-role/DIRECTOR",this.http.get().pipe(P(this.unsubscribeDir$))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-outgoing-external-mail-form-component"]],viewQuery:function(e,m){if(e&1&&R(je,5),e&2){let l;V(l=A())&&(m.fileInput=l.first)}},features:[N([Ae()])],decls:20,vars:2,consts:[["fileInput",""],["picker1",""],[1,"flex","items-center","justify-between","md:h-14","md:px-4","md:bg-gray-50","border-b","border-b-gray-300","md:border-b-0"],["mat-icon-button",""],[1,"mat-18"],[1,"px-3","py-1","text-xs","md:text-sm","text-blue-600","bg-blue-100","rounded-full","dark:bg-gray-800","dark:text-blue-400"],["mat-icon-button","","matTooltip","Actualiser"],["mat-icon-button","","matTooltip","Imprimmer",3,"click","disabled"],[1,"w-full","md:px-16"],[1,"mt-7","text-lg","md:px-4","hidden","md:block"],[1,"w-full","flex","flex-wrap","mt-4",3,"formGroup"],[1,"flex","items-center","justify-center","my-10"],["type","file","accept",".jpg, .jpeg, .png, application/pdf",1,"hidden",3,"change"],[1,"w-full","flex","flex-wrap","mt-4",3,"ngSubmit","formGroup"],[1,"w-full","md:px-4","mb-4"],[1,"text-lg","font-bold"],[1,"w-full","md:px-4"],[1,"w-full"],["type","text","matInput","","formControlName","subject"],[1,"w-full","md:w-6/12","md:px-4"],["matInput","","formControlName","mail_date",3,"matDatepicker"],["matIconSuffix","",3,"for"],["type","text","matInput","","formControlName","reference"],["matInput","","formControlName","sender_id"],[3,"disabled","value"],["type","text","matInput","","formControlName","recipient"],[1,"w-full","h-56","flex","flex-col","items-center","justify-center","border-2","border-dashed","border-gray-400","bg-[#e0e2ec]","rounded-lg","cursor-pointer","hover:border-blue-500","transition",3,"click","dragover","dragleave","drop","ngClass"],[1,"text-gray-600","text-lg","text-center","mt-2","px-1"],[1,"text-blue-500","font-bold"],[1,"text-lg","border-t-4","border-r-gray-100","mt-0.5"],[1,"mt-1.5"],[1,"w-full","md:px-4","mt-3.5"],[1,"w-full","md:px-4","mt-4","flex","flex-col-reverse","md:flex-row","justify-end","items-center","gap-2.5"],["type","button","mat-stroked-button","","color","primary",1,"w-full","sm:w-auto"],["matTooltip","Cliquez pour Enregister le courrier","mat-flat-button","",1,"w-full","sm:w-auto"],[1,"w-full","bg-gray-200","rounded-full","h-2.5"],[1,"bg-blue-600","h-2.5","rounded-full","transition-all","duration-300","ease-in-out"],[1,"text-center","text-sm","text-gray-500","mt-2"],["type","button","mat-stroked-button","","color","primary",1,"w-full","sm:w-auto",3,"click"],[1,"flex","items-center"],[1,"me-2"]],template:function(e,m){if(e&1){let l=M();i(0,"section",2)(1,"button",3)(2,"mat-icon",4),o(3,"arrow_back_ios"),t()(),i(4,"span",5),o(5," CNSSAP "),t(),i(6,"div")(7,"button",6)(8,"mat-icon"),o(9,"refresh"),t()(),i(10,"button",7),v("click",function(){return g(l),x(m.onDisplayLocalPdf())}),i(11,"mat-icon"),o(12,"remove_red_eye"),t()()()(),i(13,"div",8)(14,"h1",9),o(15,"FORMULAIRE D'AJOUT D'UN NOUVEAU COURRIER SORTANT EXTERNE"),t(),u(16,Ye,73,17,"form",10)(17,Ze,2,0,"div",11),i(18,"input",12,0),v("change",function(y){return g(l),x(m.onFileSelected(y))}),t()()}e&2&&(a(10),h("disabled",!m.pdfService.localPdf),a(6),c(m.isFormReady?16:17))},dependencies:[ye,Fe,De,we,Pe,Oe,de,se,ae,le,me,oe,Se,Re,Ie,Te,ke,B,U,J,$,X,Q,H,G,re,ee,K,W,Y,te,ie,ne,ce,ue,pe,ge,fe,xe,Ee,he,_e,ve,Ce],encapsulation:2})};export{qe as OutgoingExternalMailFormComponent};
