import{a as Xt,b as Qt}from"./chunk-LQQ5G34X.js";import{a as Te}from"./chunk-PZZ47XRK.js";import{a as St,b as _e,c as fe,d as Ze,e as zt,f as ge,g as Se}from"./chunk-4OPMYXIF.js";import{a as Ht,b as Ce,c as be,d as qt,e as Jt,f as he,i as Me,j as Kt,k as xe,r as ve}from"./chunk-XO34ZB7H.js";import{b as ue}from"./chunk-YXRGR7ZY.js";import{a as Z}from"./chunk-FKLYTB4I.js";import{a as Y}from"./chunk-Y3YQYZ4W.js";import{A as jt,B as V,D as Lt,F as Ut,G as R,I as O,K as P,a as $,b as D,c as se,d as Pt,e as ce,f as de,g as w,l as x,n as Bt,o as We,r as $t,s as v,v as k,w as Gt,x as N,y as pe,z as F}from"./chunk-K6XTAWVM.js";import{a as G}from"./chunk-VBGLGRB2.js";import{$ as Xe,M as z,O as H,P as y,R as Nt,T as $e,V as qe,W as Je,X as Ke,Z as L,ba as Ft,ca as Qe,da as Ye,ea as Vt,fa as Rt,ga as Ot,ma as A}from"./chunk-BQFQ236X.js";import{C as E,c as Dt,d as le,f as yt,i as He,j as At,k as I,o as wt,q as me,y as kt}from"./chunk-PS6WXRYG.js";import{b as j}from"./chunk-HYQRV22J.js";import{$a as _t,Ab as f,C as bt,Cb as K,Db as X,Eb as b,Fb as o,G as ht,Gb as r,H as Mt,Hb as h,Mb as S,Qb as d,R as xt,S as te,Sb as s,Ta as vt,Wa as m,Wb as je,Xb as Le,Y as Ge,Yb as Ue,ab as Tt,ac as ae,ba as g,ec as l,f as U,fc as ft,ga as p,gb as M,gc as C,ha as u,mb as It,mc as Et,oc as Q,pb as J,pc as ie,qc as ze,rc as gt,xc as B,zb as _}from"./chunk-JPJ72NUK.js";import{a as q,b as ee}from"./chunk-2VMXMS7J.js";var mi=(n,e)=>e.id;function si(n,e){n&1&&(o(0,"div",1)(1,"span",14),l(2," Titre (55) "),r(),o(3,"button",15)(4,"mat-icon"),l(5," view_module "),r()()())}function ci(n,e){if(n&1&&(o(0,"option",27),l(1),r()),n&2){let t=e.$implicit;b("value",t.id),m(),C(" ",t.designation," ")}}function di(n,e){n&1&&(o(0,"div",29),l(1," Plage de dates invalide : la date de d\xE9but doit \xEAtre ant\xE9rieure \xE0 la date de fin. "),r())}function pi(n,e){if(n&1){let t=S();o(0,"form",16),d("ngSubmit",function(){p(t);let a=s();return u(a.onSubmit())}),o(1,"div",17)(2,"div",18)(3,"div")(4,"label",19),l(5,"Date de d\xE9but"),r(),h(6,"input",20),r()(),o(7,"div",21)(8,"div")(9,"label",22),l(10,"Date de fin"),r(),h(11,"input",23),r()(),o(12,"div",21)(13,"label",24),l(14,"Direction"),r(),o(15,"select",25)(16,"option",26),l(17,"Toutes les directions"),r(),K(18,ci,2,2,"option",27,mi),r()(),o(20,"button",28),l(21,"Rechercher"),r()(),_(22,di,2,0,"div",29),h(23,"hr",30),r()}if(n&2){let t=s();b("formGroup",t.form),m(18),X(t.departements),m(2),b("disabled",t.form.invalid),m(2),f(t.form.errors!=null&&t.form.errors.dateRangeInvalid?22:-1)}}function ui(n,e){n&1&&(o(0,"mat-button-toggle-group",13)(1,"mat-button-toggle",31)(2,"span"),l(3,"Affichage Grille"),r(),o(4,"mat-icon",32),l(5,"view_list"),r()(),o(6,"mat-button-toggle",33)(7,"span"),l(8,"Affichage tableau"),r(),o(9,"mat-icon",32),l(10,"view_module"),r()()())}var et=class n{http=g(G);stateService=g(j);message=g(Z);destroySearchKeywordSub$=new U;destroyFormSub$=new U;searchChanged=new J;searchKeyword=new L("");withDate=!1;form;xSmallOrSmall=B(()=>this.stateService.XSmallOrSmall());unsubscribe$=new U;departements=[];constructor(){this.initForm()}ngOnDestroy(){this.destroySearchKeywordSub$.next(),this.destroySearchKeywordSub$.complete(),this.destroyFormSub$.next(),this.destroyFormSub$.complete()}initForm(){this.findDepartments(),this.form=new Ke({startDate:new L(""),endDate:new L(""),department_id:new L("")},{validators:this.dateRangeValidator}),this.searchKeyword.valueChanges.pipe(bt(500),ht(),te(this.destroySearchKeywordSub$)).subscribe(e=>this.emitSearch(e||""))}toggleDateSelector(e){this.withDate=e,this.emitSearch(this.searchKeyword.value||"")}emitSearch(e){this.searchChanged.emit({keyword:e,startDate:this.form.value.startDate,endDate:this.form.value.endDate,department_id:this.form.value.department_id})}dateRangeValidator=e=>{let t=e.get("startDate")?.value,i=e.get("endDate")?.value;return t&&i&&new Date(t)>new Date(i)?{dateRangeInvalid:!0}:null};onSubmit(){this.emitSearch(this.searchKeyword.value||"")}onToogleDateSelector(e){this.withDate!==e&&(this.form.reset(),this.emitSearch("")),this.withDate=e}findDepartments(){this.unsubscribe$.next(),this.http.url="departments",this.http.get().pipe(te(this.unsubscribe$)).subscribe({next:e=>{this.departements=e},error:e=>{this.message.openSnackBar(e,"Fermer",800)},complete:()=>{}})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-search-bar-component"]],outputs:{searchChanged:"searchChanged"},decls:23,vars:8,consts:[["searchMenu",""],[1,"mt-3","flex","justify-between","items-center"],[1,"md:px-4",3,"formGroup"],[1,"flex","flex-wrap","my-4","md:mt-6"],[1,"w-full","lg:w-4/12"],[1,"relative","w-full"],["type","text","placeholder","Rechercher un courrier par mot cl\xE9",1,"w-full","p-3","pl-5","pr-15","text-lg","border-2","border-gray-300","rounded-full","outline-none","transition","duration-300","focus:border-blue-500","focus:text-gray-700","bg-white","h-[45px]","lg:h-[49px]",3,"formControl"],[1,"absolute","right-4","top-1/2","transform","-translate-y-1/2","flex","items-center"],[1,"inline-block","h-[45px]","border-l","border-gray-300"],["mat-icon-button","",1,"text-gray-500","hover:text-gray-700","ml-2",3,"matMenuTriggerFor"],["xPosition","before","yPosition","below",3,"overlapTrigger"],["mat-menu-item","",3,"click"],[1,"w-full","lg:w-8/12","flex","justify-end","items-center","flex-wrap","mt-3","md:mt-0"],["value","add"],[1,"text-lg"],["mat-icon-button",""],[1,"md:px-4",3,"ngSubmit","formGroup"],[1,"flex","flex-col","md:flex-row","md:items-end","md:space-x-4","my-4"],[1,"w-full","md:w-3/12"],["for","startDate",1,"block","text-sm","text-gray-500","dark:text-gray-300"],["formControlName","startDate","type","date","placeholder","John Doe",1,"block","mt-2","w-full","placeholder-gray-400/70","dark:placeholder-gray-500","rounded-lg","border","border-gray-200","bg-white","px-5","py-3.5","text-gray-700","focus:border-blue-400","focus:outline-none","focus:ring","focus:ring-blue-300","focus:ring-opacity-40","dark:border-gray-600","dark:bg-gray-900","dark:text-gray-300","dark:focus:border-blue-300"],[1,"w-full","md:w-3/12","md:px-4"],["for","username",1,"block","text-sm","text-gray-500","dark:text-gray-300"],["id","username","formControlName","endDate","type","date","placeholder","John Doe",1,"block","mt-2","w-full","placeholder-gray-400/70","dark:placeholder-gray-500","rounded-lg","border","border-gray-200","bg-white","px-5","py-3.5","text-gray-700","focus:border-blue-400","focus:outline-none","focus:ring","focus:ring-blue-300","focus:ring-opacity-40","dark:border-gray-600","dark:bg-gray-900","dark:text-gray-300","dark:focus:border-blue-300"],["for","direction",1,"block","text-sm","text-gray-500","dark:text-gray-300"],["formControlName","department_id","id","direction",1,"block","w-full","placeholder-gray-400/70","dark:placeholder-gray-500","rounded-lg","border","border-gray-200","bg-white","px-5","py-3.5","text-gray-700","focus:border-blue-400","focus:outline-none","focus:ring","focus:ring-blue-300","focus:ring-opacity-40","dark:border-gray-600","dark:bg-gray-900","dark:text-gray-300","dark:focus:border-blue-300"],["selected","","value",""],[3,"value"],["matButton","filled","type","submit",1,"float-end",3,"disabled"],[1,"text-red-500","mb-1.5"],[1,"border-gray-300"],["matTooltip","Nouveau groupe","value","add","aria-label","Text align center"],["color","primary"],["matTooltip","Liste des proclamateurs","value","print","aria-label","Text align center"]],template:function(t,i){if(t&1){let a=S();_(0,si,6,0,"div",1),_(1,pi,24,3,"form",2),o(2,"section",3)(3,"div",4)(4,"div",5),h(5,"input",6),o(6,"div",7),h(7,"span",8),o(8,"button",9)(9,"mat-icon"),l(10,"keyboard_arrow_down"),r()(),o(11,"mat-menu",10,0)(13,"button",11),d("click",function(){return p(a),u(i.onToogleDateSelector(!1))}),o(14,"mat-icon"),l(15),r(),l(16," Rechercher sans date "),r(),o(17,"button",11),d("click",function(){return p(a),u(i.onToogleDateSelector(!0))}),o(18,"mat-icon"),l(19),r(),l(20," Rechercher avec date "),r()()()()(),o(21,"div",12),_(22,ui,11,0,"mat-button-toggle-group",13),r()()}if(t&2){let a=ae(12);f(i.xSmallOrSmall()?0:-1),m(),f(i.withDate?1:-1),m(4),b("formControl",i.searchKeyword),m(3),b("matMenuTriggerFor",a),m(3),b("overlapTrigger",!1),m(4),C(" ",i.withDate?"event_busy":"check"," "),m(4),C(" ",i.withDate?"check":"date_range"," "),m(3),f(i.xSmallOrSmall()?-1:22)}},dependencies:[I,D,$,y,H,z,E,A,Xe,Rt,Ot,Nt,Vt,qe,Je,Ft,Qe,Ye,w,ce,se,de,x,v,k,N,F,pe,V,R,O,P,Ce,be,he,qt,Jt,Me,xe,ue,ve],encapsulation:2})};var _i=n=>({"bg-gray-200":n}),fi=n=>({color:n}),gi=(n,e)=>e.key;function Si(n,e){if(n&1){let t=S();o(0,"button",8),d("click",function(){p(t);let a=s();return u(a.onGoBack())}),o(1,"mat-icon"),l(2,"arrow_back_ios"),r()()}}function Ci(n,e){if(n&1){let t=S();o(0,"div",10),d("click",function(){p(t);let a=s().$implicit,c=s();return u(c.onSelectTab(a))}),o(1,"button",11)(2,"mat-icon",12),l(3),r()()()}if(n&2){let t=s().$implicit,i=s();b("ngClass",Q(4,_i,i.selectedTab===t.key)),m(),b("matTooltip",i.getTooltip(t)),m(),b("ngStyle",Q(6,fi,i.selectedTab===t.key?"#007ac3":"")),m(),C(" ",t.icon," ")}}function bi(n,e){if(n&1&&_(0,Ci,4,8,"div",9),n&2){let t=e.$implicit,i=s();f(t.roles.includes(i.role)?0:-1)}}function hi(n,e){if(n&1&&(o(0,"span",4),l(1),ie(2,"uppercase"),r()),n&2){let t=s();m(),C(" ",ze(2,1,t.title)," ")}}function Mi(n,e){if(n&1){let t=S();o(0,"button",13),d("click",function(){p(t);let a=s();return u(a.onEmit("goToForm"))}),o(1,"mat-icon"),l(2,"add"),r()()}}function xi(n,e){if(n&1){let t=S();o(0,"button",14)(1,"mat-icon"),l(2,"keyboard_arrow_down"),r()(),o(3,"mat-menu",15,0)(5,"button",16),d("click",function(){p(t);let a=s();return u(a.onEmit("destined"))}),o(6,"mat-icon"),l(7,"check"),r(),l(8," Courriers qui me sont destin\xE9s"),r(),o(9,"button",16),d("click",function(){p(t);let a=s();return u(a.onEmit("all"))}),o(10,"mat-icon"),l(11,"list"),r(),l(12," Liste complete des courriers "),r()()}if(n&2){let t=ae(4);b("matMenuTriggerFor",t),m(3),b("overlapTrigger",!1)}}var tt=class n{stateService=g(j);location=g(Dt);httpService=g(G);selectedTab="initial";tabSelected=new J;actionButton=new J;roles=Y;role=this.httpService.role;tabs=[{key:"initial",icon:"toc",tooltipMaa:"Tous les courriers",tooltipAaSa:"Courriers \xE0 annoter",tooltipDir:"Courriers \xE0 traiter",roles:["MAIL_ARCHIVES_AGENT","EXECUTIVE_SECRETARY","ADMIN_ASSISTANT","SENIOR_ASSISTANT","DIRECTOR"]},{key:"annotated",icon:"receipt",tooltip:"Courrier d\xE9j\xE0 annot\xE9s",roles:["ADMIN_ASSISTANT","SENIOR_ASSISTANT"]},{key:"all",icon:"list",tooltip:"Liste compl\xE8te de courriers",roles:["ADMIN_ASSISTANT","SENIOR_ASSISTANT","DIRECTOR"]},{key:"treated",icon:"assignment_turned_in",tooltip:"D\xE9j\xE0 trait\xE9s",roles:["ADMIN_ASSISTANT","SENIOR_ASSISTANT","DIRECTOR"]},{key:"to-process",icon:"translate",tooltip:"Courriers \xE0 traiter",roles:["MAIL_ARCHIVES_AGENT","EXECUTIVE_SECRETARY","ADMIN_ASSISTANT","SENIOR_ASSISTANT"]}];xSmallOrSmall=B(()=>this.stateService.XSmallOrSmall());title=this.getTooltip(this.tabs[0]);constructor(){sessionStorage.getItem("tab")&&(this.selectedTab=sessionStorage.getItem("tab"))}onSelectTab(e){this.selectedTab=e.key,this.title=this.getTooltip(e),this.tabSelected.emit(e.key)}onEmit(e){this.selectedTab=e,this.actionButton.emit(e)}getTooltip(e){if(e.key==="initial")switch(this.role){case"MAIL_ARCHIVES_AGENT":return e.tooltipMaa;case"DIRECTOR":return e.tooltipDir;default:return e.tooltipAaSa}return e.tooltip}onGoBack(){this.location.back()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-toolbar-component"]],inputs:{selectedTab:"selectedTab"},outputs:{tabSelected:"tabSelected",actionButton:"actionButton"},decls:15,vars:5,consts:[["menu",""],[1,"flex","items-center","justify-between","md:h-16","md:px-4","border-b","border-b-gray-300","md:border-b-0","py-2","md:py-0",3,"ngClass"],[1,"flex","gap-2"],["mat-icon-button","",1,"me-2"],[1,"text-lg"],["mat-icon-button","","matTooltip","Nouveau courrier"],["mat-icon-button","","matTooltip","Actualiser",3,"click"],["mat-icon-button","","matTooltip","Imprimer",3,"click"],["mat-icon-button","",1,"me-2",3,"click"],[3,"ngClass"],[3,"click","ngClass"],["mat-icon-button","",3,"matTooltip"],[3,"ngStyle"],["mat-icon-button","","matTooltip","Nouveau courrier",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["yPosition","below",3,"overlapTrigger"],["mat-menu-item","",3,"click"]],template:function(t,i){t&1&&(o(0,"section",1)(1,"div",2),_(2,Si,3,0,"button",3),K(3,bi,1,1,null,null,gi),r(),_(5,hi,3,3,"span",4),o(6,"div"),_(7,Mi,3,0,"button",5),o(8,"button",6),d("click",function(){return i.onEmit("refresh")}),o(9,"mat-icon"),l(10,"refresh"),r()(),o(11,"button",7),d("click",function(){return i.onEmit("print")}),o(12,"mat-icon"),l(13,"print"),r()(),_(14,xi,13,2),r()()),t&2&&(b("ngClass",i.xSmallOrSmall()?"":"u-bg-header-main"),m(2),f(i.xSmallOrSmall()?-1:2),m(),X(i.tabs),m(2),f(i.xSmallOrSmall()?-1:5),m(2),f(i.role===i.roles.MAIL_ARCHIVES_AGENT||i.role===i.roles.ADMIN_ASSISTANT||i.role===i.roles.EXECUTIVE_SECRETARY?7:-1),m(7),f(i.role===i.roles.ADMIN_ASSISTANT||i.role===i.roles.SENIOR_ASSISTANT?14:-1))},dependencies:[I,le,yt,D,$,y,z,E,A,w,ce,se,de,x,v,k,N,F,pe,V,R,O,P,Ce,be,he,Me,xe,ue,ve,He],encapsulation:2})};var Be=class{constructor(e,t){this.action=e;this.data=t}};var it=(a=>(a.TO_ADMIN_ASSISTANT="aa",a.TO_SENIOR_ASSISTANT="sa",a.TO_DIRECTOR="dir",a.TO_BE_PROCESSED="proc",a))(it||{});var nt=(c=>(c.INITIAL="initial",c.ANNOTATED="annotated",c.ALL="all",c.TREATED="treated",c.TO_PROCESS="to-process",c))(nt||{});function vi(n,e){if(n&1){let t=S();o(0,"button",0),d("click",function(){p(t);let a=s();return u(a.onMenuItemClicked("display_document",a.item))}),o(1,"mat-icon"),l(2,"remove_red_eye"),r(),o(3,"span"),l(4,"Aper\xE7u document"),r()()}}function Ti(n,e){if(n&1){let t=S();o(0,"button",0),d("click",function(){p(t);let a=s();return u(a.onMenuItemClicked("display_proof",a.item))}),o(1,"mat-icon"),l(2,"remove_red_eye"),r(),o(3,"span"),l(4,"Aper\xE7u preuve"),r()()}}function Ii(n,e){if(n&1){let t=S();o(0,"button",0),d("click",function(){p(t);let a=s();return u(a.onMenuItemClicked("download_mail",a.item))}),o(1,"mat-icon"),l(2,"cloud_download"),r(),o(3,"span"),l(4,"T\xE9l\xE9charger courrier"),r()()}}function Ei(n,e){if(n&1){let t=S();o(0,"button",0),d("click",function(){p(t);let a=s();return u(a.onMenuItemClicked("download_proof",a.item))}),o(1,"mat-icon"),l(2,"get_app"),r(),o(3,"span"),l(4,"T\xE9l\xE9charger preuve"),r()()}}function Di(n,e){if(n&1){let t=S();o(0,"button",0),d("click",function(){p(t);let a=s(2);return u(a.onMenuItemClicked("add_comment",a.item))}),o(1,"mat-icon"),l(2,"add"),r(),o(3,"span"),l(4,"Ajouter Annotation"),r()()}}function yi(n,e){if(n&1){let t=S();o(0,"button",0),d("click",function(){p(t);let a=s(2);return u(a.onMenuItemClicked("assign_agent",a.item))}),o(1,"mat-icon"),l(2,"person"),r(),o(3,"span"),l(4,"Assigner un agent"),r()()}}function Ai(n,e){if(n&1){let t=S();h(0,"mat-divider"),_(1,Di,5,0,"button",1),o(2,"button",0),d("click",function(){p(t);let a=s();return u(a.onMenuItemClicked("treatment_proof",a.item))}),o(3,"mat-icon"),l(4,"attach_file"),r(),o(5,"span"),l(6,"Joindre une preuve"),r()(),o(7,"button",0),d("click",function(){p(t);let a=s();return u(a.onMenuItemClicked("share_mail",a.item))}),o(8,"mat-icon"),l(9,"shared"),r(),o(10,"span"),l(11,"Partager le courrier"),r()(),_(12,yi,5,0,"button",1)}if(n&2){let t=s();m(),f(t.role!==t.roles.DIRECTOR?1:-1),m(11),f(t.role===t.roles.DIRECTOR?12:-1)}}function wi(n,e){if(n&1){let t=S();o(0,"button",0),d("click",function(){p(t);let a=s();return u(a.onMenuItemClicked("delete_mail",a.item))}),o(1,"mat-icon"),l(2,"delete"),r(),o(3,"span"),l(4,"Mettre \xE0 la corbeille"),r()()}}var ot=class n{role;item;actionSelected=new J;roles=Y;onMenuItemClicked(e,t){this.actionSelected.emit({action:e,data:t})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-incoming-mail-menu-component"]],inputs:{role:"role",item:"item"},outputs:{actionSelected:"actionSelected"},decls:22,vars:6,consts:[["mat-menu-item","",3,"click"],["mat-menu-item",""]],template:function(t,i){t&1&&(o(0,"button",0),d("click",function(){return i.onMenuItemClicked("view_detail",i.item)}),o(1,"mat-icon"),l(2,"list"),r(),l(3,"Voir le d\xE9tail "),r(),_(4,vi,5,0,"button",1),_(5,Ti,5,0,"button",1),h(6,"mat-divider"),o(7,"button",0),d("click",function(){return i.onMenuItemClicked("receipt",i.item)}),o(8,"mat-icon"),l(9,"print"),r(),o(10,"span"),l(11,"Accus\xE9 de r\xE9ception"),r()(),_(12,Ii,5,0,"button",1),_(13,Ei,5,0,"button",1),_(14,Ai,13,2),h(15,"mat-divider"),o(16,"button",0),d("click",function(){return i.onMenuItemClicked("edit_mail",i.item)}),o(17,"mat-icon"),l(18,"edit"),r(),o(19,"span"),l(20,"Modifier ce courrier"),r()(),_(21,wi,5,0,"button",1)),t&2&&(m(4),f(i.item.scanned_document?4:-1),m(),f(i.item.treatment_proof&&i.role!==i.roles.MAIL_ARCHIVES_AGENT?5:-1),m(7),f(i.item.scanned_document?12:-1),m(),f(i.item.treatment_proof&&i.role!==i.roles.MAIL_ARCHIVES_AGENT?13:-1),m(),f(i.role!==i.roles.MAIL_ARCHIVES_AGENT?14:-1),m(7),f(i.role!==i.roles.MAIL_ARCHIVES_AGENT?21:-1))},dependencies:[I,D,$,y,E,A,w,se,x,v,k,N,F,V,jt,R,O,P],encapsulation:2})};var ki=n=>({item:n}),Ni=(n,e)=>e.id;function Fi(n,e){n&1&&h(0,"img",9)}function Vi(n,e){if(n&1){let t=S();o(0,"button",16),d("click",function(){p(t);let a=s(2).$implicit,c=s();return u(c.onAddComment(a))}),l(1,"Annoter"),r()}}function Ri(n,e){n&1&&(o(0,"button",17)(1,"mat-icon"),l(2,"check"),r()())}function Oi(n,e){if(n&1){let t=S();o(0,"button",19),d("click",function(){p(t);let a=s(3).$implicit,c=s();return u(c.onSend(a))}),l(1,"Envoyer"),r()}}function Pi(n,e){if(n&1&&_(0,Ri,3,0,"button",17)(1,Oi,2,0,"button",18),n&2){let t=s(2).$implicit,i=s();f(t.status===i.status.TO_SENIOR_ASSISTANT||t.status===i.status.TO_DIRECTOR||t.status===i.status.TO_BE_PROCESSED?0:1)}}function Bi(n,e){if(n&1&&_(0,Vi,2,0,"button",15)(1,Pi,2,1),n&2){let t=s(2);f(t.tab===t.tabs.INITIAL?0:1)}}function $i(n,e){if(n&1){let t=S();o(0,"button",16),d("click",function(){p(t);let a=s(2).$implicit,c=s();return u(c.onAddComment(a))}),l(1,"Annoter"),r()}}function Gi(n,e){n&1&&(o(0,"button",17)(1,"mat-icon"),l(2,"check"),r()())}function ji(n,e){if(n&1){let t=S();o(0,"button",19),d("click",function(){p(t);let a=s(3).$implicit,c=s();return u(c.onSend(a))}),l(1,"Envoyer"),r()}}function Li(n,e){if(n&1&&_(0,Gi,3,0,"button",17)(1,ji,2,0,"button",18),n&2){let t=s(2).$implicit,i=s();f(t.status===i.status.TO_DIRECTOR||t.status===i.status.TO_BE_PROCESSED?0:1)}}function Ui(n,e){if(n&1&&_(0,$i,2,0,"button",15)(1,Li,2,1),n&2){let t=s(2);f(t.tab===t.tabs.INITIAL?0:1)}}function zi(n,e){if(n&1){let t=S();o(0,"button",16),d("click",function(){p(t);let a=s(2).$implicit,c=s();return u(c.onAddProof(a))}),l(1,"Joindre preuve"),r()}}function Hi(n,e){n&1&&(o(0,"button",17)(1,"mat-icon"),l(2,"check"),r()())}function qi(n,e){if(n&1&&_(0,Hi,3,0,"button",17),n&2){let t=s(2).$implicit,i=s();f(t.status===i.status.TO_BE_PROCESSED?0:-1)}}function Ji(n,e){if(n&1&&_(0,zi,2,0,"button",15)(1,qi,1,1),n&2){let t=s().$implicit,i=s();f(i.tab===i.tabs.INITIAL||t.status===i.status.TO_DIRECTOR?0:1)}}function Ki(n,e){n&1&&h(0,"hr",14)}function Xi(n,e){if(n&1&&(o(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7),h(4,"img",8),_(5,Fi,1,0,"img",9),r(),_(6,Bi,2,1)(7,Ui,2,1)(8,Ji,2,1),r(),o(9,"button",10)(10,"mat-icon",11),l(11,"more_vert"),r()()(),o(12,"h1",12),l(13),o(14,"span"),l(15),r()(),o(16,"div",13)(17,"div")(18,"span"),l(19,"Date du courrier : "),r(),o(20,"span"),l(21),ie(22,"date"),r(),l(23," \xA0 | \xA0 "),o(24,"span"),l(25,"Date d'enregistrement : "),r(),o(26,"span"),l(27),ie(28,"date"),r()(),o(29,"div")(30,"span"),l(31,"Exp\xE9diteur : "),r(),o(32,"span"),l(33),r()()()(),_(34,Ki,1,0,"hr",14)),n&2){let t=e.$implicit,i=e.$index,a=e.$count,c=s(),T=ae(4);m(4),b("src",t.scanned_document?"assets/images/pdf.png":"assets/images/notFile.png",vt),m(),f(t.treatment_proof?5:-1),m(),f(c.role===c.roles.ADMIN_ASSISTANT?6:c.role===c.roles.SENIOR_ASSISTANT?7:c.role===c.roles.DIRECTOR?8:-1),m(3),b("matMenuTriggerFor",T)("matMenuTriggerData",Q(17,ki,t)),m(4),C(" ",t.subject," \xA0 "),m(2),C("#",t.id),m(6),C(" ",gt(22,11,t.mail_date,"dd/MM/yyyy")," "),m(6),C(" ",gt(28,14,t.create_at,"dd/MM/yyyy")," "),m(6),C(" ",c.getSenderDisplayName(t)," "),m(),f(i!==a-1?34:-1)}}function Qi(n,e){if(n&1){let t=S();o(0,"app-incoming-mail-menu-component",20),d("actionSelected",function(a){p(t);let c=s();return u(c.onActinSelected(a))}),r()}if(n&2){let t=e.item,i=s();b("role",i.role)("item",t)}}var rt=class n{httpService=g(G);tab="initial";mails=void 0;menuSelected=new J;roles=Y;status=it;tabs=nt;role=this.httpService.role;onActinSelected(e){this.menuSelected.emit(e)}ngOnInit(){}onSend(e){this.menuSelected.emit(new Be("send",e))}onAddComment(e){this.menuSelected.emit(new Be("add_comment",e))}onAddProof(e){this.menuSelected.emit(new Be("treatment_proof",e))}getSenderDisplayName(e){return typeof e.sender=="string"?e.sender:e.sender.full_name}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-incoming-mail-grid-component"]],inputs:{tab:"tab",mails:"mails"},outputs:{menuSelected:"menuSelected"},decls:6,vars:1,consts:[["mailMenu","matMenu"],[1,"grid","grid-cols-1","gap-8","md:grid-cols-2","lg:grid-cols-3","my-6"],["yPosition","below",3,"overlapTrigger"],["matMenuContent",""],[1,"md:p-3","border-2","border-transparent","rounded-lg","transition-all","duration-300","hover:border-blue-500"],[1,"flex","justify-between"],[1,"flex","items-center","gap-4"],[1,"relative","w-20","h-20"],["alt","Document Statut",1,"absolute","top-0","left-0","h-20","w-20","z-10",3,"src"],["src","assets/images/pdf.png","alt","Traitement Prouv\xE9",1,"absolute","bottom-0","right-0","h-16","w-16","z-20","translate-x-3","translate-y-3"],["mat-icon-button","",3,"matMenuTriggerFor","matMenuTriggerData"],[1,"mat-18"],[1,"mt-4","text-xl","font-semibold","text-gray-800"],[1,"mt-2","text-gray-500","dark:text-gray-400"],[1,"block","sm:hidden","border","border-blue-950"],["matTooltip","Cliquer pour annoter","mat-button",""],["matTooltip","Cliquer pour annoter","mat-button","",3,"click"],["matTooltip","Cliquez pour afficher l'Assistant Principal","mat-icon-button",""],["matTooltip","Cliquer pour envoyer \xE0 l'Assistant Principal pour  validation","mat-button",""],["matTooltip","Cliquer pour envoyer \xE0 l'Assistant Principal pour  validation","mat-button","",3,"click"],[3,"actionSelected","role","item"]],template:function(t,i){t&1&&(o(0,"section",1),K(1,Xi,35,19,null,null,Ni),r(),o(3,"mat-menu",2,0),It(5,Qi,1,2,"ng-template",3),r()),t&2&&(m(),X(i.mails),m(2),b("overlapTrigger",!1))},dependencies:[I,D,$,y,H,z,E,A,w,ce,Pt,de,x,v,k,N,F,pe,V,R,O,P,ot,At],encapsulation:2})};function Yi(n,e){n&1&&(o(0,"div",2),h(1,"mat-spinner"),r())}function Wi(n,e){if(n&1){let t=S();o(0,"app-incoming-mail-grid-component",5),d("menuSelected",function(a){p(t);let c=s();return u(c.onMenuSelected(a))}),r()}if(n&2){let t=s();b("tab",t.tab)("mails",t.mailService.page.items)}}function Zi(n,e){if(n&1){let t=S();o(0,"mat-paginator",6),d("page",function(a){p(t);let c=s();return u(c.onNext(a))}),r()}if(n&2){let t=s();b("length",t.mailService.page.totalItems)("pageSize",t.mailService.criteria.pageSize)("pageIndex",t.pageIndex)("pageSizeOptions",t.pageSizeOptions)}}var oi=class n{pdfService=g(Te);stateService=g(j);xSmallOrSmall=B(()=>this.stateService.XSmallOrSmall());pageSizeOptions=[6,12,24,100];pageEvent;tab="initial";pageIndex=0;constructor(){sessionStorage.getItem("tab")&&(this.tab=sessionStorage.getItem("tab"))}ngOnInit(){this.onSelectTab(this.tab)}onNext(e){this.pageEvent=e,this.pageIndex=e.pageIndex,this.mailService.criteria.page=this.pageEvent.pageIndex+1,this.mailService.criteria.pageSize=this.pageEvent.pageSize,this.onSelectTab(this.tab)}onSearchChanged(e){Object.assign(this.mailService.criteria,e),this.onSelectTab(this.tab)}onSelectTab(e,t=!1){switch(t&&(this.mailService.criteria.page=1,this.mailService.criteria.pageSize=6,this.pageIndex=0),e){case"initial":this.mailService.buildInitial();break;case"annotated":this.mailService.buildAnnotated();break;case"all":this.mailService.buildAll();break;case"treated":this.mailService.buildTreated();break;case"to-process":this.mailService.buildToProcess();break;default:}this.tab=e,sessionStorage.setItem("tab",e)}onActionButton(e){switch(e){case"goToForm":this.mailService.goToForm("add");break;case"refresh":this.mailService.buildInitial();break;case"print":break;default:}}onMenuSelected(e){switch(e.action){case"view_detail":this.mailService.gotToDetails(e.data);break;case"display_document":this.pdfService.displayOnlinePdf(e.data.id,"document");break;case"display_proof":this.pdfService.displayOnlinePdf(e.data.id,"proof");break;case"receipt":break;case"download_mail":this.mailService.downloadDocument(e.data.id,"document");break;case"download_proof":this.mailService.downloadDocument(e.data.id,"proof");break;case"add_comment":this.mailService.openAddCommentDialog(e.data,this.tab);break;case"treatment_proof":this.mailService.AddTreatmentProof(e.data);break;case"share_mail":break;case"assign_agent":case"edit_mail":this.mailService.goToForm(e.action,e.data);break;case"delete_mail":break;case"send":this.mailService.send(e.data);break;default:console.warn("Action non g\xE9r\xE9e :")}}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-incoming-mail-component"]],decls:5,vars:2,consts:[[3,"tabSelected","actionButton"],[3,"searchChanged"],[1,"flex","items-center","justify-center","my-10"],[3,"tab","mails"],["showFirstLastButtons","","aria-label","Select page",1,"mt-12",3,"length","pageSize","pageIndex","pageSizeOptions"],[3,"menuSelected","tab","mails"],["showFirstLastButtons","","aria-label","Select page",1,"mt-12",3,"page","length","pageSize","pageIndex","pageSizeOptions"]],template:function(t,i){t&1&&(o(0,"app-toolbar-component",0),d("tabSelected",function(c){return i.onSelectTab(c,!0)})("actionButton",function(c){return i.onActionButton(c)}),r(),o(1,"app-search-bar-component",1),d("searchChanged",function(c){return i.onSearchChanged(c)}),r(),_(2,Yi,2,0,"div",2)(3,Wi,1,2,"app-incoming-mail-grid-component",3),_(4,Zi,1,4,"mat-paginator",4)),t&2&&(m(2),f(i.mailService.loading?2:3),m(2),f(i.mailService.page?4:-1))},dependencies:[tt,et,Ce,Ht,be,he,Me,xe,Kt,v,x,ue,ve,rt],encapsulation:2})};var at=class{constructor(e,t){this.url=e;this.params=t}};var lt=class n{buildParams(e){let t=new wt;for(let i in e){let a=e[i];a!=null&&a!==""&&(t=t.set(i,a.toString()))}return t}build(e,t){return new at(e,this.buildParams(t))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Ge({token:n,factory:n.\u0275fac,providedIn:"root"})};var mt=class{constructor(e,t,i,a,c,T,ut,Ct,bn,hn,Mn,xn){this.page=e;this.pageSize=t;this.keyword=i;this.withAnnotated=a;this.processed=c;this.startDate=T;this.endDate=ut;this.department_id=Ct;this.assigned_to_me=bn;this.withAdminAssistant=hn;this.withSeniorAssistant=Mn;this.withDirector=xn}};var st=class{constructor(e,t){this.action=e;this.data=t}};var en=["fileInput"],tn=n=>({"bg-gray-100 border-blue-500":n}),ai=(n,e)=>e.id;function nn(n,e){if(n&1&&(o(0,"mat-option",20),l(1),r()),n&2){let t=e.$implicit;b("value",t.id),m(),C(" ",t.full_name," ")}}function on(n,e){if(n&1&&(o(0,"mat-error"),l(1),r()),n&2){let t=s(2);m(),C(" ",t.getErrorSeriorAssistant("senior_assistant_id")," ")}}function rn(n,e){if(n&1&&(o(0,"mat-form-field",8)(1,"mat-label"),l(2,"Assistant principal charg\xE9 de la validation"),r(),o(3,"mat-select",19),K(4,nn,2,2,"mat-option",20,ai),r(),_(6,on,2,1,"mat-error"),r()),n&2){let t,i=s();m(4),X(i.seniorAssistants),m(2),f((t=i.form.get("senior_assistant_id"))!=null&&t.hasError?6:-1)}}function an(n,e){if(n&1&&(o(0,"mat-option",20),l(1),r()),n&2){let t=e.$implicit;b("value",t.id),m(),C(" ",t.full_name," ")}}function ln(n,e){if(n&1&&(o(0,"mat-error"),l(1),r()),n&2){let t=s(2);m(),C(" ",t.getErrorSeriorAssistant("director_id")," ")}}function mn(n,e){if(n&1&&(o(0,"mat-form-field",8)(1,"mat-label"),l(2,"Directeur charg\xE9 de traitement de ce courrier"),r(),o(3,"mat-select",21),K(4,an,2,2,"mat-option",20,ai),r(),_(6,ln,2,1,"mat-error"),r()),n&2){let t,i=s();m(4),X(i.directors),m(2),f((t=i.form.get("director_id"))!=null&&t.hasError?6:-1)}}function sn(n,e){if(n&1&&(o(0,"mat-error"),l(1),r()),n&2){let t=s();m(),C(" ",t.getErrorComment(t.data.target===t.roles.ADMIN_ASSISTANT?"admin_assistant_comment":"senior_assistant_comment")," ")}}function cn(n,e){if(n&1){let t=S();o(0,"mat-checkbox",22),d("change",function(a){p(t);let c=s();return u(c.onCheckboxChange(a))}),l(1,"Joindre un fichier scann\xE9"),r()}}function dn(n,e){if(n&1&&(o(0,"p",27),l(1),r()),n&2){let t=s(2);m(),C("Fichier : ",t.pdfService.localPdf.name," ")}}function pn(n,e){if(n&1&&(o(0,"mat-error",28),l(1),r()),n&2){let t=s(2);m(),C(" ",t.errorMessage," ")}}function un(n,e){if(n&1){let t=S();o(0,"div",13)(1,"div",23),d("click",function(){p(t);let a=s();return u(a.triggerFileInput())})("dragover",function(a){p(t);let c=s();return u(c.onDragOver(a))})("dragleave",function(a){p(t);let c=s();return u(c.onDragLeave(a))})("drop",function(a){p(t);let c=s();return u(c.onDrop(a))}),o(2,"mat-icon",24),l(3,"attach_file"),r(),o(4,"p",25),l(5," D\xE9posez ici un fichier au format PDF ou image, ou "),o(6,"span",26),l(7," cliquez "),r(),l(8," pour le s\xE9lectionner."),r(),_(9,dn,2,1,"p",27),r(),_(10,pn,2,1,"mat-error",28),r()}if(n&2){let t=s();m(),b("ngClass",Q(3,tn,t.isDragging)),m(8),f(t.pdfService.localPdf?9:-1),m(),f(t.errorMessage!==""?10:-1)}}var ct=class n{dialogRef=g(_e);message=g(Z);data=g(fe);http=g(G);stateService=g(j);pdfService=g(Te);disabled=!1;supportedTypes=["application/pdf","image/png","image/jpeg"];errorMessage="";isDragging=!1;init={plugins:"lists link image table code help wordcount",height:350};fileInput;form;unsubscribeSA$=new U;unsubscribeDir$=new U;unsubscribeMail$=new U;seniorAssistants=[];directors=[];uploadProgress=0;xSmallOrSmall=B(()=>this.stateService.XSmallOrSmall());mail;roles=Y;ngOnDestroy(){this.unsubscribeSA$.next(),this.unsubscribeSA$.complete(),this.unsubscribeDir$.next(),this.unsubscribeDir$.complete()}ngOnInit(){this.data.target==="ADMIN_ASSISTANT"?this.findSeniorAssistants():this.findDirectors(),this.findMail(),this.initForm()}initForm(){this.form=new Ke({shouldSendDocument:new L(!1)}),this.data.target==="ADMIN_ASSISTANT"?(this.form.addControl("admin_assistant_comment",new L(this.data.mail?this.data.mail.admin_assistant_comment:"",[$e.required])),this.form.addControl("senior_assistant_id",new L(this.data.mail.seniorAssistant?this.data.mail.seniorAssistant.id:"",[$e.required]))):(this.form.addControl("senior_assistant_comment",new L(this.data.mail&&this.data.mail.senior_assistant_comment?this.data.mail.senior_assistant_comment:this.data.mail.admin_assistant_comment,[$e.required])),this.form.addControl("director_id",new L(this.data.mail.director?this.data.mail.director.id:"",[$e.required])))}findSeniorAssistants(){this.http.url="users/by-role/SENIOR_ASSISTANT",this.unsubscribeSA$.next(),this.http.get().pipe(te(this.unsubscribeSA$)).subscribe({next:e=>{this.seniorAssistants=e},error:e=>{this.message.openSnackBar(e,"Fermer",800)},complete:()=>{}})}findDirectors(){this.http.url="users/by-role/DIRECTOR",this.unsubscribeDir$.next(),this.http.get().pipe(te(this.unsubscribeDir$)).subscribe({next:e=>{this.directors=e},error:e=>{this.message.openSnackBar(e,"Fermer",800)},complete:()=>{}})}findMail(){let e="";this.data.target==="ADMIN_ASSISTANT"?e="includeSeniorAssistant=true":this.data.target==="SENIOR_ASSISTANT"&&(e="includeDirector=true"),this.http.url=`incoming-external-mails/${this.data.mail.id}?${e}`,this.unsubscribeMail$.next(),this.http.get().pipe(te(this.unsubscribeMail$)).subscribe({next:t=>{this.data.mail=t},error:t=>{this.message.openSnackBar(t,"Fermer",800)},complete:()=>{this.initForm()}})}getErrorComment(e){return this.form.get(e).hasError("required")?"Ce champ est requis":this.form.get(e).hasError("minlength")?"L'annotation doit contenir au moins 10 caract\xE8res.":""}getErrorSeriorAssistant(e){return this.form.get(e).hasError("required")?"Ce champ est requis":""}onClose(){this.dialogRef.close()}triggerFileInput(){this.fileInput.nativeElement.value="",this.fileInput.nativeElement.click()}onDragOver(e){e.preventDefault(),this.isDragging=!0}onDragLeave(e){e.preventDefault(),this.isDragging=!1}onDrop(e){e.preventDefault(),this.isDragging=!1;let t=e.dataTransfer?.files;t&&this.handleFile(t[0])}onFileSelected(e){let i=e.target.files;i&&this.handleFile(i[0])}handleFile(e){if(!e||this.supportedTypes.includes(e.type)?(this.pdfService.localPdf=e,this.errorMessage="",!e||e.type==="application/pdf"||console.log(`Le fichier image ${e.name} est valide.`)):(this.errorMessage=`Le fichier "${e.name}" n'est pas un type support\xE9. Veuillez s\xE9lectionner un PDF, un PNG ou un JPG.`,this.pdfService.localPdf=null),!e||e.type!=="application/pdf"){console.warn("Le fichier n'est pas un PDF.");return}this.pdfService.localPdf=e}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.message.openSnackBar("Veuillez corriger les erreurs du formulaire.","Fermer",4e3);return}let e="";this.data.target==="ADMIN_ASSISTANT"?e="by-aa":e="by-sa",this.update(e)}onCheckboxChange(e){this.disabled=e.checked}update(e){this.http.url=`incoming-external-mails/${e}/${this.data.mail.id}`,this.http.sendFormData(JSON.stringify(this.form.value),this.pdfService.localPdf,"patch").subscribe({next:t=>{t.type===me.UploadProgress?this.uploadProgress=Math.round(t.loaded/(t.total||1)*100):t.type===me.Response&&(this.message.openSnackBar("Modification effectu\xE9 avec succ\xE8s !","Fermer",4e3),this.dialogRef.close(t.body))},error:t=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0},complete:()=>{}})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-add-comment-dialog-component"]],viewQuery:function(t,i){if(t&1&&je(en,5),t&2){let a;Le(a=Ue())&&(i.fileInput=a.first)}},features:[Et([{provide:Xt,useValue:"tinymce/tinymce.min.js"}])],decls:40,vars:13,consts:[["fileInput",""],[1,"flex","items-center","justify-between","px-4","py-2","bg-white","dark:bg-gray-900","shadow-sm"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-300"],["mat-icon-button","",3,"click"],[1,"-mx-3","md:-mx-0",3,"ngSubmit","formGroup"],[1,"w-full","mb-4"],[1,"text-lg","font-bold"],[1,"w-full"],["appearance","outline",1,"w-full"],[1,"w-full","flex","justify-end"],["formControlName","shouldSendDocument",1,"-mt-5"],["apiKey","3dejrpuyh0ucy7n25448c4t5p79rrkaiwdfxfxfdcmrum9if","licenseKey","gpl",1,"w-full",3,"formControlName","init"],["labelPosition","after"],[1,"w-full","mt-1"],[1,"mt-2"],[1,"border-gray-300"],["mat-flat-button","","cdkFocusInitial","",3,"click"],["matButton","elevated","cdkFocusInitial","",3,"click"],["type","file","accept",".jpg, .jpeg, .png, application/pdf",1,"hidden",3,"change"],["matInput","","formControlName","senior_assistant_id"],[3,"value"],["matInput","","formControlName","director_id"],["labelPosition","after",3,"change"],[1,"p-1","w-full","h-56","flex","flex-col","items-center","justify-center","border-2","border-dashed","border-gray-400","bg-white","rounded-lg","cursor-pointer","hover:border-blue-500","transition",3,"click","dragover","dragleave","drop","ngClass"],[1,"mat-18"],[1,"text-gray-600","text-lg","text-center","mt-2","px-1"],[1,"text-blue-500","font-bold"],[1,"text-lg","border-t-4","border-r-gray-100","mt-0.5"],[1,"mt-1.5"]],template:function(t,i){if(t&1){let a=S();o(0,"div",1)(1,"h2",2),l(2),r(),o(3,"button",3),d("click",function(){return p(a),u(i.onClose())}),o(4,"mat-icon"),l(5,"close"),r()()(),o(6,"mat-dialog-content")(7,"form",4),d("ngSubmit",function(){return p(a),u(i.onSubmit())}),o(8,"div",5)(9,"h1",6),l(10),r(),o(11,"p"),l(12),r()(),o(13,"div",7),_(14,rn,7,1,"mat-form-field",8)(15,mn,7,1,"mat-form-field",8),o(16,"div",9)(17,"mat-checkbox",10),l(18," Transf\xE9rer directement "),o(19,"span"),l(20),r(),l(21," pour validation "),r()()(),o(22,"div",5)(23,"h1",6),l(24),r(),o(25,"p"),l(26),r()(),h(27,"editor",11),_(28,sn,2,1,"mat-error"),_(29,cn,2,0,"mat-checkbox",12),_(30,un,11,5,"div",13),r()(),o(31,"div",14),h(32,"hr",15),r(),o(33,"mat-dialog-actions")(34,"button",16),d("click",function(){return p(a),u(i.onSubmit())}),l(35," Sauvegarder "),r(),o(36,"button",17),d("click",function(){return p(a),u(i.onClose())}),l(37," Fermer "),r()(),o(38,"input",18,0),d("change",function(T){return p(a),u(i.onFileSelected(T))}),r()}if(t&2){let a;m(2),C(" ",i.data.title," "),m(5),b("formGroup",i.form),m(3),C("",i.data.target===i.roles.ADMIN_ASSISTANT?"Validateur (Assistant Principale)":"Directeur"," "),m(2),C(" Cette personne ",i.data.target===i.roles.ADMIN_ASSISTANT?"est charg\xE9e de valider l'annoation et de transf\xE9rer le courrier au directeur concern\xE9":"est charg\xE9e du traitement de ce courrier",". "),m(2),f(i.data.target===i.roles.ADMIN_ASSISTANT?14:15),m(6),C(" ",i.data.target===i.roles.ADMIN_ASSISTANT?"\xE0 l'assistant principal":"au directeur"," "),m(4),C("Ajouter une annotation (visible par ",i.data.target===i.roles.ADMIN_ASSISTANT?"le personnel de direction":"la personne charg\xE9e du traitement",") "),m(2),C(" Votre annotation sera visible par ",i.data.target===i.roles.ADMIN_ASSISTANT?"l'Assistant Principal charg\xE9 de validation":"le Directeur charg\xE9 du traitement"," "),m(),b("formControlName",i.data.target===i.roles.ADMIN_ASSISTANT?"admin_assistant_comment":"senior_assistant_comment")("init",i.init),m(),f((a=i.form.get(i.data.target===i.roles.ADMIN_ASSISTANT?"admin_assistant_comment":"senior_assistant_comment"))!=null&&a.hasError&&i.form.touched?28:-1),m(),f(i.data.mail.scanned_document===null?29:-1),m(),f(i.disabled?30:-1)}},dependencies:[ge,Se,I,le,D,$,y,H,z,E,A,Xe,qe,Je,Qe,Ye,w,x,v,$t,Bt,We,k,N,Gt,F,V,R,Ut,Lt,O,P,Qt],styles:[".mat-mdc-dialog-container .mdc-dialog__surface{border-radius:0!important}"]})};var _n=["fileInput"],fn=n=>({"bg-gray-100 border-blue-500":n});function gn(n,e){if(n&1&&(o(0,"p",11),l(1),r()),n&2){let t=s();m(),C("Fichier : ",t.pdfService.localPdf.name," ")}}function Sn(n,e){if(n&1&&(o(0,"mat-error",12),l(1),r()),n&2){let t=s();m(),C(" ",t.errorMessage," ")}}function Cn(n,e){if(n&1){let t=S();o(0,"button",18),d("click",function(){p(t);let a=s();return u(a.onPreviewDocument())}),o(1,"div",19)(2,"mat-icon",20),l(3,"remove_red_eye"),r(),o(4,"span"),l(5,"Pr\xE9visualiser"),r()()()}}var dt=class n{dialogRef=g(_e);message=g(Z);data=g(fe);http=g(G);stateService=g(j);dialog=g(Ze);pdfService=g(Te);disabled=!1;errorMessage="";isDragging=!1;fileInput;form;uploadProgress=0;roles;xSmallOrSmall=B(()=>this.stateService.XSmallOrSmall());onClose(){this.dialogRef.close()}triggerFileInput(){this.fileInput.nativeElement.value="",this.fileInput.nativeElement.click()}onDragOver(e){e.preventDefault(),this.isDragging=!0}onDragLeave(e){e.preventDefault(),this.isDragging=!1}onDrop(e){e.preventDefault(),this.isDragging=!1;let t=e.dataTransfer?.files;t&&(this.errorMessage=this.pdfService.handleFile(t[0]))}onFileSelected(e){let i=e.target.files;i&&(this.errorMessage=this.pdfService.handleFile(i[0]))}onSubmit(){if(!this.pdfService.localPdf){this.message.openSnackBar("Veuillez s\xE9lectionner un fichier","Fermer",4e3);return}this.sendTreatmentProof()}sendTreatmentProof(){this.http.url=`incoming-${this.data.target}-mails/treatment-proof`,this.http.sendFormData(JSON.stringify({id:this.data.mail.id}),this.pdfService.localPdf,"post").subscribe({next:e=>{e.type===me.UploadProgress?this.uploadProgress=Math.round(e.loaded/(e.total||1)*100):e.type===me.Response&&(this.message.openSnackBar("Preuve de traitement ajout\xE9e avec succ\xE8s !","Fermer",4e3),this.dialogRef.close(e.body))},error:e=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0}})}onPreviewDocument(){this.pdfService.displayLocalPdf()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-treatment-prooft-dialog-component"]],viewQuery:function(t,i){if(t&1&&je(_n,5),t&2){let a;Le(a=Ue())&&(i.fileInput=a.first)}},decls:30,vars:10,consts:[["fileInput",""],[1,"flex","items-center","justify-between","px-4","py-2","bg-white","dark:bg-gray-900","shadow-sm"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-300"],["mat-icon-button","",3,"click"],[1,"-mx-3","md:-mx-0"],[1,"text-lg"],[1,"w-full","mt-1"],[1,"p-1","w-full","h-56","flex","flex-col","items-center","justify-center","border-2","border-dashed","border-gray-400","bg-white","rounded-lg","cursor-pointer","hover:border-blue-500","transition",3,"click","dragover","dragleave","drop","ngClass"],[1,"mat-18"],[1,"text-gray-600","text-lg","text-center","mt-2","px-1"],[1,"text-blue-500","font-bold"],[1,"text-lg","border-t-4","border-r-gray-100","mt-0.5","text-center"],[1,"mt-1.5"],[1,"mt-5"],[1,"border-gray-300"],["type","button","mat-stroked-button","","color","primary"],["mat-flat-button","","cdkFocusInitial","",3,"click"],["type","file","accept",".jpg, .jpeg, .png, application/pdf",1,"hidden",3,"change"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"flex","items-center"],[1,"me-2"]],template:function(t,i){if(t&1){let a=S();o(0,"div",1)(1,"h2",2),l(2),r(),o(3,"button",3),d("click",function(){return p(a),u(i.onClose())}),o(4,"mat-icon"),l(5,"close"),r()()(),o(6,"mat-dialog-content")(7,"div",4)(8,"h1",5),l(9),ie(10,"uppercase"),r(),o(11,"div",6)(12,"div",7),d("click",function(){return p(a),u(i.triggerFileInput())})("dragover",function(T){return p(a),u(i.onDragOver(T))})("dragleave",function(T){return p(a),u(i.onDragLeave(T))})("drop",function(T){return p(a),u(i.onDrop(T))}),o(13,"mat-icon",8),l(14,"attach_file"),r(),o(15,"p",9),l(16," D\xE9posez ici un fichier au format PDF ou image, ou "),o(17,"span",10),l(18," cliquez "),r(),l(19," pour le s\xE9lectionner."),r(),_(20,gn,2,1,"p",11),r(),_(21,Sn,2,1,"mat-error",12),r()()(),o(22,"div",13),h(23,"hr",14),r(),o(24,"mat-dialog-actions"),_(25,Cn,6,0,"button",15),o(26,"button",16),d("click",function(){return p(a),u(i.onSubmit())}),l(27," Enregister la preuve "),r()(),o(28,"input",17,0),d("change",function(T){return p(a),u(i.onFileSelected(T))}),r()}t&2&&(m(2),C(" ",i.data.title," "),m(7),C("OBJET DU COURRIER : ",ze(10,6,i.data.mail.subject)," "),m(3),b("ngClass",Q(8,fn,i.isDragging)),m(8),f(i.pdfService.localPdf?20:-1),m(),f(i.errorMessage!==""?21:-1),m(4),f(i.pdfService.localPdf?25:-1))},dependencies:[ge,Se,I,le,D,$,y,H,z,E,A,w,x,v,We,k,N,F,V,R,O,P,He],styles:[".mat-mdc-dialog-container .mdc-dialog__surface{border-radius:0!important}"]})};var pt=class n{constructor(e,t){this.data=e;this.dialogRef=t;e&&(this.message=e.message||this.message,e.buttonText&&(this.confirmButtonText=e.buttonText.ok||this.confirmButtonText,this.cancelButtonText=e.buttonText.cancel||this.cancelButtonText))}message="Are you sure?";confirmButtonText="Yes";cancelButtonText="Cancel";onConfirmClick(){this.dialogRef.close(!0)}static \u0275fac=function(t){return new(t||n)(_t(fe),_t(_e))};static \u0275cmp=M({type:n,selectors:[["app-confirm-component"]],decls:9,vars:3,consts:[["align","center"],["mat-flat-button","","color","primary","tabindex","1",3,"click"],["mat-raised-button","","mat-dialog-close","","tabindex","-1"]],template:function(t,i){t&1&&(o(0,"mat-dialog-content")(1,"p"),l(2),r()(),o(3,"mat-dialog-actions",0)(4,"button",1),d("click",function(){return i.onConfirmClick()}),l(5),r(),l(6,"\xA0 "),o(7,"button",2),l(8),r()()),t&2&&(m(2),C(" ",i.message," "),m(3),ft(i.confirmButtonText),m(3),ft(i.cancelButtonText))},dependencies:[ge,Se,zt,I,D,y,H,E,A,w,x,v,k,N,F,V,R,O,P],encapsulation:2})};var li=class n{constructor(e,t){this.endpoint=e;this.routePrefix=t;this.mailSearchTrigger$.pipe(xt(i=>(this.loading=!0,this.error=null,this.http.url=i.url,this.http.get(i.params).pipe(Mt(()=>this.loading=!1))))).subscribe({next:i=>{this.page=i},error:i=>this.error=i})}http=g(G);router=g(kt);stateService=g(j);dialog=g(Ze);paramsService=g(lt);message=g(Z);mailSearchTrigger$=new U;xSmallOrSmall=B(()=>this.stateService.XSmallOrSmall());page;loading=!1;error=null;criteria=new mt(1,6);findMails(e){this.mailSearchTrigger$.next(e)}goToForm(e,t){let i=new st(e,t);sessionStorage.setItem("formActionPayload",JSON.stringify(i)),this.router.navigateByUrl(`${this.routePrefix}/form`)}openAddCommentDialog(e,t){let i=new St;i.disableClose=!0,i.data={title:"Ajouter une annotation",mail:e},i.minWidth=this.xSmallOrSmall()?"96vw":"57vw",this.dialog.open(ct,i).afterClosed().subscribe(c=>{c&&t==="initial"&&this.buildInitial()})}AddTreatmentProof(e){let t=new St;t.disableClose=!0,t.data={title:"Ajouter une preuve de traitement",mail:e},this.dialog.open(dt,t).afterClosed().subscribe(a=>{a&&this.buildInitial()})}downloadDocument(e,t){this.http.url=`${this.endpoint}/${t}/${e}`,this.http.getPdfDocument().subscribe({next:i=>{let a=URL.createObjectURL(i),c=document.createElement("a");c.href=a,c.download=`${t}_${e}.pdf`,document.body.appendChild(c),c.click(),URL.revokeObjectURL(a),c.remove()},error:()=>{this.message.openSnackBar("Erreur lors du t\xE9l\xE9chargement du document","Fermer",6e3)},complete:()=>{this.message.openSnackBar("D\xE9but du t\xE9l\xE9chargement","Fermer",1e3)}})}gotToDetails(e){sessionStorage.setItem(this.endpoint.replace(/-/g,""),JSON.stringify(e)),this.router.navigateByUrl(`${this.routePrefix}/detail`)}search(e){this.findMails(this.paramsService.build(this.endpoint,e))}buildInitial(){let e=q({},this.criteria);switch(this.http.role){case"EXECUTIVE_SECRETARY":this.search(e);break;case"ADMIN_ASSISTANT":case"SENIOR_ASSISTANT":this.search(ee(q({},e),{withAnnotated:!1}));break;case"DIRECTOR":this.search(ee(q({},e),{processed:!1}));break;default:this.search(e)}}buildToProcess(){this.search(ee(q({},this.criteria),{assigned_to_me:!0}))}buildAnnotated(){(this.http.role==="ADMIN_ASSISTANT"||this.http.role==="SENIOR_ASSISTANT")&&this.search(ee(q({},this.criteria),{withAnnotated:!0}))}buildAll(){let e=q({},this.criteria);switch(this.http.role){case"ADMIN_ASSISTANT":case"SENIOR_ASSISTANT":this.search(e);break;case"DIRECTOR":this.search(ee(q({},e),{processed:void 0}));break;default:this.search(e)}}buildTreated(){this.search(ee(q({},this.criteria),{processed:!0}))}send(e){let t=this.http.role,i=t==="ADMIN_ASSISTANT"?"\xE0 l'Assistant Principal pour validation":"au Directeur pour traitement";this.dialog.open(pt,{data:{message:`Souhaitez-vous vraiment envoyer ce courrier ${i} ?`,buttonText:{ok:"Oui",cancel:"Non"}}}).afterClosed().subscribe(c=>{c&&(this.http.url=`${this.endpoint}/${e.id}`,this.http.sendFormData(JSON.stringify({shouldSendDocument:!0}),null,"patch").subscribe({next:T=>{let ut=this.page.items.findIndex(Ct=>Ct.id===T.body.id);ut!==-1&&(this.page.items[ut].status=t==="ADMIN_ASSISTANT"?"sa":"dir")},error:()=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3)},complete:()=>{this.message.openSnackBar("Op\xE9ration effectu\xE9e avec succ\xE8s !","Fermer",4e3)}}))})}static \u0275fac=function(t){Tt()};static \u0275prov=Ge({token:n,factory:n.\u0275fac,providedIn:"root"})};export{li as a,et as b,tt as c,rt as d,oi as e};
