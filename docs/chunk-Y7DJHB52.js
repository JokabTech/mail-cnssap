import{a as we,b as ke,c as Fe,d as Ue,f as Te,g as De}from"./chunk-7FHMHPOG.js";import{a as Ie,b as $e,c as Be,f as Ne,i as Oe,j as Pe,k as Le,r as Re}from"./chunk-WO3WQ2XR.js";import{b as ye}from"./chunk-OYAAD6H2.js";import{a as K}from"./chunk-NS5OZLHL.js";import{A as Se,B as G,G as z,I as j,K as H,a as U,b as T,c as ce,d as ge,e as fe,f as he,g as O,l as P,n as xe,o as be,r as _e,s as L,u as ve,v as R,x as V,y as Me,z as A}from"./chunk-JQ7ZTRAQ.js";import{a as q}from"./chunk-XHZ33VBC.js";import{$ as ae,M as D,O as re,P as I,R as $,T as y,V as B,W as ne,X as oe,Z as C,ba as se,ca as me,da as le,fa as de,ga as pe,la as ue,ma as N}from"./chunk-4LHVJXPR.js";import{C as F,k,y as ie}from"./chunk-SMWCLUEH.js";import{a as Ce,b as Ee}from"./chunk-VYQ2GNAY.js";import{Ab as S,Cb as X,Db as Q,Eb as g,Fb as t,Gb as i,Hb as f,Mb as w,Qb as c,S as h,Sb as p,Wa as s,ac as Y,ba as d,ec as n,f as b,ga as _,gb as E,gc as l,ha as v,mb as W,nc as Z,oc as ee,xc as te,zb as M}from"./chunk-JOOEKZTP.js";import"./chunk-2VMXMS7J.js";function ot(o,e){if(o&1&&(t(0,"mat-error"),n(1),i()),o&2){let r=p();s(),l(" ",r.getErrorFullName()," ")}}function at(o,e){if(o&1&&(t(0,"mat-error"),n(1),i()),o&2){let r=p();s(),l(" ",r.getErrorPhone()," ")}}function st(o,e){if(o&1&&(t(0,"mat-error"),n(1),i()),o&2){let r=p();s(),l(" ",r.getErrorPhone()," ")}}var J=class o{dialogRef=d(ke);message=d(K);data=d(Fe);http=d(q);unsubscribe$=new b;form;user;ngOnInit(){this.initForm()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}initForm(){this.form=new oe({full_name:new C(this.data.user?this.data.user.full_name:"",[y.required,y.minLength(2),y.maxLength(90)]),phone:new C(this.data.user?this.data.user.phone:"",[y.maxLength(13)]),email:new C(this.data.user?this.data.user.email:"",[y.maxLength(90)])})}getErrorFullName(){return this.form.get("full_name").hasError("required")?"Ce champ est requis":this.form.get("full_name").hasError("minlength")?"Le nom doit contenir au moins 2 caract\xE8res.":this.form.get("full_name").hasError("maxlength")?"Le nom ne peut pas d\xE9passer 90 caract\xE8res.":""}getErrorPhone(){return this.form.get("phone").hasError("maxLength")?"Ce champ doit contenir au moins 13 caract\xE8res":""}getErrorEmail(){return this.form.get("email").hasError("maxLength")?"Ce champ doit contenir au moins 90 caract\xE8res":""}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.message.openSnackBar("Veuillez corriger les erreurs du formulaire.","Fermer",4e3);return}this.data.target==="add"?this.add():this.update()}add(){this.http.url="users",this.http.save(this.form.value).pipe(h(this.unsubscribe$)).subscribe({next:e=>{this.user=e},error:e=>{this.message.openSnackBar(e,"Fermer",4e3)},complete:()=>{this.message.openSnackBar("Direction ajout\xE9e avec succ\xE8s","Fermer",4e3),this.dialogRef.close(this.user)}})}update(){this.http.url=`users/${this.data.user.id}`,this.http.update(this.form.value).pipe(h(this.unsubscribe$)).subscribe({next:e=>{this.user=e},error:e=>{this.message.openSnackBar(e,"Fermer",4e3)},complete:()=>{this.message.openSnackBar("Utilisateur modifi\xE9 avec succ\xE8s","Fermer",4e3),this.dialogRef.close(this.user)}})}onClose(){this.dialogRef.close()}static \u0275fac=function(r){return new(r||o)};static \u0275cmp=E({type:o,selectors:[["app-user-edit-component"]],decls:29,vars:5,consts:[[1,"flex","items-center","justify-between","px-4","py-2","bg-white","dark:bg-gray-900","shadow-sm"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-300"],["mat-icon-button","",3,"click"],[1,"-mx-3","md:-mx-0",3,"ngSubmit","formGroup"],[1,"w-full","mt-1"],[1,"w-full"],["type","text","matInput","","formControlName","full_name"],["type","tel","matInput","","formControlName","phone"],["type","email","matInput","","formControlName","email"],[1,"mt-5"],[1,"border-gray-300"],["mat-flat-button","","cdkFocusInitial","",3,"click"]],template:function(r,a){if(r&1&&(t(0,"div",0)(1,"h2",1),n(2),i(),t(3,"button",2),c("click",function(){return a.onClose()}),t(4,"mat-icon"),n(5,"close"),i()()(),t(6,"mat-dialog-content")(7,"form",3),c("ngSubmit",function(){return a.onSubmit()}),t(8,"div",4)(9,"mat-form-field",5)(10,"mat-label"),n(11,"D\xE9signation de la direction"),i(),f(12,"input",6),M(13,ot,2,1,"mat-error"),i(),t(14,"mat-form-field",5)(15,"mat-label"),n(16,"Acronyme de la direction"),i(),f(17,"input",7),M(18,at,2,1,"mat-error"),i(),t(19,"mat-form-field",5)(20,"mat-label"),n(21,"Acronyme de la direction"),i(),f(22,"input",8),M(23,st,2,1,"mat-error"),i()()()(),t(24,"div",9),f(25,"hr",10),i(),t(26,"mat-dialog-actions")(27,"button",11),c("click",function(){return a.onSubmit()}),n(28," Enregister "),i()()),r&2){let m,u,x;s(2),l(" ",a.data.title," "),s(5),g("formGroup",a.form),s(6),S((m=a.form.get("full_name"))!=null&&m.hasError?13:-1),s(5),S((u=a.form.get("phone"))!=null&&u.hasError?18:-1),s(5),S((x=a.form.get("email"))!=null&&x.hasError?23:-1)}},dependencies:[Te,De,k,T,U,I,re,D,F,N,ae,$,B,ne,me,le,O,P,L,_e,xe,be,R,ve,V,A,G,z,j,H],styles:[".mat-mdc-dialog-container .mdc-dialog__surface{border-radius:0!important}"]})};var mt=()=>[5,10,20],lt=o=>({item:o}),Ae=(o,e)=>e.id;function dt(o,e){o&1&&f(0,"mat-spinner")}function pt(o,e){if(o&1&&(t(0,"option",40),n(1),i()),o&2){let r=e.$implicit,a=p().$implicit;g("value",r.id)("selected",!!(a.department&&a.department.id===r.id)),s(),l(" ",r.designation," ")}}function ut(o,e){if(o&1){let r=w();t(0,"tr",31)(1,"td",32)(2,"div")(3,"h2",33),n(4),i()()(),t(5,"td",34)(6,"div",35),n(7),i()(),t(8,"td",36),n(9),i(),t(10,"td",37)(11,"select",38),c("change",function(m){let u=_(r).$implicit,x=p(2);return v(x.onDepartmentChange(u,m))}),f(12,"option",39),X(13,pt,2,3,"option",40,Ae),i()(),t(15,"td",36),n(16),i(),t(17,"td",41)(18,"button",42)(19,"mat-icon"),n(20,"more_vert"),i()()()()}if(o&2){let r=e.$implicit,a=p(2),m=Y(30);s(4),l(" ",r.full_name," "),s(3),l(" ",r.roles.length," "),s(2),l(" ",r.phone," "),s(3),g("disabled",r.department),s(),Q(a.departments),s(3),l(" ",r.email," "),s(2),g("matMenuTriggerFor",m)("matMenuTriggerData",ee(7,lt,r))}}function ct(o,e){if(o&1&&(t(0,"div",15)(1,"div",20)(2,"div",21)(3,"div",22)(4,"table",23)(5,"thead",24)(6,"tr")(7,"th",25),n(8," Nom de l'utilisateur "),i(),t(9,"th",26),n(10," Roles "),i(),t(11,"th",27),n(12," T\xE9l\xE9phone "),i(),t(13,"th",27),n(14," Direction "),i(),t(15,"th",27),n(16," E-mail "),i(),t(17,"th",28)(18,"span",29),n(19,"Op\xE9rations"),i()()()(),t(20,"tbody",30),X(21,ut,21,9,"tr",31,Ae),i()()()()()()),o&2){let r=p();s(21),Q(r.paginatedUsers)}}function gt(o,e){if(o&1){let r=w();t(0,"button",43),c("click",function(){let m=_(r).item,u=p();return v(u.onGoToUserRoles(m))}),t(1,"mat-icon"),n(2,"edit"),i(),n(3,"Gestion des r\xF4les "),i(),t(4,"button",43),c("click",function(){let m=_(r).item,u=p();return v(u.onAddDialog(m))}),t(5,"mat-icon"),n(6,"person"),i(),t(7,"span"),n(8,"Modifier information"),i()(),f(9,"mat-divider"),t(10,"button",44)(11,"mat-icon"),n(12,"delete"),i(),t(13,"span"),n(14,"Mettre \xE0 la corbeille"),i()()}}var Ve=class o{http=d(q);message=d(K);router=d(ie);dialog=d(Ue);stateService=d(Ee);xSmallOrSmall=te(()=>this.stateService.XSmallOrSmall());unsubscribe$=new b;unsubscribeD$=new b;unsubscribeF$=new b;loading=!1;users=[];paginatedUsers=[];totalLength=0;currentPage=0;pageSizeOptions=[10,16];pageSize=this.pageSizeOptions[0];searchKeyword=new C;form;departments=[];functions=[];constructor(){this.stateService.setHeader(new Ce("GESTION DES UTILISATEURS","Liste des toutes les utilisateurs","people"))}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){this.onGet(),this.findDepartment()}onGet(){this.loading=!0,this.http.url="users/with-roles",this.unsubscribe$.next(),this.http.get().pipe(h(this.unsubscribe$)).subscribe({next:e=>{console.log(e),this.users=e},error:e=>{this.loading=!1,this.message.openSnackBar(e,"Fermer",800)},complete:()=>{this.loading=!1,this.totalLength=this.users.length,this.updatePaginated()}})}findDepartment(){this.http.url="departments",this.unsubscribeD$.next(),this.http.get().pipe(h(this.unsubscribeD$)).subscribe({next:e=>{this.departments=e},error:e=>{this.loading=!1,this.message.openSnackBar(e,"Fermer",800)},complete:()=>{}})}findFunctions(){this.http.url="functions",this.unsubscribeF$.next(),this.http.get().pipe(h(this.unsubscribeF$)).subscribe({next:e=>{this.functions=e},error:e=>{this.loading=!1,this.message.openSnackBar(e,"Fermer",800)},complete:()=>{}})}updatePaginated(){let e=this.currentPage*this.pageSize,r=e+this.pageSize;this.paginatedUsers=this.users.slice(e,r)}search(){if(!this.searchKeyword.value){this.totalLength=this.users.length,this.updatePaginated();return}this.paginatedUsers=this.users.filter(e=>e.full_name.toLowerCase().includes(this.searchKeyword.value.toLowerCase())),this.totalLength=this.paginatedUsers.length}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.updatePaginated()}onGoToUserRoles(e){sessionStorage.setItem("user",JSON.stringify(e)),this.router.navigateByUrl("/user/roles")}onDepartmentChange(e,r){let a=r.target.value;this.update(e,a)}update(e,r){this.http.url=`users/${e.id}/department`,this.http.update({department_id:r}).pipe(h(this.unsubscribe$)).subscribe({next:a=>{},error:a=>{this.message.openSnackBar(a,"Fermer",100)},complete:()=>{this.message.openSnackBar("Oparation effectu\xE9e avec succ\xE8s","Fermer",4e3)}})}onAddDialog(e){let r=new we;r.disableClose=!0,r.data={title:"Modifier utilisateur",user:e,target:"update"},this.dialog.open(J,r).afterClosed().subscribe(m=>{m&&this.onGet()})}static \u0275fac=function(r){return new(r||o)};static \u0275cmp=E({type:o,selectors:[["app-users-component"]],decls:32,vars:8,consts:[["menu","matMenu"],[1,"flex","items-center","justify-between","md:h-14","md:px-4","md:bg-white","border-b","border-b-gray-300","md:border-b-0"],["mat-icon-button",""],[1,"mat-18"],[1,"px-3","py-1","text-xs","md:text-sm","text-blue-600","bg-blue-100","rounded-full","dark:bg-gray-800","dark:text-blue-400"],["mat-icon-button","","matTooltip","Nouveau utilisateur"],["mat-icon-button","","matTooltip","Actualiser"],["mat-icon-button","","matTooltip","Imprimmer"],[1,"text-base","md:text-lg","my-4","md:my-5"],[1,"md:bg-white","md:shadow-md","md:px-5","md:py-8"],[1,"flex","flex-col","md:flex-row","items-center","justify-between","gap-x-5","gap-2.5","mb-3"],[1,"w-full","md:w-5/12"],[1,"relative","w-full"],["type","text","placeholder","Rechercher un membre",1,"w-full","p-3","pl-5","pr-15","text-lg","border-2","border-gray-200","md:rounded-full","outline-none","transition","duration-300","focus:border-blue-500","focus:text-gray-700","bg-white","h-[44px]",3,"keyup","formControl"],[1,"absolute","right-4","pr-1","top-1/2","transform","-translate-y-1/2","text-gray-500","text-lg"],[1,"flex","flex-col","mt-6"],[1,"mt-12","mb-2"],["showFirstLastButtons","",1,"mt-6",2,"background-color","transparent",3,"page","length","pageSize","pageSizeOptions"],["yPosition","below",3,"overlapTrigger"],["matMenuContent",""],[1,"overflow-x-auto"],[1,"inline-block","min-w-full","align-middle"],[1,"overflow-hidden","border-y","border-gray-200","dark:border-gray-700","md:rounded-lg"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-700"],[1,"bg-gray-50","dark:bg-gray-800"],["scope","col",1,"py-3.5","px-4","text-sm","font-normal","text-left","text-gray-500","dark:text-gray-400"],["scope","col",1,"hidden","sm:table-cell","px-12","py-3.5","text-sm","font-normal","text-center","text-gray-500","dark:text-gray-400"],["scope","col",1,"hidden","sm:table-cell","px-4","py-3.5","text-sm","font-normal","text-left","text-gray-500","dark:text-gray-400"],["scope","col",1,"relative","py-3.5","px-4"],[1,"sr-only"],[1,"bg-white","divide-y","divide-gray-200","dark:divide-gray-700","dark:bg-gray-900"],[1,"hover:bg-gray-100","cursor-pointer"],[1,"px-4","py-1.5","text-sm","font-medium","whitespace-nowrap"],[1,"font-medium","text-gray-800","dark:text-white"],[1,"hidden","sm:table-cell","px-12","py-1.5","text-sm","text-center","font-medium","whitespace-nowrap"],[1,"inline","px-3","py-1","text-sm","font-normal","rounded-full","text-emerald-500","gap-x-2","bg-emerald-100/60","dark:bg-gray-800"],[1,"hidden","sm:table-cell","px-4","py-1.5","text-sm","whitespace-nowrap"],[1,"p-0","text-sm","font-medium","whitespace-nowrap","w-auto"],["name","","id","",1,"w-full","h-[35px]","border-none","box-border","transition-colors","duration-300","bg-transparent","focus:outline-none","focus:ring-1","focus:ring-blue-500","hover:ring-1","hover:ring-gray-400","dark:text-gray-200",3,"change"],["value","vide",3,"disabled"],[3,"value","selected"],[1,"px-4","py-1.5","text-sm","whitespace-nowrap"],["mat-icon-button","",3,"matMenuTriggerFor","matMenuTriggerData"],["mat-menu-item","",3,"click"],["mat-menu-item",""]],template:function(r,a){if(r&1){let m=w();t(0,"section",1)(1,"button",2)(2,"mat-icon",3),n(3,"arrow_back_ios"),i()(),t(4,"span",4),n(5),i(),t(6,"div")(7,"button",5)(8,"mat-icon"),n(9,"add"),i()(),t(10,"button",6)(11,"mat-icon"),n(12,"refresh"),i()(),t(13,"button",7)(14,"mat-icon"),n(15,"print"),i()()()(),t(16,"p",8),n(17,` Recherchez un utilisateur et cliquez les trois pour g\xE9rer ses r\xF4les.
`),i(),t(18,"div",9)(19,"div",10)(20,"div",11)(21,"div",12)(22,"input",13),c("keyup",function(){return _(m),v(a.search())}),i(),t(23,"mat-icon",14),n(24,"search"),i()()()(),M(25,dt,1,0,"mat-spinner")(26,ct,23,0,"div",15),t(27,"div",16)(28,"mat-paginator",17),c("page",function(x){return _(m),v(a.onPageChange(x))}),i()()(),t(29,"mat-menu",18,0),W(31,gt,15,0,"ng-template",19),i()}r&2&&(s(5),l(" ",a.users.length," UTILISATEURS "),s(17),g("formControl",a.searchKeyword),s(3),S(a.loading?25:26),s(3),g("length",a.users.length)("pageSize",10)("pageSizeOptions",Z(7,mt)),s(),g("overlapTrigger",!1))},dependencies:[$e,Ie,Be,Ne,Oe,Le,Pe,L,P,ye,Re,k,T,U,I,D,F,N,de,pe,$,B,se,O,fe,ce,ge,he,R,V,A,Me,G,Se,z,j,H,ue],encapsulation:2})};export{Ve as UsersComponent};
