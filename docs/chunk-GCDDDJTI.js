import{a as it}from"./chunk-OD4FTP4P.js";import{a as nt}from"./chunk-SLXF42A7.js";import{a as lt}from"./chunk-YKGDIKIX.js";import{a as rt,b as ot,c as at}from"./chunk-2B53N2V2.js";import{a as Xe,b as He,c as Je,d as Ye,f as Qe}from"./chunk-7FHMHPOG.js";import{a as We,b as re,c as oe,f as ae,i as le,j as me,k as se,o as Ze,p as et,q as tt,r as de}from"./chunk-WO3WQ2XR.js";import{b as ie}from"./chunk-OYAAD6H2.js";import{a as te}from"./chunk-NS5OZLHL.js";import{a as ne}from"./chunk-Y3YQYZ4W.js";import{B as Y,D as Le,F as Ge,G as Q,I as W,K as Z,a as O,b as $,g as L,l as G,n as Oe,o as $e,p as Ve,r as qe,s as K,u as je,v as X,w as ze,x as H,y as Be,z as J}from"./chunk-JQ7ZTRAQ.js";import{a as ee}from"./chunk-XHZ33VBC.js";import{$ as ke,M as V,O as Fe,P as q,R as j,T as _,V as z,W as De,X as Ae,Z as h,ba as Pe,ca as Re,da as Ue,la as Ne,ma as B}from"./chunk-4LHVJXPR.js";import{C as N,d as Te,k as U,q as A,y as we}from"./chunk-SMWCLUEH.js";import{a as Ke,b as D}from"./chunk-VYQ2GNAY.js";import{Ab as p,C as ge,Cb as M,Db as y,Eb as g,Fb as r,G as _e,Gb as n,H as he,Hb as S,Mb as T,Qb as I,R as xe,S as E,Sb as s,Wa as a,Wb as ve,Xb as Ce,Yb as Se,ac as be,ba as f,bc as Ie,ec as o,f as b,ga as v,gb as w,gc as u,ha as C,hc as R,mc as Ee,nc as Me,oc as ye,u as fe,xc as F,zb as c}from"./chunk-JOOEKZTP.js";import"./chunk-2VMXMS7J.js";var Pt=()=>[5,10,20],Rt=(i,t)=>t.id;function Ut(i,t){i&1&&S(0,"mat-spinner")}function Nt(i,t){if(i&1){let e=T();r(0,"tr",23),I("click",function(){let m=v(e).$implicit,x=s(2);return C(x.onSelectUser(m))}),r(1,"td",24)(2,"div")(3,"h2",25),o(4),n()()(),r(5,"td",26)(6,"div",27),o(7," iv "),n()(),r(8,"td",28),o(9),n(),r(10,"td",28),o(11),n(),r(12,"td",29)(13,"button",30)(14,"mat-icon"),o(15,"more_vert"),n()()()()}if(i&2){let e=t.$implicit;a(4),u(" ",e.full_name," "),a(5),u(" ",e.phone," "),a(2),u(" ",e.email," ")}}function Ot(i,t){if(i&1&&(r(0,"div",9)(1,"div",11)(2,"div",12)(3,"div",13)(4,"table",14)(5,"thead",15)(6,"tr")(7,"th",16),o(8," Nom de l'utilisateur "),n(),r(9,"th",17),o(10," Roles "),n(),r(11,"th",18),o(12," T\xE9l\xE9phone "),n(),r(13,"th",18),o(14," E-mail "),n(),r(15,"th",19)(16,"span",20),o(17,"Op\xE9rations"),n()()()(),r(18,"tbody",21),M(19,Nt,16,3,"tr",22,Rt),n()()()()()()),i&2){let e=s();a(19),y(e.page.items)}}function $t(i,t){if(i&1){let e=T();r(0,"div",10)(1,"mat-paginator",31),I("page",function(m){v(e);let x=s();return C(x.onPageChange(m))}),n()()}if(i&2){let e=s();a(),g("length",e.page.totalItems)("pageSize",10)("pageSizeOptions",Me(3,Pt))}}var ce=class i{dialogRef=f(He);data=f(Je);http=f(ee);message=f(te);paramsService=f(nt);stateService=f(D);xSmallOrSmall=F(()=>this.stateService.XSmallOrSmall());destroySearchKeywordSub$=new b;searchTrigger$=new b;destroy$=new b;loading=!1;page;currentPage=1;pageSizeOptions=[5,10,20,30,50,100,200,300];pageSize=this.pageSizeOptions[0];searchKeyword=new h;ngOnInit(){this.searchKeyword.valueChanges.pipe(ge(500),_e(),E(this.destroySearchKeywordSub$)).subscribe(t=>this.search(t||"")),this.searchTrigger$.pipe(E(this.destroy$),xe(t=>(this.loading=!0,this.http.url=t.url,this.http.get(t.params).pipe(he(()=>this.loading=!1))))).subscribe({next:t=>{this.page=t,console.log(this.page)},error:t=>{this.message.openSnackBar(t,"Fermer",800)}}),this.searchTrigger$.next(this.paramsService.build("users",{page:this.currentPage,pageSize:this.pageSize}))}ngOnDestroy(){this.destroySearchKeywordSub$.next(),this.destroySearchKeywordSub$.complete(),this.destroy$.next(),this.destroy$.complete()}search(t){let e=this.paramsService.build("users",{page:this.currentPage,pageSize:this.pageSize,keyword:t});this.searchTrigger$.next(e)}onPageChange(t){let e=t.pageIndex+1,l=t.pageSize,m=this.paramsService.build("users",{page:e,pageSize:l,keyword:this.searchKeyword.value});this.searchTrigger$.next(m)}onClose(){this.dialogRef.close()}onSelectUser(t){this.dialogRef.close(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-user-filter-component"]],decls:17,vars:4,consts:[[1,"flex","items-center","justify-between","px-4","py-2","bg-white","dark:bg-gray-900"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-300"],["mat-icon-button","",3,"click"],[1,"md:px-5","md:py-8"],[1,"flex","flex-col","md:flex-row","items-center","justify-between","gap-x-5","gap-2.5","mb-3"],[1,"w-full","md:w-5/12"],[1,"relative","w-full"],["type","text","placeholder","Rechercher un membre",1,"w-full","p-3","pl-5","pr-15","text-lg","border-2","border-gray-200","md:rounded-full","outline-none","transition","duration-300","focus:border-blue-500","focus:text-gray-700","bg-white","h-[44px]",3,"formControl"],[1,"absolute","right-4","pr-1","top-1/2","transform","-translate-y-1/2","text-gray-500","text-lg"],[1,"flex","flex-col","mt-6"],[1,"mt-12","mb-2"],[1,"overflow-x-auto"],[1,"inline-block","min-w-full","align-middle"],[1,"overflow-hidden","border-y","border-gray-200","dark:border-gray-700","md:rounded-lg"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-700"],[1,"dark:bg-gray-800"],["scope","col",1,"py-3.5","px-4","text-sm","font-normal","text-left","text-gray-500","dark:text-gray-400"],["scope","col",1,"hidden","sm:table-cell","px-12","py-3.5","text-sm","font-normal","text-center","text-gray-500","dark:text-gray-400"],["scope","col",1,"hidden","sm:table-cell","px-4","py-3.5","text-sm","font-normal","text-left","text-gray-500","dark:text-gray-400"],["scope","col",1,"relative","py-3.5","px-4"],[1,"sr-only"],[1,"bg-white","divide-y","divide-gray-200","dark:divide-gray-700","dark:bg-gray-900"],[1,"hover:bg-gray-100","cursor-pointer"],[1,"hover:bg-gray-100","cursor-pointer",3,"click"],[1,"px-4","py-1.5","text-sm","font-medium","whitespace-nowrap"],[1,"font-medium","text-gray-800","dark:text-white"],[1,"hidden","sm:table-cell","px-12","py-1.5","text-sm","text-center","font-medium","whitespace-nowrap"],[1,"inline","px-3","py-1","text-sm","font-normal","rounded-full","text-emerald-500","gap-x-2","bg-emerald-100/60","dark:bg-gray-800"],[1,"hidden","sm:table-cell","px-4","py-1.5","text-sm","whitespace-nowrap"],[1,"px-4","py-1.5","text-sm","whitespace-nowrap"],["mat-icon-button",""],["showFirstLastButtons","",1,"mt-6",2,"background-color","transparent",3,"page","length","pageSize","pageSizeOptions"]],template:function(e,l){e&1&&(r(0,"div",0)(1,"h2",1),o(2),n(),r(3,"button",2),I("click",function(){return l.onClose()}),r(4,"mat-icon"),o(5,"close"),n()()(),r(6,"mat-dialog-content")(7,"div",3)(8,"div",4)(9,"div",5)(10,"div",6),S(11,"input",7),r(12,"mat-icon",8),o(13,"search"),n()()()(),c(14,Ut,1,0,"mat-spinner")(15,Ot,21,0,"div",9),c(16,$t,2,4,"div",10),n()()),e&2&&(a(2),u(" ",l.data.title," "),a(9),g("formControl",l.searchKeyword),a(3),p(l.loading?14:15),a(2),p(l.page?16:-1))},dependencies:[re,We,oe,ae,le,se,me,K,G,ie,de,U,$,O,q,V,N,B,j,z,Pe,L,X,H,J,Y,Q,W,Z,Ne,Qe],styles:[".mat-mdc-dialog-container .mdc-dialog__surface{border-radius:0!important}"]})};var Vt=["fileInput"],qt=i=>({"bg-gray-100 border-blue-500":i}),k=(i,t)=>t.id;function jt(i,t){if(i&1&&(r(0,"mat-error"),o(1),n()),i&2){let e=s(2);a(),u(" ",e.getErrorSubject()," ")}}function zt(i,t){if(i&1&&(r(0,"mat-option",18),o(1),n()),i&2){let e=t.$implicit;g("value",e.id),a(),u(" ",e.designation," ")}}function Bt(i,t){if(i&1&&(r(0,"mat-error"),o(1),n()),i&2){let e=s(2);a(),u(" ",e.getErrorRequired("document_type_id")," ")}}function Lt(i,t){if(i&1&&(r(0,"mat-error"),o(1),n()),i&2){let e=s(2);a(),u(" ",e.getErrorRequired("mail_date")," ")}}function Gt(i,t){if(i&1&&(r(0,"mat-option",18),o(1),n()),i&2){let e=t.$implicit;g("value",e.id),a(),R(" ",e.full_name," (",e.department?e.department.designation:"(Aucune Direction)",") ")}}function Kt(i,t){if(i&1&&(r(0,"mat-error"),o(1),n()),i&2){let e=s(2);a(),u(" ",e.getErrorRequired("sender_id")," ")}}function Xt(i,t){if(i&1&&(r(0,"mat-option",18),o(1),n()),i&2){let e=t.$implicit;g("value",e.id),a(),R(" ",e.full_name," (",e.department?e.department.designation:"(Aucune Direction)",") ")}}function Ht(i,t){if(i&1&&(r(0,"mat-error"),o(1),n()),i&2){let e=s(2);a(),u(" ",e.getErrorRequired("director_id")," ")}}function Jt(i,t){if(i&1&&(r(0,"mat-option",18),o(1),n()),i&2){let e=t.$implicit;g("value",e.id),a(),u(" ",e.full_name," ")}}function Yt(i,t){if(i&1&&(r(0,"mat-error"),o(1),n()),i&2){let e=s(3);a(),u(" ",e.getErrorRequired("admin_assistant_id")," ")}}function Qt(i,t){if(i&1&&(r(0,"div",19)(1,"mat-form-field",15)(2,"mat-label"),o(3,"Assistant Administratif"),n(),r(4,"mat-select",36),M(5,Jt,2,2,"mat-option",18,k),n(),c(7,Yt,2,1,"mat-error"),n()()),i&2){let e,l=s(2);a(5),y(l.admin_assistants),a(2),p((e=l.form.get("admin_assistant_id"))!=null&&e.hasError?7:-1)}}function Wt(i,t){if(i&1&&(r(0,"mat-option",18),o(1),n()),i&2){let e=t.$implicit;g("value",e.id),a(),u(" ",e.full_name," ")}}function Zt(i,t){if(i&1&&(r(0,"mat-error"),o(1),n()),i&2){let e=s(3);a(),u(" ",e.getErrorRequired("senior_assistant_id")," ")}}function ei(i,t){if(i&1&&(r(0,"mat-form-field",37)(1,"mat-label"),o(2,"Assistant Principal charg\xE9 de la validation"),n(),r(3,"mat-select",38),M(4,Wt,2,2,"mat-option",18,k),n(),c(6,Zt,2,1,"mat-error"),n(),r(7,"div",39)(8,"mat-checkbox",40),o(9," Transf\xE9rer directement \xE0 l'assistant principal pour traitement "),n()()),i&2){let e,l=s(2);a(4),y(l.senior_assistants),a(2),p((e=l.form.get("senior_assistant_id"))!=null&&e.hasError?6:-1)}}function ti(i,t){if(i&1&&(r(0,"p",30),o(1),n()),i&2){let e=s(2);a(),u("Fichier : ",e.pdfService.localPdf.name," ")}}function ii(i,t){if(i&1&&(r(0,"mat-error",31),o(1),n()),i&2){let e=s(2);a(),u(" ",e.errorMessage," ")}}function ni(i,t){if(i&1){let e=T();r(0,"button",41),I("click",function(){v(e);let m=s(2);return C(m.onDisplayOnlinePdf())}),r(1,"div",42)(2,"mat-icon",43),o(3,"remove_red_eye"),n(),r(4,"span"),o(5,"Aper\xE7u de l'ancien fichier"),n()()()}}function ri(i,t){if(i&1){let e=T();r(0,"button",41),I("click",function(){v(e);let m=s(2);return C(m.onDisplayLocalPdf())}),r(1,"div",42)(2,"mat-icon",43),o(3,"remove_red_eye"),n(),r(4,"span"),o(5,"Aper\xE7u du nouveau fichier"),n()()()}}function oi(i,t){if(i&1&&(r(0,"div",12)(1,"h1",13),o(2,"Commentaire"),n(),r(3,"p"),o(4," Il s'agit du commentaire de ce courrier, il peut s'agit de n'importe quoi "),n()(),r(5,"div",14),S(6,"editor",44),n()),i&2){let e=s(2);a(6),g("init",e.init)}}function ai(i,t){if(i&1&&(r(0,"div",34)(1,"div",45),S(2,"div",46),n(),r(3,"p",47),o(4),n()()),i&2){let e=s(2);a(2),Ie("width",e.uploadProgress,"%"),a(2),R("",e.uploadProgress," % - ",e.statusMessage)}}function li(i,t){if(i&1){let e=T();r(0,"form",11),I("ngSubmit",function(){v(e);let m=s();return C(m.onSubmit())}),r(1,"div",12)(2,"h1",13),o(3,"Objet du courrier"),n(),r(4,"p"),o(5," Indiquez ici le sujet principal du courrier. Il s'agit de l'objet tel qu'il figure sur le courrier scann\xE9. Ce titre appara\xEEtra dans les listes et les recherches. "),n()(),r(6,"div",14)(7,"mat-form-field",15)(8,"mat-label"),o(9,"Objet du courrier"),n(),S(10,"input",16),c(11,jt,2,1,"mat-error"),n()(),r(12,"div",12)(13,"h1",13),o(14,"Type de document"),n(),r(15,"p"),o(16," Indiquez ici le sujet principal du courrier. Il s'agit de l'objet tel qu'il figure sur le courrier scann\xE9. Ce titre appara\xEEtra dans les listes et les recherches. "),n()(),r(17,"div",14)(18,"mat-form-field",15)(19,"mat-label"),o(20,"Type de courrier"),n(),r(21,"mat-select",17),M(22,zt,2,2,"mat-option",18,k),n(),c(24,Bt,2,1,"mat-error"),n()(),r(25,"div",12)(26,"h1",13),o(27,"Date et Exp\xE9diteur du courrier"),n(),r(28,"p"),o(29,"Saisissez la date d\u2019\xE9mission du courrier ainsi que l'exp\xE9diteur du courrier"),n()(),r(30,"div",19)(31,"mat-form-field",15)(32,"mat-label"),o(33,"Date du courrier"),n(),S(34,"input",20)(35,"mat-datepicker-toggle",21)(36,"mat-datepicker",null,1),c(38,Lt,2,1,"mat-error"),n()(),r(39,"div",19)(40,"mat-form-field",15)(41,"mat-label"),o(42,"Exp\xE9diteur du courrier"),n(),r(43,"mat-select",22),M(44,Gt,2,3,"mat-option",18,k),n(),c(46,Kt,2,1,"mat-error"),n(),r(47,"div",23)(48,"a",24),I("click",function(){v(e);let m=s();return C(m.onSearchUser())}),o(49,"Afficher les filtres"),n()()(),r(50,"div",12)(51,"h1",13),o(52,"Destinateur et Annotateur"),n(),r(53,"p"),o(54," S\xE9lectionnez le directeur en charge de traiter ce courrier, il le recevra et le traitera ains que de quel type de courrier il s'agit "),n()(),r(55,"div",19)(56,"mat-form-field",15)(57,"mat-label"),o(58,"Directeur"),n(),r(59,"mat-select",25),M(60,Xt,2,3,"mat-option",18,k),n(),c(62,Ht,2,1,"mat-error"),n()(),c(63,Qt,8,1,"div",19)(64,ei,10,1),r(65,"div",12)(66,"h1",13),o(67,"Courrier Scann\xE9"),n(),r(68,"p"),o(69," Il s'agit d'une lettre ou d\u2019un document papier qui a \xE9t\xE9 num\xE9ris\xE9 \xE0 l\u2019aide d\u2019un scanner, afin d\u2019\xEAtre conserv\xE9 ou envoy\xE9 sous format \xE9lectronique. Nous acceptons uniquement les fichiers au format PDF ou image (JPEG, PNG). "),n()(),r(70,"div",12)(71,"div",26),I("click",function(){v(e);let m=s();return C(m.triggerFileInput())})("dragover",function(m){v(e);let x=s();return C(x.onDragOver(m))})("dragleave",function(m){v(e);let x=s();return C(x.onDragLeave(m))})("drop",function(m){v(e);let x=s();return C(x.onDrop(m))}),r(72,"mat-icon",27),o(73,"attach_file"),n(),r(74,"p",28),o(75," D\xE9posez ici un fichier au format PDF ou image, ou "),r(76,"span",29),o(77," cliquez "),n(),o(78," pour le s\xE9lectionner. "),n(),c(79,ti,2,1,"p",30),n(),c(80,ii,2,1,"mat-error",31),n(),r(81,"div",32),c(82,ni,6,0,"button",33),c(83,ri,6,0,"button",33),n(),c(84,oi,7,1),c(85,ai,5,4,"div",34),r(86,"div",32)(87,"button",35),o(88),n()()()}if(i&2){let e,l,m,x,P,ue=be(37),d=s();g("formGroup",d.form),a(11),p((e=d.form.get("subject"))!=null&&e.hasError?11:-1),a(11),y(d.documentTypes),a(2),p((l=d.form.get("document_type_id"))!=null&&l.hasError?24:-1),a(10),g("matDatepicker",ue),a(),g("for",ue),a(3),p((m=d.form.get("mail_date"))!=null&&m.hasError?38:-1),a(6),y(d.senders),a(2),p((x=d.form.get("sender_id"))!=null&&x.hasError?46:-1),a(14),y(d.directors),a(2),p((P=d.form.get("director_id"))!=null&&P.hasError?62:-1),a(),p(d.role===d.roles.EXECUTIVE_SECRETARY?63:d.role===d.roles.ADMIN_ASSISTANT?64:-1),a(8),g("ngClass",ye(17,qt,d.isDragging)),a(8),p(d.pdfService.localPdf?79:-1),a(),p(d.errorMessage!==""?80:-1),a(2),p(d.mail&&d.mail.scanned_document?82:-1),a(),p(d.pdfService.localPdf?83:-1),a(),p(d.role!==d.roles.EXECUTIVE_SECRETARY?84:-1),a(),p(d.uploadProgress>0?85:-1),a(3),u(" ",d.formActionPayload&&d.formActionPayload.action==="add"?"Enregister le courrier":"Modifier le courrier"," ")}}function mi(i,t){i&1&&(r(0,"div",9),S(1,"mat-spinner"),n())}var pe=class i{unsubscribeDir$=new b;unsubscribeSender$=new b;unsubscribeDoc$=new b;unsubscribeMail$=new b;unsubscribeAA$=new b;unsubscribeSA$=new b;http=f(ee);message=f(te);stateService=f(D);pdfService=f(at);router=f(we);fileInput;form;isDragging=!1;end=!1;uploadProgress=0;statusMessage="";supportedTypes=["application/pdf","image/png","image/jpeg"];errorMessage="";directors=[];senders=[];documentTypes=[];formActionPayload;mail;dialog=f(Ye);init={plugins:"lists link image table code help wordcount"};role=this.http.role;roles=ne;admin_assistants=[];senior_assistants=[];isFormReady=!1;xSmallOrSmall=F(()=>this.stateService.XSmallOrSmall());constructor(){this.formActionPayload=JSON.parse(sessionStorage.getItem("formActionPayload")),this.stateService.setHeader(new Ke("FORMULAIRE D'AJOUT DU COURRIER ENTRANT INTERNE","Liste des correspondances internes re\xE7ues","flight_land"))}ngOnDestroy(){this.pdfService.localPdf=null,this.pdfService.onLinePdf=null,sessionStorage.removeItem("incomingExternalMail"),this.unsubscribeDir$.next(),this.unsubscribeDir$.complete(),this.unsubscribeSender$.next(),this.unsubscribeSender$.complete(),this.unsubscribeDoc$.next(),this.unsubscribeDoc$.complete(),this.unsubscribeAA$.next(),this.unsubscribeAA$.complete(),this.unsubscribeSA$.next(),this.unsubscribeSA$.complete(),this.unsubscribeMail$.next(),this.unsubscribeMail$.complete()}ngOnInit(){this.loadData()}initForm(){this.form=new Ae({subject:new h(this.mail?this.mail.subject:"",[_.required,_.minLength(5),_.maxLength(255)]),mail_date:new h(this.mail?this.mail.mail_date:"",[_.required]),sender_id:new h(this.mail&&this.mail.sender?this.mail.sender.id:"",[_.required]),director_id:new h(this.mail&&this.mail.director?this.mail.director.id:"",[_.required]),document_type_id:new h(this.mail&&this.mail.documentType?this.mail.documentType.id:"",[_.required])}),this.role==="EXECUTIVE_SECRETARY"?this.form.addControl("admin_assistant_id",new h(this.mail&&this.mail.adminAssistant?this.mail.adminAssistant.id:"",[_.required])):this.role==="ADMIN_ASSISTANT"?(this.form.addControl("admin_assistant_comment",new h(this.mail?this.mail.admin_assistant_comment:"",[_.minLength(10)])),this.form.addControl("senior_assistant_id",new h(this.mail&&this.mail.seniorAssistant?this.mail.seniorAssistant.id:"",[_.required])),this.form.addControl("should_send_document",new h(!1,[_.required]))):this.role==="SENIOR_ASSISTANT"&&(this.form.addControl("senior_assistant_comment",new h(this.mail?this.mail.senior_assistant_comment:"",[_.minLength(10)])),this.form.addControl("should_send_document",new h(!1,[_.required])))}getErrorSubject(){return this.form.get("subject").hasError("required")?"Ce champ est requis":this.form.get("subject").hasError("minlength")?"L'objet doit contenir au moins 3 caract\xE8res.":this.form.get("subject").hasError("maxlength")?"L'objet ne peut pas d\xE9passer 200 caract\xE8res.":""}getErrorComment(){return this.form.get("comment").hasError("required")?"Ce champ est requis":this.form.get("comment").hasError("minlength")?"Le commentaire doit contenir au moins 3 caract\xE8res.":""}getErrorRequired(t){return this.form.get(t).hasError("required")?"Ce champ est requis":""}triggerFileInput(){this.fileInput.nativeElement.value="",this.fileInput.nativeElement.click()}onDragOver(t){t.preventDefault(),this.isDragging=!0}onDragLeave(t){t.preventDefault(),this.isDragging=!1}onDrop(t){t.preventDefault(),this.isDragging=!1;let e=t.dataTransfer?.files;e&&this.pdfService.handleFile(e[0])}onFileSelected(t){let l=t.target.files;l&&this.pdfService.handleFile(l[0])}add(){this.http.url="incoming-internal-mails",this.http.sendFormData(JSON.stringify(this.form.value),this.pdfService.localPdf,"post").subscribe({next:t=>{t.type===A.UploadProgress?this.uploadProgress=Math.round(t.loaded/(t.total||1)*100):t.type===A.Response&&(this.message.openSnackBar("Enregistrement effectu\xE9 avec succ\xE8s !","Fermer",4e3),this.form.reset(),this.pdfService.localPdf=null,this.end=!0)},error:t=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0},complete:()=>{this.router.navigateByUrl("/mails/incoming/internal")}})}update(){this.http.url=`incoming-internal-mails/${this.formActionPayload.data.id}`,this.http.sendFormData(JSON.stringify(this.form.value),this.pdfService.localPdf,"patch").subscribe({next:t=>{t.type===A.UploadProgress?this.uploadProgress=Math.round(t.loaded/(t.total||1)*100):t.type===A.Response&&this.message.openSnackBar("Modification effectu\xE9 avec succ\xE8s !","Fermer",4e3)},error:t=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0},complete:()=>{this.router.navigateByUrl("/mails/incoming/internal")}})}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.message.openSnackBar("Veuillez corriger les erreurs du formulaire.","Fermer",4e3);return}this.formActionPayload.action==="add"?this.add():this.update()}onDisplayOnlinePdf(){this.pdfService.displayOnlinePdf(this.mail.id,"document","incoming-internal-mails")}onDisplayLocalPdf(){this.pdfService.displayLocalPdf()}loadData(){let t={directors:this.getDirectors(),documentTypes:this.getDocumentTypes(),senders:this.getSenders()};this.role==="EXECUTIVE_SECRETARY"?t.admin_assistants=this.getAdminAssistant():this.role==="ADMIN_ASSISTANT"&&(t.senior_assistants=this.getSeniorAssistant()),this.formActionPayload.action==="edit_mail"&&(t.mail=this.getMail()),fe(t).subscribe({next:e=>{this.directors=e.directors,this.documentTypes=e.documentTypes,this.senders=e.senders,this.role==="EXECUTIVE_SECRETARY"?this.admin_assistants=e.admin_assistants:this.role==="ADMIN_ASSISTANT"&&(this.senior_assistants=e.senior_assistants),this.formActionPayload.action==="edit_mail"&&(this.mail=e.mail),this.initForm(),this.isFormReady=!0},error:e=>{this.message.openSnackBar("Une erreur est survenue lors du chargement des donn\xE9es. Veuillez r\xE9essayer.","Fermer",800)}})}getDirectors(){return this.http.url="users/by-role/DIRECTOR",this.http.get().pipe(E(this.unsubscribeDir$))}getDocumentTypes(){return this.http.url="document-types",this.http.get().pipe(E(this.unsubscribeDoc$))}getSenders(){return this.http.url="users/with-roles",this.http.get().pipe(E(this.unsubscribeSender$))}getAdminAssistant(){return this.http.url="users/by-role/ADMIN_ASSISTANT",this.http.get().pipe(E(this.unsubscribeAA$))}getSeniorAssistant(){return this.http.url="users/by-role/SENIOR_ASSISTANT",this.http.get().pipe(E(this.unsubscribeSA$))}getMail(){return this.http.url=`incoming-internal-mails/${this.formActionPayload.data.id}`,this.http.get().pipe(E(this.unsubscribeMail$))}onSearchUser(){let t=new Xe;t.disableClose=!0,t.data={title:"Rechercher un utilisateur"},t.minWidth=this.xSmallOrSmall()?"96vw":"57vw",this.dialog.open(ce,t).afterClosed().subscribe(l=>{this.form.get("sender_id")?.setValue(l.id)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-incoming-internal-mail-form-impl-component"]],viewQuery:function(e,l){if(e&1&&ve(Vt,5),e&2){let m;Ce(m=Se())&&(l.fileInput=m.first)}},features:[Ee([{provide:rt,useValue:"tinymce/tinymce.min.js"},lt()])],decls:18,vars:2,consts:[["fileInput",""],["picker1",""],[1,"flex","items-center","justify-between","md:h-14","md:px-4","md:bg-gray-50","border-b","border-b-gray-300","md:border-b-0"],[1,"px-3","py-1","text-xs","md:text-sm","text-blue-600","bg-blue-100","rounded-full","dark:bg-gray-800","dark:text-blue-400"],["mat-icon-button","","matTooltip","Actualiser"],["mat-icon-button","","matTooltip","Imprimmer",3,"disabled"],[1,"w-full","md:px-16"],[1,"mt-7","text-lg","md:px-4","hidden","md:block"],[1,"w-full","flex","flex-wrap","mt-4",3,"formGroup"],[1,"flex","items-center","justify-center","my-10"],["type","file","accept",".jpg, .jpeg, .png, application/pdf",1,"hidden",3,"change"],[1,"w-full","flex","flex-wrap","mt-4",3,"ngSubmit","formGroup"],[1,"w-full","md:px-4","mb-4"],[1,"text-lg","font-bold"],[1,"w-full","md:px-4"],[1,"w-full"],["type","text","matInput","","formControlName","subject"],["matInput","","formControlName","document_type_id"],[3,"value"],[1,"w-full","md:w-6/12","md:px-4"],["matInput","","formControlName","mail_date",3,"matDatepicker"],["matIconSuffix","",3,"for"],["matInput","","formControlName","sender_id"],[1,"w-full","flex","justify-end","-mt-5"],["mat-button","",3,"click"],["matInput","","formControlName","director_id"],[1,"w-full","h-56","flex","flex-col","items-center","justify-center","border-2","border-dashed","border-gray-400","bg-[#e0e2ec]","rounded-lg","cursor-pointer","hover:border-blue-500","transition",3,"click","dragover","dragleave","drop","ngClass"],[1,"mat-18"],[1,"text-gray-600","text-lg","text-center","mt-2","px-1"],[1,"text-blue-500","font-bold"],[1,"text-lg","border-t-4","border-r-gray-100","mt-0.5"],[1,"mt-1.5"],[1,"w-full","md:px-4","mt-4","flex","flex-col-reverse","md:flex-row","justify-end","items-center","gap-2.5"],["type","button","mat-stroked-button","","color","primary",1,"w-full","sm:w-auto"],[1,"w-full","md:px-4","mt-3.5"],["matTooltip","Cliquez pour Enregister le courrier","mat-flat-button","",1,"w-full","sm:w-auto"],["matInput","","formControlName","admin_assistant_id"],[1,"w-full","md:w-6/12"],["matInput","","formControlName","senior_assistant_id"],[1,"w-full","flex","justify-end"],["formControlName","should_send_document",1,"-mt-5"],["type","button","mat-stroked-button","","color","primary",1,"w-full","sm:w-auto",3,"click"],[1,"flex","items-center"],[1,"me-2"],["formControlName","admin_assistant_comment","apiKey","3dejrpuyh0ucy7n25448c4t5p79rrkaiwdfxfxfdcmrum9if","licenseKey","gpl",3,"init"],[1,"w-full","bg-gray-200","rounded-full","h-2.5"],[1,"bg-blue-600","h-2.5","rounded-full","transition-all","duration-300","ease-in-out"],[1,"text-center","text-sm","text-gray-500","mt-2"]],template:function(e,l){if(e&1){let m=T();r(0,"section",2),S(1,"app-back-component"),r(2,"span",3),o(3," CNSSAP "),n(),r(4,"div")(5,"button",4)(6,"mat-icon"),o(7,"refresh"),n()(),r(8,"button",5)(9,"mat-icon"),o(10,"remove_red_eye"),n()()()(),r(11,"div",6)(12,"h1",7),o(13,"FORMULAIRE D'AJOUT D'UN NOUVEAU COURRIER ENTRANT EXTERNE"),n(),c(14,li,89,19,"form",8)(15,mi,2,0,"div",9),r(16,"input",10,0),I("change",function(P){return v(m),C(l.onFileSelected(P))}),n()()}e&2&&(a(8),g("disabled",!l.pdfService.localPdf),a(6),p(l.isFormReady?14:15))},dependencies:[re,oe,ae,le,se,me,K,qe,Oe,$e,Ve,G,ie,de,Ze,et,tt,U,Te,$,O,q,Fe,V,N,B,ke,j,z,De,Re,Ue,L,X,je,H,ze,J,Be,Y,Q,Ge,Le,W,Z,ot,it],encapsulation:2})};function si(i,t){i&1&&S(0,"app-incoming-internal-mail-form-impl-component")}function di(i,t){i&1&&(r(0,"h1"),o(1,"Vous n'avez pas le droit d'acc\xE8der a cette fonctionnalit\xE9"),n())}var dt=class i{stateService=f(D);role=F(()=>this.stateService.role());roles=ne;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-incoming-internal-mail-form-component"]],decls:2,vars:1,template:function(e,l){e&1&&c(0,si,1,0,"app-incoming-internal-mail-form-impl-component")(1,di,2,0,"h1"),e&2&&p(l.role()===l.roles.EXECUTIVE_SECRETARY||l.role()===l.roles.ADMIN_ASSISTANT?0:1)},dependencies:[pe],encapsulation:2})};export{dt as IncomingInternalMailFormComponent};
