import{a as jt}from"./chunk-SLXF42A7.js";import{b as Ut,c as Me}from"./chunk-2B53N2V2.js";import{a as pt,b as de,c as pe,d as Ze,e as Bt,f as ue,g as _e}from"./chunk-7FHMHPOG.js";import{b as fe,c as ge,d as $t,e as Gt,f as Ce,i as Se,j as Lt,k as be,r as he}from"./chunk-WO3WQ2XR.js";import{b as ce}from"./chunk-OYAAD6H2.js";import{a as Z}from"./chunk-NS5OZLHL.js";import{a as W}from"./chunk-Y3YQYZ4W.js";import{A as Rt,B as V,D as Ot,F as Pt,G as R,I as O,K as P,a as B,b as I,c as ae,d as At,e as le,f as me,g as D,l as k,n as Nt,o as We,r as Ft,s as w,v as A,w as Vt,x as N,y as se,z as F}from"./chunk-JQ7ZTRAQ.js";import{a as $}from"./chunk-XHZ33VBC.js";import{$ as Ke,M as j,O as U,P as E,R as Et,T as dt,V as ze,W as Je,X as Xe,Z as Y,ba as yt,ca as Qe,da as Ye,ea as Dt,fa as kt,ga as wt,ma as y}from"./chunk-4LHVJXPR.js";import{C as v,c as Tt,d as re,f as vt,i as He,j as It,k as T,q as Q,y as qe}from"./chunk-SMWCLUEH.js";import{b as H}from"./chunk-VYQ2GNAY.js";import{$a as mt,Ab as f,C as ft,Cb as J,Db as X,Eb as b,Fb as o,G as gt,Gb as r,H as Ct,Hb as M,Mb as S,Qb as u,R as St,S as te,Sb as s,Ta as ht,Wa as m,Wb as Ge,Xb as Le,Y as bt,Yb as je,ab as Mt,ac as oe,ba as g,ec as l,f as G,fc as st,ga as d,gb as x,gc as C,ha as p,mb as xt,oc as K,pb as z,pc as ie,qc as Ue,rc as ct,u as _t,xc as L,zb as _}from"./chunk-JOOEKZTP.js";import{a as q,b as ee}from"./chunk-2VMXMS7J.js";var xe=class{constructor(e,t){this.action=e;this.data=t}};var et=(a=>(a.TO_ADMIN_ASSISTANT="aa",a.TO_SENIOR_ASSISTANT="sa",a.TO_DIRECTOR="dir",a.TO_BE_PROCESSED="proc",a))(et||{});var tt=(c=>(c.INITIAL="initial",c.ANNOTATED="annotated",c.ALL="all",c.TREATED="treated",c.TO_PROCESS="to-process",c))(tt||{});function ni(n,e){if(n&1){let t=S();o(0,"button",0),u("click",function(){d(t);let a=s();return p(a.onMenuItemClicked("display_document",a.item))}),o(1,"mat-icon"),l(2,"remove_red_eye"),r(),o(3,"span"),l(4,"Aper\xE7u document"),r()()}}function oi(n,e){if(n&1){let t=S();o(0,"button",0),u("click",function(){d(t);let a=s();return p(a.onMenuItemClicked("display_proof",a.item))}),o(1,"mat-icon"),l(2,"remove_red_eye"),r(),o(3,"span"),l(4,"Aper\xE7u preuve"),r()()}}function ri(n,e){if(n&1){let t=S();o(0,"button",0),u("click",function(){d(t);let a=s();return p(a.onMenuItemClicked("download_mail",a.item))}),o(1,"mat-icon"),l(2,"cloud_download"),r(),o(3,"span"),l(4,"T\xE9l\xE9charger courrier"),r()()}}function ai(n,e){if(n&1){let t=S();o(0,"button",0),u("click",function(){d(t);let a=s();return p(a.onMenuItemClicked("download_proof",a.item))}),o(1,"mat-icon"),l(2,"get_app"),r(),o(3,"span"),l(4,"T\xE9l\xE9charger preuve"),r()()}}function li(n,e){if(n&1){let t=S();o(0,"button",0),u("click",function(){d(t);let a=s(2);return p(a.onMenuItemClicked("add_comment",a.item))}),o(1,"mat-icon"),l(2,"add"),r(),o(3,"span"),l(4,"Ajouter Annotation"),r()()}}function mi(n,e){if(n&1){let t=S();o(0,"button",0),u("click",function(){d(t);let a=s(2);return p(a.onMenuItemClicked("assign_agent",a.item))}),o(1,"mat-icon"),l(2,"person"),r(),o(3,"span"),l(4,"Assigner un agent"),r()()}}function si(n,e){if(n&1){let t=S();M(0,"mat-divider"),_(1,li,5,0,"button",1),o(2,"button",0),u("click",function(){d(t);let a=s();return p(a.onMenuItemClicked("treatment_proof",a.item))}),o(3,"mat-icon"),l(4,"attach_file"),r(),o(5,"span"),l(6,"Joindre une preuve"),r()(),o(7,"button",0),u("click",function(){d(t);let a=s();return p(a.onMenuItemClicked("share_mail",a.item))}),o(8,"mat-icon"),l(9,"shared"),r(),o(10,"span"),l(11,"Partager le courrier"),r()(),_(12,mi,5,0,"button",1)}if(n&2){let t=s();m(),f(t.role!==t.roles.DIRECTOR?1:-1),m(11),f(t.role===t.roles.DIRECTOR?12:-1)}}function ci(n,e){if(n&1){let t=S();o(0,"button",0),u("click",function(){d(t);let a=s(2);return p(a.onMenuItemClicked("delete_mail",a.item))}),o(1,"mat-icon"),l(2,"delete"),r(),o(3,"span"),l(4,"Mettre \xE0 la corbeille"),r()()}}function di(n,e){if(n&1){let t=S();M(0,"mat-divider"),o(1,"button",0),u("click",function(){d(t);let a=s();return p(a.onMenuItemClicked("edit_mail",a.item))}),o(2,"mat-icon"),l(3,"edit"),r(),o(4,"span"),l(5,"Modifier ce courrier"),r()(),_(6,ci,5,0,"button",1)}if(n&2){let t=s();m(6),f(t.role!==t.roles.MAIL_ARCHIVES_AGENT?6:-1)}}var it=class n{role;item;actionSelected=new z;roles=W;isExternalMail=!1;ngOnInit(){this.isExternalMail="sender"in this.item&&typeof this.item.sender=="string"}onMenuItemClicked(e,t){this.actionSelected.emit({action:e,data:t})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=x({type:n,selectors:[["app-incoming-mail-menu-component"]],inputs:{role:"role",item:"item"},outputs:{actionSelected:"actionSelected"},decls:16,vars:6,consts:[["mat-menu-item","",3,"click"],["mat-menu-item",""]],template:function(t,i){t&1&&(o(0,"button",0),u("click",function(){return i.onMenuItemClicked("view_detail",i.item)}),o(1,"mat-icon"),l(2,"list"),r(),l(3,"Voir le d\xE9tail "),r(),_(4,ni,5,0,"button",1),_(5,oi,5,0,"button",1),M(6,"mat-divider"),o(7,"button",0),u("click",function(){return i.onMenuItemClicked("receipt",i.item)}),o(8,"mat-icon"),l(9,"print"),r(),o(10,"span"),l(11,"Accus\xE9 de r\xE9ception"),r()(),_(12,ri,5,0,"button",1),_(13,ai,5,0,"button",1),_(14,si,13,2),_(15,di,7,1)),t&2&&(m(4),f(i.item.scanned_document?4:-1),m(),f(i.item.treatment_proof&&i.role!==i.roles.MAIL_ARCHIVES_AGENT?5:-1),m(7),f(i.item.scanned_document?12:-1),m(),f(i.item.treatment_proof&&i.role!==i.roles.MAIL_ARCHIVES_AGENT?13:-1),m(),f(i.role!==i.roles.MAIL_ARCHIVES_AGENT&&i.role!==i.roles.EXECUTIVE_SECRETARY?14:-1),m(),f(i.isExternalMail&&i.role!==i.roles.EXECUTIVE_SECRETARY||i.isExternalMail&&i.role!==i.roles.MAIL_ARCHIVES_AGENT?15:-1))},dependencies:[T,I,B,E,v,y,D,ae,k,w,A,N,F,V,Rt,R,O,P],encapsulation:2})};var pi=n=>({item:n}),ui=(n,e)=>e.id;function _i(n,e){n&1&&M(0,"img",9)}function fi(n,e){if(n&1){let t=S();o(0,"button",16),u("click",function(){d(t);let a=s(2).$implicit,c=s();return p(c.onAddComment(a))}),l(1,"Annoter"),r()}}function gi(n,e){n&1&&(o(0,"button",17)(1,"mat-icon"),l(2,"check"),r()())}function Ci(n,e){if(n&1){let t=S();o(0,"button",19),u("click",function(){d(t);let a=s(3).$implicit,c=s();return p(c.onSend(a))}),l(1,"Envoyer"),r()}}function Si(n,e){if(n&1&&_(0,gi,3,0,"button",17)(1,Ci,2,0,"button",18),n&2){let t=s(2).$implicit,i=s();f(t.status===i.status.TO_SENIOR_ASSISTANT||t.status===i.status.TO_DIRECTOR||t.status===i.status.TO_BE_PROCESSED?0:1)}}function bi(n,e){if(n&1&&_(0,fi,2,0,"button",15)(1,Si,2,1),n&2){let t=s(2);f(t.tab===t.tabs.INITIAL?0:1)}}function hi(n,e){if(n&1){let t=S();o(0,"button",16),u("click",function(){d(t);let a=s(2).$implicit,c=s();return p(c.onAddComment(a))}),l(1,"Annoter"),r()}}function Mi(n,e){n&1&&(o(0,"button",17)(1,"mat-icon"),l(2,"check"),r()())}function xi(n,e){if(n&1){let t=S();o(0,"button",19),u("click",function(){d(t);let a=s(3).$implicit,c=s();return p(c.onSend(a))}),l(1,"Envoyer"),r()}}function Ti(n,e){if(n&1&&_(0,Mi,3,0,"button",17)(1,xi,2,0,"button",18),n&2){let t=s(2).$implicit,i=s();f(t.status===i.status.TO_DIRECTOR||t.status===i.status.TO_BE_PROCESSED?0:1)}}function vi(n,e){if(n&1&&_(0,hi,2,0,"button",15)(1,Ti,2,1),n&2){let t=s(2);f(t.tab===t.tabs.INITIAL?0:1)}}function Ii(n,e){if(n&1){let t=S();o(0,"button",16),u("click",function(){d(t);let a=s(2).$implicit,c=s();return p(c.onAddProof(a))}),l(1,"Joindre preuve"),r()}}function Ei(n,e){n&1&&(o(0,"button",17)(1,"mat-icon"),l(2,"check"),r()())}function yi(n,e){if(n&1&&_(0,Ei,3,0,"button",17),n&2){let t=s(2).$implicit,i=s();f(t.status===i.status.TO_BE_PROCESSED?0:-1)}}function Di(n,e){if(n&1&&_(0,Ii,2,0,"button",15)(1,yi,1,1),n&2){let t=s().$implicit,i=s();f(i.tab===i.tabs.INITIAL||t.status===i.status.TO_DIRECTOR?0:1)}}function ki(n,e){n&1&&M(0,"hr",14)}function wi(n,e){if(n&1&&(o(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7),M(4,"img",8),_(5,_i,1,0,"img",9),r(),_(6,bi,2,1)(7,vi,2,1)(8,Di,2,1),r(),o(9,"button",10)(10,"mat-icon",11),l(11,"more_vert"),r()()(),o(12,"h1",12),l(13),o(14,"span"),l(15),r()(),o(16,"div",13)(17,"div")(18,"span"),l(19,"Date du courrier : "),r(),o(20,"span"),l(21),ie(22,"date"),r(),l(23," \xA0 | \xA0 "),o(24,"span"),l(25,"Date d'enregistrement : "),r(),o(26,"span"),l(27),ie(28,"date"),r()(),o(29,"div")(30,"span"),l(31,"Exp\xE9diteur : "),r(),o(32,"span"),l(33),r()()()(),_(34,ki,1,0,"hr",14)),n&2){let t=e.$implicit,i=e.$index,a=e.$count,c=s(),h=oe(4);m(4),b("src",t.scanned_document?"assets/images/pdf.png":"assets/images/notFile.png",ht),m(),f(t.treatment_proof?5:-1),m(),f(c.role===c.roles.ADMIN_ASSISTANT?6:c.role===c.roles.SENIOR_ASSISTANT?7:c.role===c.roles.DIRECTOR?8:-1),m(3),b("matMenuTriggerFor",h)("matMenuTriggerData",K(17,pi,t)),m(4),C(" ",t.subject," \xA0 "),m(2),C("#",t.id),m(6),C(" ",ct(22,11,t.mail_date,"dd/MM/yyyy")," "),m(6),C(" ",ct(28,14,t.create_at,"dd/MM/yyyy")," "),m(6),C(" ",c.getSenderDisplayName(t)," "),m(),f(i!==a-1?34:-1)}}function Ai(n,e){if(n&1){let t=S();o(0,"app-incoming-mail-menu-component",20),u("actionSelected",function(a){d(t);let c=s();return p(c.onActinSelected(a))}),r()}if(n&2){let t=e.item,i=s();b("role",i.role)("item",t)}}var Ht=class n{httpService=g($);tab="initial";mails=void 0;menuSelected=new z;roles=W;status=et;tabs=tt;role=this.httpService.role;onActinSelected(e){this.menuSelected.emit(e)}ngOnInit(){}onSend(e){this.menuSelected.emit(new xe("send",e))}onAddComment(e){this.menuSelected.emit(new xe("add_comment",e))}onAddProof(e){this.menuSelected.emit(new xe("treatment_proof",e))}getSenderDisplayName(e){return typeof e.sender=="string"?e.sender:e.sender.full_name}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=x({type:n,selectors:[["app-incoming-mail-grid-component"]],inputs:{tab:"tab",mails:"mails"},outputs:{menuSelected:"menuSelected"},decls:6,vars:1,consts:[["mailMenu","matMenu"],[1,"grid","grid-cols-1","gap-8","md:grid-cols-2","lg:grid-cols-3","my-6"],["yPosition","below",3,"overlapTrigger"],["matMenuContent",""],[1,"md:p-3","border-2","border-transparent","rounded-lg","transition-all","duration-300","hover:border-blue-500"],[1,"flex","justify-between"],[1,"flex","items-center","gap-4"],[1,"relative","w-20","h-20"],["alt","Document Statut",1,"absolute","top-0","left-0","h-20","w-20","z-10",3,"src"],["src","assets/images/pdf.png","alt","Traitement Prouv\xE9",1,"absolute","bottom-0","right-0","h-16","w-16","z-20","translate-x-3","translate-y-3"],["mat-icon-button","",3,"matMenuTriggerFor","matMenuTriggerData"],[1,"mat-18"],[1,"mt-4","text-xl","font-semibold","text-gray-800"],[1,"mt-2","text-gray-500","dark:text-gray-400"],[1,"block","sm:hidden","border","border-blue-950"],["matTooltip","Cliquer pour annoter","mat-button",""],["matTooltip","Cliquer pour annoter","mat-button","",3,"click"],["matTooltip","Cliquez pour afficher l'Assistant Principal","mat-icon-button",""],["matTooltip","Cliquer pour envoyer \xE0 l'Assistant Principal pour  validation","mat-button",""],["matTooltip","Cliquer pour envoyer \xE0 l'Assistant Principal pour  validation","mat-button","",3,"click"],[3,"actionSelected","role","item"]],template:function(t,i){t&1&&(o(0,"section",1),J(1,wi,35,19,null,null,ui),r(),o(3,"mat-menu",2,0),xt(5,Ai,1,2,"ng-template",3),r()),t&2&&(m(),X(i.mails),m(2),b("overlapTrigger",!1))},dependencies:[T,I,B,E,U,j,v,y,D,le,At,me,k,w,A,N,F,se,V,R,O,P,it,It],encapsulation:2})};var Ni=(n,e)=>e.id;function Fi(n,e){n&1&&(o(0,"div",1)(1,"span",14),l(2," Titre (55) "),r(),o(3,"button",15)(4,"mat-icon"),l(5," view_module "),r()()())}function Vi(n,e){if(n&1&&(o(0,"option",27),l(1),r()),n&2){let t=e.$implicit;b("value",t.id),m(),C(" ",t.designation," ")}}function Ri(n,e){n&1&&(o(0,"div",29),l(1," Plage de dates invalide : la date de d\xE9but doit \xEAtre ant\xE9rieure \xE0 la date de fin. "),r())}function Oi(n,e){if(n&1){let t=S();o(0,"form",16),u("ngSubmit",function(){d(t);let a=s();return p(a.onSubmit())}),o(1,"div",17)(2,"div",18)(3,"div")(4,"label",19),l(5,"Date de d\xE9but"),r(),M(6,"input",20),r()(),o(7,"div",21)(8,"div")(9,"label",22),l(10,"Date de fin"),r(),M(11,"input",23),r()(),o(12,"div",21)(13,"label",24),l(14,"Direction"),r(),o(15,"select",25)(16,"option",26),l(17,"Toutes les directions"),r(),J(18,Vi,2,2,"option",27,Ni),r()(),o(20,"button",28),l(21,"Rechercher"),r()(),_(22,Ri,2,0,"div",29),M(23,"hr",30),r()}if(n&2){let t=s();b("formGroup",t.form),m(18),X(t.departements),m(2),b("disabled",t.form.invalid),m(2),f(t.form.errors!=null&&t.form.errors.dateRangeInvalid?22:-1)}}function Pi(n,e){n&1&&(o(0,"mat-button-toggle-group",13)(1,"mat-button-toggle",31)(2,"span"),l(3,"Affichage Grille"),r(),o(4,"mat-icon",32),l(5,"view_list"),r()(),o(6,"mat-button-toggle",33)(7,"span"),l(8,"Affichage tableau"),r(),o(9,"mat-icon",32),l(10,"view_module"),r()()())}var qt=class n{http=g($);stateService=g(H);message=g(Z);destroySearchKeywordSub$=new G;destroyFormSub$=new G;searchChanged=new z;searchKeyword=new Y("");withDate=!1;form;xSmallOrSmall=L(()=>this.stateService.XSmallOrSmall());unsubscribe$=new G;departements=[];constructor(){this.initForm()}ngOnDestroy(){this.destroySearchKeywordSub$.next(),this.destroySearchKeywordSub$.complete(),this.destroyFormSub$.next(),this.destroyFormSub$.complete()}initForm(){this.findDepartments(),this.form=new Xe({startDate:new Y(""),endDate:new Y(""),department_id:new Y("")},{validators:this.dateRangeValidator}),this.searchKeyword.valueChanges.pipe(ft(500),gt(),te(this.destroySearchKeywordSub$)).subscribe(e=>this.emitSearch(e||""))}toggleDateSelector(e){this.withDate=e,this.emitSearch(this.searchKeyword.value||"")}emitSearch(e){this.searchChanged.emit({keyword:e,startDate:this.form.value.startDate,endDate:this.form.value.endDate,department_id:this.form.value.department_id})}dateRangeValidator=e=>{let t=e.get("startDate")?.value,i=e.get("endDate")?.value;return t&&i&&new Date(t)>new Date(i)?{dateRangeInvalid:!0}:null};onSubmit(){this.emitSearch(this.searchKeyword.value||"")}onToogleDateSelector(e){this.withDate!==e&&(this.form.reset(),this.emitSearch("")),this.withDate=e}findDepartments(){this.unsubscribe$.next(),this.http.url="departments",this.http.get().pipe(te(this.unsubscribe$)).subscribe({next:e=>{this.departements=e},error:e=>{this.message.openSnackBar(e,"Fermer",800)},complete:()=>{}})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=x({type:n,selectors:[["app-search-bar-component"]],outputs:{searchChanged:"searchChanged"},decls:23,vars:8,consts:[["searchMenu",""],[1,"mt-3","flex","justify-between","items-center"],[1,"md:px-4",3,"formGroup"],[1,"flex","flex-wrap","my-4","md:mt-6"],[1,"w-full","lg:w-4/12"],[1,"relative","w-full"],["type","text","placeholder","Rechercher un courrier par mot cl\xE9",1,"w-full","p-3","pl-5","pr-15","text-lg","border-2","border-gray-300","rounded-full","outline-none","transition","duration-300","focus:border-blue-500","focus:text-gray-700","bg-white","h-[45px]","lg:h-[49px]",3,"formControl"],[1,"absolute","right-4","top-1/2","transform","-translate-y-1/2","flex","items-center"],[1,"inline-block","h-[45px]","border-l","border-gray-300"],["mat-icon-button","",1,"text-gray-500","hover:text-gray-700","ml-2",3,"matMenuTriggerFor"],["xPosition","before","yPosition","below",3,"overlapTrigger"],["mat-menu-item","",3,"click"],[1,"w-full","lg:w-8/12","flex","justify-end","items-center","flex-wrap","mt-3","md:mt-0"],["value","add"],[1,"text-lg"],["mat-icon-button",""],[1,"md:px-4",3,"ngSubmit","formGroup"],[1,"flex","flex-col","md:flex-row","md:items-end","md:space-x-4","my-4"],[1,"w-full","md:w-3/12"],["for","startDate",1,"block","text-sm","text-gray-500","dark:text-gray-300"],["formControlName","startDate","type","date","placeholder","John Doe",1,"block","mt-2","w-full","placeholder-gray-400/70","dark:placeholder-gray-500","rounded-lg","border","border-gray-200","bg-white","px-5","py-3.5","text-gray-700","focus:border-blue-400","focus:outline-none","focus:ring","focus:ring-blue-300","focus:ring-opacity-40","dark:border-gray-600","dark:bg-gray-900","dark:text-gray-300","dark:focus:border-blue-300"],[1,"w-full","md:w-3/12","md:px-4"],["for","username",1,"block","text-sm","text-gray-500","dark:text-gray-300"],["id","username","formControlName","endDate","type","date","placeholder","John Doe",1,"block","mt-2","w-full","placeholder-gray-400/70","dark:placeholder-gray-500","rounded-lg","border","border-gray-200","bg-white","px-5","py-3.5","text-gray-700","focus:border-blue-400","focus:outline-none","focus:ring","focus:ring-blue-300","focus:ring-opacity-40","dark:border-gray-600","dark:bg-gray-900","dark:text-gray-300","dark:focus:border-blue-300"],["for","direction",1,"block","text-sm","text-gray-500","dark:text-gray-300"],["formControlName","department_id","id","direction",1,"block","w-full","placeholder-gray-400/70","dark:placeholder-gray-500","rounded-lg","border","border-gray-200","bg-white","px-5","py-3.5","text-gray-700","focus:border-blue-400","focus:outline-none","focus:ring","focus:ring-blue-300","focus:ring-opacity-40","dark:border-gray-600","dark:bg-gray-900","dark:text-gray-300","dark:focus:border-blue-300"],["selected","","value",""],[3,"value"],["matButton","filled","type","submit",1,"float-end",3,"disabled"],[1,"text-red-500","mb-1.5"],[1,"border-gray-300"],["matTooltip","Nouveau groupe","value","add","aria-label","Text align center"],["color","primary"],["matTooltip","Liste des proclamateurs","value","print","aria-label","Text align center"]],template:function(t,i){if(t&1){let a=S();_(0,Fi,6,0,"div",1),_(1,Oi,24,3,"form",2),o(2,"section",3)(3,"div",4)(4,"div",5),M(5,"input",6),o(6,"div",7),M(7,"span",8),o(8,"button",9)(9,"mat-icon"),l(10,"keyboard_arrow_down"),r()(),o(11,"mat-menu",10,0)(13,"button",11),u("click",function(){return d(a),p(i.onToogleDateSelector(!1))}),o(14,"mat-icon"),l(15),r(),l(16," Rechercher sans date "),r(),o(17,"button",11),u("click",function(){return d(a),p(i.onToogleDateSelector(!0))}),o(18,"mat-icon"),l(19),r(),l(20," Rechercher avec date "),r()()()()(),o(21,"div",12),_(22,Pi,11,0,"mat-button-toggle-group",13),r()()}if(t&2){let a=oe(12);f(i.xSmallOrSmall()?0:-1),m(),f(i.withDate?1:-1),m(4),b("formControl",i.searchKeyword),m(3),b("matMenuTriggerFor",a),m(3),b("overlapTrigger",!1),m(4),C(" ",i.withDate?"event_busy":"check"," "),m(4),C(" ",i.withDate?"check":"date_range"," "),m(3),f(i.xSmallOrSmall()?-1:22)}},dependencies:[T,I,B,E,U,j,v,y,Ke,kt,wt,Et,Dt,ze,Je,yt,Qe,Ye,D,le,ae,me,k,w,A,N,F,se,V,R,O,P,fe,ge,Ce,$t,Gt,Se,be,ce,he],encapsulation:2})};var Bi=n=>({"bg-gray-200":n}),$i=n=>({color:n}),Gi=(n,e)=>e.key;function Li(n,e){if(n&1){let t=S();o(0,"button",8),u("click",function(){d(t);let a=s();return p(a.onGoBack())}),o(1,"mat-icon"),l(2,"arrow_back_ios"),r()()}}function ji(n,e){if(n&1){let t=S();o(0,"div",10),u("click",function(){d(t);let a=s().$implicit,c=s();return p(c.onSelectTab(a))}),o(1,"button",11)(2,"mat-icon",12),l(3),r()()()}if(n&2){let t=s().$implicit,i=s();b("ngClass",K(4,Bi,i.selectedTab===t.key)),m(),b("matTooltip",i.getTooltip(t)),m(),b("ngStyle",K(6,$i,i.selectedTab===t.key?"#007ac3":"")),m(),C(" ",t.icon," ")}}function Ui(n,e){if(n&1&&_(0,ji,4,8,"div",9),n&2){let t=e.$implicit,i=s();f(t.roles.includes(i.role)?0:-1)}}function Hi(n,e){if(n&1&&(o(0,"span",4),l(1),ie(2,"uppercase"),r()),n&2){let t=s();m(),C(" ",Ue(2,1,t.title)," ")}}function qi(n,e){if(n&1){let t=S();o(0,"button",13),u("click",function(){d(t);let a=s();return p(a.onEmit("goToForm"))}),o(1,"mat-icon"),l(2,"add"),r()()}}function zi(n,e){if(n&1){let t=S();o(0,"button",14)(1,"mat-icon"),l(2,"keyboard_arrow_down"),r()(),o(3,"mat-menu",15,0)(5,"button",16),u("click",function(){d(t);let a=s();return p(a.onEmit("destined"))}),o(6,"mat-icon"),l(7,"check"),r(),l(8," Courriers qui me sont destin\xE9s"),r(),o(9,"button",16),u("click",function(){d(t);let a=s();return p(a.onEmit("all"))}),o(10,"mat-icon"),l(11,"list"),r(),l(12," Liste complete des courriers "),r()()}if(n&2){let t=oe(4);b("matMenuTriggerFor",t),m(3),b("overlapTrigger",!1)}}var Zt=class n{stateService=g(H);location=g(Tt);httpService=g($);selectedTab="initial";tabSelected=new z;actionButton=new z;roles=W;role=this.httpService.role;tabs=[{key:"initial",icon:"toc",tooltipMaa:"Tous les courriers",tooltipAaSa:"Courriers \xE0 annoter",tooltipDir:"Courriers \xE0 traiter",roles:["MAIL_ARCHIVES_AGENT","EXECUTIVE_SECRETARY","ADMIN_ASSISTANT","SENIOR_ASSISTANT","DIRECTOR"]},{key:"annotated",icon:"receipt",tooltip:"Courrier d\xE9j\xE0 annot\xE9s",roles:["ADMIN_ASSISTANT","SENIOR_ASSISTANT"]},{key:"all",icon:"list",tooltip:"Liste compl\xE8te de courriers",roles:["ADMIN_ASSISTANT","SENIOR_ASSISTANT","DIRECTOR"]},{key:"treated",icon:"assignment_turned_in",tooltip:"D\xE9j\xE0 trait\xE9s",roles:["ADMIN_ASSISTANT","SENIOR_ASSISTANT","DIRECTOR"]},{key:"to-process",icon:"translate",tooltip:"Courriers \xE0 traiter",roles:["MAIL_ARCHIVES_AGENT","EXECUTIVE_SECRETARY","ADMIN_ASSISTANT","SENIOR_ASSISTANT"]}];title;xSmallOrSmall=L(()=>this.stateService.XSmallOrSmall());constructor(){}ngOnInit(){for(let e in this.tabs)this.tabs[e].key===this.selectedTab&&(this.title=this.getTooltip(this.tabs[e]))}onSelectTab(e){this.selectedTab=e.key,this.title=this.getTooltip(e),this.tabSelected.emit(e.key)}onEmit(e){this.selectedTab=e,this.actionButton.emit(e)}getTooltip(e){if(e.key==="initial")switch(this.role){case"MAIL_ARCHIVES_AGENT":return e.tooltipMaa;case"DIRECTOR":return e.tooltipDir;default:return e.tooltipAaSa}return e.tooltip}onGoBack(){this.location.back()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=x({type:n,selectors:[["app-toolbar-component"]],inputs:{selectedTab:"selectedTab"},outputs:{tabSelected:"tabSelected",actionButton:"actionButton"},decls:15,vars:5,consts:[["menu",""],[1,"flex","items-center","justify-between","md:h-16","md:px-4","border-b","border-b-gray-300","md:border-b-0","py-2","md:py-0",3,"ngClass"],[1,"flex","gap-2"],["mat-icon-button","",1,"me-2"],[1,"text-lg"],["mat-icon-button","","matTooltip","Nouveau courrier"],["mat-icon-button","","matTooltip","Actualiser",3,"click"],["mat-icon-button","","matTooltip","Imprimer",3,"click"],["mat-icon-button","",1,"me-2",3,"click"],[3,"ngClass"],[3,"click","ngClass"],["mat-icon-button","",3,"matTooltip"],[3,"ngStyle"],["mat-icon-button","","matTooltip","Nouveau courrier",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["yPosition","below",3,"overlapTrigger"],["mat-menu-item","",3,"click"]],template:function(t,i){t&1&&(o(0,"section",1)(1,"div",2),_(2,Li,3,0,"button",3),J(3,Ui,1,1,null,null,Gi),r(),_(5,Hi,3,3,"span",4),o(6,"div"),_(7,qi,3,0,"button",5),o(8,"button",6),u("click",function(){return i.onEmit("refresh")}),o(9,"mat-icon"),l(10,"refresh"),r()(),o(11,"button",7),u("click",function(){return i.onEmit("print")}),o(12,"mat-icon"),l(13,"print"),r()(),_(14,zi,13,2),r()()),t&2&&(b("ngClass",i.xSmallOrSmall()?"":"u-bg-header-main"),m(2),f(i.xSmallOrSmall()?-1:2),m(),X(i.tabs),m(2),f(i.xSmallOrSmall()?-1:5),m(2),f(i.role===i.roles.MAIL_ARCHIVES_AGENT||i.role===i.roles.ADMIN_ASSISTANT||i.role===i.roles.EXECUTIVE_SECRETARY?7:-1),m(7),f(i.role===i.roles.ADMIN_ASSISTANT||i.role===i.roles.SENIOR_ASSISTANT?14:-1))},dependencies:[T,re,vt,I,B,E,j,v,y,D,le,ae,me,k,w,A,N,F,se,V,R,O,P,fe,ge,Ce,Se,be,ce,he,He],encapsulation:2})};var nt=class{constructor(e,t,i,a,c,h,$e,ut,_n,fn,gn,Cn){this.page=e;this.pageSize=t;this.keyword=i;this.withAnnotated=a;this.processed=c;this.startDate=h;this.endDate=$e;this.department_id=ut;this.assigned_to_me=_n;this.withAdminAssistant=fn;this.withSeniorAssistant=gn;this.withDirector=Cn}};var ot=class{constructor(e,t){this.action=e;this.data=t}};var rt=class n{constructor(e,t){this.data=e;this.dialogRef=t;e&&(this.message=e.message||this.message,e.buttonText&&(this.confirmButtonText=e.buttonText.ok||this.confirmButtonText,this.cancelButtonText=e.buttonText.cancel||this.cancelButtonText))}message="Are you sure?";confirmButtonText="Yes";cancelButtonText="Cancel";onConfirmClick(){this.dialogRef.close(!0)}static \u0275fac=function(t){return new(t||n)(mt(pe),mt(de))};static \u0275cmp=x({type:n,selectors:[["app-confirm-component"]],decls:9,vars:3,consts:[["align","center"],["mat-flat-button","","color","primary","tabindex","1",3,"click"],["mat-raised-button","","mat-dialog-close","","tabindex","-1"]],template:function(t,i){t&1&&(o(0,"mat-dialog-content")(1,"p"),l(2),r()(),o(3,"mat-dialog-actions",0)(4,"button",1),u("click",function(){return i.onConfirmClick()}),l(5),r(),l(6,"\xA0 "),o(7,"button",2),l(8),r()()),t&2&&(m(2),C(" ",i.message," "),m(3),st(i.confirmButtonText),m(3),st(i.cancelButtonText))},dependencies:[ue,_e,Bt,T,I,E,U,v,y,D,k,w,A,N,F,V,R,O,P],encapsulation:2})};var Ji=["fileInput"],Xi=n=>({"bg-gray-100 border-blue-500":n}),ti=(n,e)=>e.id;function Ki(n,e){if(n&1&&(o(0,"mat-option",22),l(1),r()),n&2){let t=e.$implicit;b("value",t.id),m(),C(" ",t.full_name," ")}}function Qi(n,e){if(n&1&&(o(0,"mat-error"),l(1),r()),n&2){let t=s(3);m(),C(" ",t.getErrorSeriorAssistant(t.assigneeFormControlName)," ")}}function Yi(n,e){if(n&1&&(o(0,"mat-form-field",15)(1,"mat-label"),l(2,"Assistant principal charg\xE9 de la validation"),r(),o(3,"mat-select",21),J(4,Ki,2,2,"mat-option",22,ti),r(),_(6,Qi,2,1,"mat-error"),r()),n&2){let t,i=s(2);m(3),b("formControlName",i.assigneeFormControlName),m(),X(i.seniorAssistants),m(2),f((t=i.form.get(i.assigneeFormControlName))!=null&&t.hasError("required")?6:-1)}}function Wi(n,e){if(n&1&&(o(0,"mat-option",22),l(1),r()),n&2){let t=e.$implicit;b("value",t.id),m(),C(" ",t.full_name," ")}}function Zi(n,e){if(n&1&&(o(0,"mat-error"),l(1),r()),n&2){let t=s(3);m(),C(" ",t.getErrorSeriorAssistant(t.assigneeFormControlName)," ")}}function en(n,e){if(n&1&&(o(0,"mat-form-field",15)(1,"mat-label"),l(2,"Directeur charg\xE9 de traitement de ce courrier"),r(),o(3,"mat-select",21),J(4,Wi,2,2,"mat-option",22,ti),r(),_(6,Zi,2,1,"mat-error"),r()),n&2){let t,i=s(2);m(3),b("formControlName",i.assigneeFormControlName),m(),X(i.directors),m(2),f((t=i.form.get(i.assigneeFormControlName))!=null&&t.hasError("required")?6:-1)}}function tn(n,e){if(n&1&&(o(0,"mat-error"),l(1),r()),n&2){let t=s(2);m(),C(" ",t.getErrorComment(t.commentFormControlName)," ")}}function nn(n,e){if(n&1){let t=S();o(0,"mat-checkbox",23),u("change",function(a){d(t);let c=s(2);return p(c.onCheckboxChange(a))}),l(1,"Joindre un fichier scann\xE9"),r()}}function on(n,e){if(n&1&&(o(0,"p",28),l(1),r()),n&2){let t=s(3);m(),C("Fichier : ",t.pdfService.localPdf.name," ")}}function rn(n,e){if(n&1&&(o(0,"mat-error",29),l(1),r()),n&2){let t=s(3);m(),C(" ",t.errorMessage," ")}}function an(n,e){if(n&1){let t=S();o(0,"div",20)(1,"div",24),u("click",function(){d(t);let a=s(2);return p(a.triggerFileInput())})("dragover",function(a){d(t);let c=s(2);return p(c.onDragOver(a))})("dragleave",function(a){d(t);let c=s(2);return p(c.onDragLeave(a))})("drop",function(a){d(t);let c=s(2);return p(c.onDrop(a))}),o(2,"mat-icon",25),l(3,"attach_file"),r(),o(4,"p",26),l(5," D\xE9posez ici un fichier au format PDF ou image, ou "),o(6,"span",27),l(7," cliquez "),r(),l(8," pour le s\xE9lectionner."),r(),_(9,on,2,1,"p",28),r(),_(10,rn,2,1,"mat-error",29),r()}if(n&2){let t=s(2);m(),b("ngClass",K(3,Xi,t.isDragging)),m(8),f(t.pdfService.localPdf?9:-1),m(),f(t.errorMessage!==""?10:-1)}}function ln(n,e){if(n&1){let t=S();o(0,"form",11),u("ngSubmit",function(){d(t);let a=s();return p(a.onSubmit())}),o(1,"div",12)(2,"h1",13),l(3),r(),o(4,"p"),l(5),r()(),o(6,"div",14),_(7,Yi,7,2,"mat-form-field",15)(8,en,7,2,"mat-form-field",15),o(9,"div",16)(10,"mat-checkbox",17),l(11," Transf\xE9rer directement "),o(12,"span"),l(13),r()()()(),o(14,"div",12)(15,"h1",13),l(16),r(),o(17,"p"),l(18),r()(),M(19,"editor",18),_(20,tn,2,1,"mat-error"),_(21,nn,2,0,"mat-checkbox",19),_(22,an,11,5,"div",20),r()}if(n&2){let t,i=s();b("formGroup",i.form),m(3),C("",i.role===i.roles.ADMIN_ASSISTANT?"Validateur (Assistant Principale)":"Directeur"," "),m(2),C(" Cette personne ",i.role===i.roles.ADMIN_ASSISTANT?"est charg\xE9e de valider l'annoation et de transf\xE9rer le courrier au directeur concern\xE9":"est charg\xE9e du traitement de ce courrier",". "),m(2),f(i.role===i.roles.ADMIN_ASSISTANT?7:8),m(6),C(" ",i.role===i.roles.ADMIN_ASSISTANT?"\xE0 l'assistant principal pour validation":"au directeur pour traitement"," "),m(3),C("Ajouter une annotation (visible par ",i.role===i.roles.ADMIN_ASSISTANT?"le personnel de direction":"la personne charg\xE9e du traitement",") "),m(2),C(" Votre annotation sera visible par ",i.role===i.roles.ADMIN_ASSISTANT?"l'Assistant Principal charg\xE9 de validation":"le Directeur charg\xE9 du traitement"," "),m(),b("formControlName",i.commentFormControlName)("init",i.init),m(),f((t=i.form.get(i.commentFormControlName))!=null&&t.hasError("required")&&i.form.touched?20:-1),m(),f(i.data.mail.scanned_document===null?21:-1),m(),f(i.disabled?22:-1)}}function mn(n,e){n&1&&(o(0,"div",5),M(1,"mat-spinner"),r())}var at=class n{dialogRef=g(de);message=g(Z);data=g(pe);http=g($);stateService=g(H);pdfService=g(Me);disabled=!1;errorMessage="";isDragging=!1;isExternalMail=!1;init={plugins:"lists link image table code help wordcount",height:350};fileInput;form;unsubscribeSA$=new G;unsubscribeDir$=new G;unsubscribeMail$=new G;unsubscribeAa$=new G;seniorAssistants=[];directors=[];uploadProgress=0;xSmallOrSmall=L(()=>this.stateService.XSmallOrSmall());mail;roles=W;role=this.http.role;commentFormControlName;assigneeFormControlName;isFormReady=!1;ngOnInit(){this.loadData()}ngOnDestroy(){this.unsubscribeSA$.next(),this.unsubscribeSA$.complete(),this.unsubscribeDir$.next(),this.unsubscribeDir$.complete(),this.unsubscribeAa$.next(),this.unsubscribeAa$.complete()}initForm(){this.commentFormControlName=this.role==="ADMIN_ASSISTANT"?"admin_assistant_comment":"senior_assistant_comment",this.assigneeFormControlName=this.role==="ADMIN_ASSISTANT"?"senior_assistant_id":"director_id";let e="";e=this.data.mail.seniorAssistant?this.data.mail.seniorAssistant.id:"",console.log(e);let t={should_send_document:new Y(!1),[this.commentFormControlName]:new Y(this.data.mail[this.commentFormControlName],[dt.required]),[this.assigneeFormControlName]:new Y(3,[dt.required])};this.form=new Xe(t)}getErrorComment(e){return this.form.get(e).hasError("required")?"Ce champ est requis":this.form.get(e).hasError("minlength")?"L'annotation doit contenir au moins 10 caract\xE8res.":""}getErrorSeriorAssistant(e){return this.form.get(e).hasError("required")?"Ce champ est requis":""}onClose(){this.dialogRef.close()}triggerFileInput(){this.fileInput.nativeElement.value="",this.fileInput.nativeElement.click()}onDragOver(e){e.preventDefault(),this.isDragging=!0}onDragLeave(e){e.preventDefault(),this.isDragging=!1}onDrop(e){e.preventDefault(),this.isDragging=!1;let t=e.dataTransfer?.files;t&&this.handleFile(t[0])}onFileSelected(e){let i=e.target.files;i&&this.handleFile(i[0])}handleFile(e){this.pdfService.handleFile(e)}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.message.openSnackBar("Veuillez corriger les erreurs du formulaire.","Fermer",4e3);return}this.update()}update(){this.http.url=`${this.data.endpoint}/${this.data.mail.id}`,this.http.sendFormData(JSON.stringify(this.form.value),this.pdfService.localPdf,"patch").subscribe({next:e=>{e.type===Q.UploadProgress?this.uploadProgress=Math.round(e.loaded/(e.total||1)*100):e.type===Q.Response&&(this.message.openSnackBar("Commentaire ajout\xE9 avec succ\xE8s !","Fermer",4e3),this.dialogRef.close(e.body))},error:e=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0},complete:()=>{}})}onCheckboxChange(e){this.disabled=e.checked}loadData(){let e={mail:this.getMail()};this.role==="ADMIN_ASSISTANT"?e.senior_assistants=this.getSeniorAssistant():this.role==="SENIOR_ASSISTANT"&&(e.directors=this.getDirectors()),_t(e).subscribe({next:t=>{this.data.mail=t.mail,this.role==="ADMIN_ASSISTANT"?this.seniorAssistants=t.senior_assistants:this.role==="SENIOR_ASSISTANT"&&(this.directors=t.directors),this.initForm(),this.isFormReady=!0},error:t=>{this.message.openSnackBar("Une erreur est survenue lors du chargement des donn\xE9es. Veuillez r\xE9essayer.","Fermer",800)}})}getDirectors(){return this.http.url="users/by-role/DIRECTOR",this.http.get().pipe(te(this.unsubscribeDir$))}getSeniorAssistant(){return this.http.url="users/by-role/SENIOR_ASSISTANT",this.http.get().pipe(te(this.unsubscribeSA$))}getMail(){return this.http.url=`${this.data.endpoint}/${this.data.mail.id}`,this.http.get().pipe(te(this.unsubscribeMail$))}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=x({type:n,selectors:[["app-comment-dialog-component"]],viewQuery:function(t,i){if(t&1&&Ge(Ji,5),t&2){let a;Le(a=je())&&(i.fileInput=a.first)}},decls:18,vars:2,consts:[["fileInput",""],[1,"flex","items-center","justify-between","px-4","py-2","bg-white","dark:bg-gray-900","shadow-sm"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-300"],["mat-icon-button","",3,"click"],[1,"-mx-3","md:-mx-0",3,"formGroup"],[1,"flex","items-center","justify-center","my-10"],[1,"mt-2"],[1,"border-gray-300"],["mat-flat-button","","cdkFocusInitial","",3,"click"],["matButton","elevated","cdkFocusInitial","",3,"click"],["type","file","accept",".jpg, .jpeg, .png, application/pdf",1,"hidden",3,"change"],[1,"-mx-3","md:-mx-0",3,"ngSubmit","formGroup"],[1,"w-full","mb-4"],[1,"text-lg","font-bold"],[1,"w-full"],["appearance","outline",1,"w-full"],[1,"w-full","flex","justify-end"],["formControlName","should_send_document",1,"-mt-5"],["licenseKey","gpl",1,"w-full",3,"formControlName","init"],["labelPosition","after"],[1,"w-full","mt-1"],["matInput","",3,"formControlName"],[3,"value"],["labelPosition","after",3,"change"],[1,"p-1","w-full","h-56","flex","flex-col","items-center","justify-center","border-2","border-dashed","border-gray-400","bg-white","rounded-lg","cursor-pointer","hover:border-blue-500","transition",3,"click","dragover","dragleave","drop","ngClass"],[1,"mat-18"],[1,"text-gray-600","text-lg","text-center","mt-2","px-1"],[1,"text-blue-500","font-bold"],[1,"text-lg","border-t-4","border-r-gray-100","mt-0.5"],[1,"mt-1.5"]],template:function(t,i){if(t&1){let a=S();o(0,"div",1)(1,"h2",2),l(2),r(),o(3,"button",3),u("click",function(){return d(a),p(i.onClose())}),o(4,"mat-icon"),l(5,"close"),r()()(),o(6,"mat-dialog-content"),_(7,ln,23,12,"form",4)(8,mn,2,0,"div",5),r(),o(9,"div",6),M(10,"hr",7),r(),o(11,"mat-dialog-actions")(12,"button",8),u("click",function(){return d(a),p(i.onSubmit())}),l(13," Sauvegarder "),r(),o(14,"button",9),u("click",function(){return d(a),p(i.onClose())}),l(15," Fermer "),r()(),o(16,"input",10,0),u("change",function(h){return d(a),p(i.onFileSelected(h))}),r()}t&2&&(m(2),C(" ",i.data.title," "),m(5),f(i.isFormReady?7:8))},dependencies:[fe,ge,Ce,Se,be,Lt,w,Ft,Nt,We,k,ce,he,T,re,I,B,E,U,j,v,y,Ke,ze,Je,Qe,Ye,D,A,N,Vt,F,V,R,Pt,Ot,O,P,ue,_e,Ut],styles:[".mat-mdc-dialog-container .mdc-dialog__surface{border-radius:0!important}"]})};var sn=["fileInput"],cn=n=>({"bg-gray-100 border-blue-500":n});function dn(n,e){if(n&1&&(o(0,"p",11),l(1),r()),n&2){let t=s();m(),C("Fichier : ",t.pdfService.localPdf.name," ")}}function pn(n,e){if(n&1&&(o(0,"mat-error",12),l(1),r()),n&2){let t=s();m(),C(" ",t.errorMessage," ")}}function un(n,e){if(n&1){let t=S();o(0,"button",18),u("click",function(){d(t);let a=s();return p(a.onPreviewDocument())}),o(1,"div",19)(2,"mat-icon",20),l(3,"remove_red_eye"),r(),o(4,"span"),l(5,"Pr\xE9visualiser"),r()()()}}var lt=class n{dialogRef=g(de);message=g(Z);data=g(pe);http=g($);stateService=g(H);dialog=g(Ze);pdfService=g(Me);router=g(qe);disabled=!1;errorMessage="";isDragging=!1;isExternalMail=!1;fileInput;form;uploadProgress=0;xSmallOrSmall=L(()=>this.stateService.XSmallOrSmall());constructor(){this.isExternalMail="sender"in this.data.mail&&typeof this.data.mail.sender=="string"}onClose(){this.dialogRef.close()}triggerFileInput(){this.fileInput.nativeElement.value="",this.fileInput.nativeElement.click()}onDragOver(e){e.preventDefault(),this.isDragging=!0}onDragLeave(e){e.preventDefault(),this.isDragging=!1}onDrop(e){e.preventDefault(),this.isDragging=!1;let t=e.dataTransfer?.files;t&&(this.errorMessage=this.pdfService.handleFile(t[0]))}onFileSelected(e){let i=e.target.files;i&&(this.errorMessage=this.pdfService.handleFile(i[0]))}onSubmit(){if(!this.pdfService.localPdf){this.message.openSnackBar("Veuillez s\xE9lectionner un fichier","Fermer",4e3);return}this.sendTreatmentProof()}sendTreatmentProof(){this.http.url=`${this.data.endpoint}/treatment-proof`,this.http.sendFormData(JSON.stringify({id:this.data.mail.id}),this.pdfService.localPdf,"post").subscribe({next:e=>{e.type===Q.UploadProgress?this.uploadProgress=Math.round(e.loaded/(e.total||1)*100):e.type===Q.Response&&(this.message.openSnackBar("Preuve de traitement ajout\xE9e avec succ\xE8s !","Fermer",4e3),this.dialogRef.close(e.body))},error:e=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3),this.uploadProgress=0}})}onPreviewDocument(){this.pdfService.displayLocalPdf()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=x({type:n,selectors:[["app-treatment-prooft-dialog-component"]],viewQuery:function(t,i){if(t&1&&Ge(sn,5),t&2){let a;Le(a=je())&&(i.fileInput=a.first)}},decls:30,vars:10,consts:[["fileInput",""],[1,"flex","items-center","justify-between","px-4","py-2","bg-white","dark:bg-gray-900","shadow-sm"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-300"],["mat-icon-button","",3,"click"],[1,"-mx-3","md:-mx-0"],[1,"text-lg"],[1,"w-full","mt-1"],[1,"p-1","w-full","h-56","flex","flex-col","items-center","justify-center","border-2","border-dashed","border-gray-400","bg-white","rounded-lg","cursor-pointer","hover:border-blue-500","transition",3,"click","dragover","dragleave","drop","ngClass"],[1,"mat-18"],[1,"text-gray-600","text-lg","text-center","mt-2","px-1"],[1,"text-blue-500","font-bold"],[1,"text-lg","border-t-4","border-r-gray-100","mt-0.5","text-center"],[1,"mt-1.5"],[1,"mt-5"],[1,"border-gray-300"],["type","button","mat-stroked-button","","color","primary"],["mat-flat-button","","cdkFocusInitial","",3,"click"],["type","file","accept",".jpg, .jpeg, .png, application/pdf",1,"hidden",3,"change"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"flex","items-center"],[1,"me-2"]],template:function(t,i){if(t&1){let a=S();o(0,"div",1)(1,"h2",2),l(2),r(),o(3,"button",3),u("click",function(){return d(a),p(i.onClose())}),o(4,"mat-icon"),l(5,"close"),r()()(),o(6,"mat-dialog-content")(7,"div",4)(8,"h1",5),l(9),ie(10,"uppercase"),r(),o(11,"div",6)(12,"div",7),u("click",function(){return d(a),p(i.triggerFileInput())})("dragover",function(h){return d(a),p(i.onDragOver(h))})("dragleave",function(h){return d(a),p(i.onDragLeave(h))})("drop",function(h){return d(a),p(i.onDrop(h))}),o(13,"mat-icon",8),l(14,"attach_file"),r(),o(15,"p",9),l(16," D\xE9posez ici un fichier au format PDF ou image, ou "),o(17,"span",10),l(18," cliquez "),r(),l(19," pour le s\xE9lectionner."),r(),_(20,dn,2,1,"p",11),r(),_(21,pn,2,1,"mat-error",12),r()()(),o(22,"div",13),M(23,"hr",14),r(),o(24,"mat-dialog-actions"),_(25,un,6,0,"button",15),o(26,"button",16),u("click",function(){return d(a),p(i.onSubmit())}),l(27," Enregister la preuve "),r()(),o(28,"input",17,0),u("change",function(h){return d(a),p(i.onFileSelected(h))}),r()}t&2&&(m(2),C(" ",i.data.title," "),m(7),C("OBJET DU COURRIER : ",Ue(10,6,i.data.mail.subject)," "),m(3),b("ngClass",K(8,cn,i.isDragging)),m(8),f(i.pdfService.localPdf?20:-1),m(),f(i.errorMessage!==""?21:-1),m(4),f(i.pdfService.localPdf?25:-1))},dependencies:[ue,_e,T,re,I,B,E,U,j,v,y,D,k,w,We,A,N,F,V,R,O,P,He],styles:[".mat-mdc-dialog-container .mdc-dialog__surface{border-radius:0!important}"]})};var ii=class n{constructor(e,t,i){this.endpoint=e;this.routePrefix=t;this.key=i,this.mailSearchTrigger$.pipe(St(a=>(this.loading=!0,this.error=null,this.http.url=a.url,this.http.get(a.params).pipe(Ct(()=>this.loading=!1))))).subscribe({next:a=>{this.page=a},error:a=>this.error=a})}http=g($);router=g(qe);stateService=g(H);dialog=g(Ze);paramsService=g(jt);message=g(Z);pdfService=g(Me);mailSearchTrigger$=new G;xSmallOrSmall=L(()=>this.stateService.XSmallOrSmall());page;loading=!1;error=null;criteria=new nt(1,6);uploadProgress=0;pageSizeOptions=[6,12,24,100];pageEvent;pageIndex=0;tab="initial";key;findMails(e){this.mailSearchTrigger$.next(e)}goToForm(e,t){let i=new ot(e,t);sessionStorage.setItem("formActionPayload",JSON.stringify(i)),this.router.navigateByUrl(`${this.routePrefix}/form`)}openAddCommentDialog(e,t){let i=new pt;i.disableClose=!0,i.data={title:"Ajouter une annotation",mail:e,endpoint:this.endpoint},i.minWidth=this.xSmallOrSmall()?"96vw":"57vw",this.dialog.open(at,i).afterClosed().subscribe(c=>{if(c&&t==="initial")this.buildInitial();else if(c){let h=this.page.items.findIndex($e=>$e.id===c.id);h!==-1&&(this.page.items[h].status=c.status)}})}AddTreatmentProof(e){let t=new pt;t.disableClose=!0,t.data={title:"Ajouter une preuve de traitement",mail:e,endpoint:this.endpoint},this.dialog.open(lt,t).afterClosed().subscribe(a=>{a&&this.buildInitial()})}downloadDocument(e,t){this.http.url=`${this.endpoint}/${t}/${e}`,this.http.getPdfDocument().subscribe({next:i=>{let a=URL.createObjectURL(i),c=document.createElement("a");c.href=a,c.download=`${t}_${e}.pdf`,document.body.appendChild(c),c.click(),URL.revokeObjectURL(a),c.remove()},error:()=>{this.message.openSnackBar("Erreur lors du t\xE9l\xE9chargement du document","Fermer",6e3)},complete:()=>{this.message.openSnackBar("D\xE9but du t\xE9l\xE9chargement","Fermer",1e3)}})}gotToDetails(e){sessionStorage.setItem(this.endpoint.replace(/-/g,""),JSON.stringify(e)),this.router.navigateByUrl(`${this.routePrefix}/detail`)}search(e){this.findMails(this.paramsService.build(this.endpoint,e))}buildInitial(){let e=q({},this.criteria);switch(this.http.role){case"MAIL_ARCHIVES_AGENT":case"EXECUTIVE_SECRETARY":this.search(e);break;case"ADMIN_ASSISTANT":case"SENIOR_ASSISTANT":this.search(ee(q({},e),{withAnnotated:!1}));break;case"DIRECTOR":this.search(ee(q({},e),{processed:!1}));break;default:this.search(e)}}buildToProcess(){this.search(ee(q({},this.criteria),{assigned_to_me:!0}))}buildAnnotated(){(this.http.role==="ADMIN_ASSISTANT"||this.http.role==="SENIOR_ASSISTANT")&&this.search(ee(q({},this.criteria),{withAnnotated:!0}))}buildAll(){let e=q({},this.criteria);switch(this.http.role){case"ADMIN_ASSISTANT":case"SENIOR_ASSISTANT":this.search(e);break;case"DIRECTOR":this.search(ee(q({},e),{processed:void 0}));break;default:this.search(e)}}buildTreated(){this.search(ee(q({},this.criteria),{processed:!0}))}send(e){this.uploadProgress=0;let t=this.http.role,i=t==="ADMIN_ASSISTANT"?"\xE0 l'Assistant Principal pour validation":"au Directeur pour traitement";this.dialog.open(rt,{data:{message:`Souhaitez-vous vraiment envoyer ce courrier ${i} ?`,buttonText:{ok:"Oui",cancel:"Non"}}}).afterClosed().subscribe(c=>{c&&(this.http.url=`${this.endpoint}/${e.id}`,this.http.sendFormData(JSON.stringify({should_send_document:!0}),null,"patch").subscribe({next:h=>{if(h.type===Q.UploadProgress)this.uploadProgress=Math.round(h.loaded/(h.total||1)*100);else if(h.type===Q.Response){let $e=this.page.items.findIndex(ut=>ut.id===h.body.id);$e!==-1&&(this.page.items[$e].status=t==="ADMIN_ASSISTANT"?"sa":"dir")}},error:()=>{this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3)},complete:()=>{this.message.openSnackBar("Op\xE9ration effectu\xE9e avec succ\xE8s !","Fermer",4e3)}}))})}displayOnline(e,t){this.pdfService.displayOnlinePdf(e,t,this.endpoint)}displayLocal(){this.pdfService.displayLocalPdf()}selectTab(e,t=!1){switch(t&&(this.criteria.page=1,this.criteria.pageSize=6,this.pageIndex=0),e){case"initial":this.buildInitial();break;case"annotated":this.buildAnnotated();break;case"all":this.buildAll();break;case"treated":this.buildTreated();break;case"to-process":this.buildToProcess();break;default:}this.tab=e,sessionStorage.setItem(this.key,e)}actionButton(e){switch(e){case"goToForm":this.goToForm("add");break;case"refresh":this.buildInitial();break;case"print":break;default:}}menuSelected(e){switch(e.action){case"view_detail":this.gotToDetails(e.data);break;case"display_document":this.displayOnline(e.data.id,"document");break;case"display_proof":this.displayOnline(e.data.id,"proof");break;case"receipt":break;case"download_mail":this.downloadDocument(e.data.id,"document");break;case"download_proof":this.downloadDocument(e.data.id,"proof");break;case"add_comment":this.openAddCommentDialog(e.data,this.tab);break;case"treatment_proof":this.AddTreatmentProof(e.data);break;case"share_mail":break;case"assign_agent":case"edit_mail":this.goToForm(e.action,e.data);break;case"delete_mail":break;case"send":this.send(e.data);break;default:console.warn("Action non g\xE9r\xE9e :")}}onNext(e){this.pageEvent=e,this.pageIndex=e.pageIndex,this.criteria.page=this.pageEvent.pageIndex+1,this.criteria.pageSize=this.pageEvent.pageSize,this.selectTab(this.tab)}static \u0275fac=function(t){Mt()};static \u0275prov=bt({token:n,factory:n.\u0275fac,providedIn:"root"})};export{ii as a,Ht as b,qt as c,Zt as d};
