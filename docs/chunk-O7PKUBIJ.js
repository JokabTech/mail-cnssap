import{a as Ve}from"./chunk-MVEDYPDX.js";import{a as Ue}from"./chunk-OD4FTP4P.js";import{a as Ge}from"./chunk-4P2PPLUQ.js";import"./chunk-SLXF42A7.js";import{a as K,b as Ee,c as we,d as ke,f as Te,g as Ie}from"./chunk-7FHMHPOG.js";import{a as Fe,b as Oe,c as Be,d as Pe,e as Ae,f as Re,i as Ne,j as Le,k as $e,r as ze}from"./chunk-WO3WQ2XR.js";import{a as Se,b as _e}from"./chunk-OYAAD6H2.js";import{a as H}from"./chunk-NS5OZLHL.js";import{a as De}from"./chunk-Y3YQYZ4W.js";import{A as ve,B as U,G as V,I as G,K as j,a as k,b as T,c as pe,d as ce,e as ue,f as ge,g as A,l as R,n as fe,o as he,r as xe,s as N,u as be,v as L,x as $,y as Me,z}from"./chunk-JQ7ZTRAQ.js";import{a as q}from"./chunk-XHZ33VBC.js";import{$ as me,M as I,O as re,P as F,R as O,T as b,V as B,W as ae,X as oe,Z as _,ba as le,ca as se,da as de,ma as P}from"./chunk-4LHVJXPR.js";import{C as w,d as ne,k as E}from"./chunk-SMWCLUEH.js";import{a as Ce,b as ye}from"./chunk-VYQ2GNAY.js";import{Ab as h,Cb as J,Db as Y,Eb as x,Fb as i,Gb as n,Hb as p,Mb as W,Qb as c,S as M,Sb as u,Wa as l,ac as Z,ba as d,ec as r,f as C,fc as ee,ga as v,gb as y,gc as g,ha as S,mb as X,oc as te,xc as ie,zb as f}from"./chunk-JOOEKZTP.js";import"./chunk-2VMXMS7J.js";function lt(a,e){if(a&1&&(i(0,"mat-error"),r(1),n()),a&2){let t=u();l(),g(" ",t.getErrorDesignation()," ")}}function st(a,e){if(a&1&&(i(0,"mat-error"),r(1),n()),a&2){let t=u();l(),g(" ",t.getErrorAcronym()," ")}}var D=class a{dialogRef=d(Ee);message=d(H);data=d(we);http=d(q);unsubscribe$=new C;form;department;ngOnInit(){this.initForm()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}initForm(){this.form=new oe({designation:new _(this.data.department?this.data.department.designation:"",[b.required,b.minLength(10),b.maxLength(100)]),acronym:new _(this.data.department?this.data.department.acronym:"",[b.required,b.minLength(2),b.maxLength(10)])})}getErrorDesignation(){return this.form.get("designation").hasError("required")?"Ce champ est requis":this.form.get("designation").hasError("minlength")?"La d\xE9signation doit contenir au moins 10 caract\xE8res.":this.form.get("designation").hasError("maxlength")?"La d\xE9signation ne peut pas d\xE9passer 100 caract\xE8res.":""}getErrorAcronym(){return this.form.get("acronym").hasError("required")?"Ce champ est requis":this.form.get("acronym").hasError("minlength")?"L'acronyme doit contenir au moins 2 caract\xE8res.":this.form.get("acronym").hasError("maxlength")?"L'acronyme ne peut pas d\xE9passer 10 caract\xE8res.":""}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.message.openSnackBar("Veuillez corriger les erreurs du formulaire.","Fermer",4e3);return}this.data.target==="add"?this.add():this.update()}add(){this.http.url="departments",this.http.save(this.form.value).pipe(M(this.unsubscribe$)).subscribe({next:e=>{this.department=e},error:e=>{this.message.openSnackBar(e,"Fermer",4e3)},complete:()=>{this.message.openSnackBar("Direction ajout\xE9e avec succ\xE8s","Fermer",4e3),this.dialogRef.close(this.department)}})}update(){this.http.url=`departments/${this.data.department.id}`,this.http.update(this.form.value).pipe(M(this.unsubscribe$)).subscribe({next:e=>{this.department=e},error:e=>{this.message.openSnackBar(e,"Fermer",4e3)},complete:()=>{this.message.openSnackBar("Direction modifi\xE9e avec succ\xE8s","Fermer",4e3),this.dialogRef.close(this.department)}})}onClose(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=y({type:a,selectors:[["app-department-edit-component"]],decls:24,vars:4,consts:[[1,"flex","items-center","justify-between","px-4","py-2","bg-white","dark:bg-gray-900","shadow-sm"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-300"],["mat-icon-button","",3,"click"],[1,"-mx-3","md:-mx-0",3,"ngSubmit","formGroup"],[1,"w-full","mt-1"],[1,"w-full"],["type","text","matInput","","formControlName","designation"],["type","text","matInput","","formControlName","acronym"],[1,"mt-5"],[1,"border-gray-300"],["mat-flat-button","","cdkFocusInitial","",3,"click"]],template:function(t,o){if(t&1&&(i(0,"div",0)(1,"h2",1),r(2),n(),i(3,"button",2),c("click",function(){return o.onClose()}),i(4,"mat-icon"),r(5,"close"),n()()(),i(6,"mat-dialog-content")(7,"form",3),c("ngSubmit",function(){return o.onSubmit()}),i(8,"div",4)(9,"mat-form-field",5)(10,"mat-label"),r(11,"D\xE9signation de la direction"),n(),p(12,"input",6),f(13,lt,2,1,"mat-error"),n(),i(14,"mat-form-field",5)(15,"mat-label"),r(16,"Acronyme de la direction"),n(),p(17,"input",7),f(18,st,2,1,"mat-error"),n()()()(),i(19,"div",8),p(20,"hr",9),n(),i(21,"mat-dialog-actions")(22,"button",10),c("click",function(){return o.onSubmit()}),r(23," Enregister "),n()()),t&2){let m,s;l(2),g(" ",o.data.title," "),l(5),x("formGroup",o.form),l(6),h((m=o.form.get("designation"))!=null&&m.hasError?13:-1),l(5),h((s=o.form.get("acronym"))!=null&&s.hasError?18:-1)}},dependencies:[Te,Ie,E,T,k,F,re,I,w,P,me,O,B,ae,se,de,A,R,N,xe,fe,he,L,be,$,z,U,V,G,j],styles:[".mat-mdc-dialog-container .mdc-dialog__surface{border-radius:0!important}"]})};var dt=a=>({item:a}),pt=(a,e)=>e.id;function ct(a,e){if(a&1&&(i(0,"span",3),r(1),n()),a&2){let t=u();l(),g(" Toutes les directions (",t.allUDepartments.length,") ")}}function ut(a,e){a&1&&(i(0,"mat-button-toggle-group",12)(1,"mat-button-toggle",17)(2,"span"),r(3,"Affichage Grille"),n(),i(4,"mat-icon",18),r(5,"view_list"),n()(),i(6,"mat-button-toggle",19)(7,"span"),r(8,"Affichage tableau"),n(),i(9,"mat-icon",18),r(10,"view_module"),n()()())}function gt(a,e){a&1&&(i(0,"div",13),p(1,"mat-spinner"),n())}function ft(a,e){if(a&1&&(i(0,"tr")(1,"td",32)(2,"div")(3,"h4",33),r(4),n()()(),i(5,"td",32)(6,"div")(7,"h2",34),r(8),n()()(),i(9,"td",35),r(10),n(),i(11,"td",35),r(12),n(),i(13,"td",32)(14,"button",36)(15,"mat-icon"),r(16,"more_vert"),n()()()()),a&2){let t=e.$implicit,o=e.$index;u(2);let m=Z(22);l(4),ee(o+1),l(4),g(" ",t.designation," "),l(2),g(" ",t.acronym," "),l(2),g(" ",t.director?t.director.full_name:"Aucun directeur"," "),l(2),x("matMenuTriggerFor",m)("matMenuTriggerData",te(6,dt,t))}}function ht(a,e){a&1&&p(0,"mat-progress-bar",31)}function xt(a,e){if(a&1&&(i(0,"div",20)(1,"div",21)(2,"div",22)(3,"div",23)(4,"table",24)(5,"thead",25)(6,"tr")(7,"th",26),r(8," N\xB0 "),n(),i(9,"th",27),r(10," D\xE9signation "),n(),i(11,"th",27),r(12," Acronyme "),n(),i(13,"th",27),r(14," Directeur "),n(),i(15,"th",28)(16,"span",29),r(17,"Edit"),n()()()(),i(18,"tbody",30),J(19,ft,17,8,"tr",null,pt),n()()()()()(),f(21,ht,1,0,"mat-progress-bar",31)),a&2){let t=u();l(19),Y(t.paginatedDepartments),l(2),h(t.loader?21:-1)}}function bt(a,e){if(a&1){let t=W();i(0,"button",37),c("click",function(){let m=v(t).item,s=u();return S(s.onUpdateDialog(m))}),i(1,"mat-icon"),r(2,"edit"),n(),r(3,"Modifier "),n(),i(4,"button",37),c("click",function(){let m=v(t).item,s=u();return S(s.onAsignDir(m))}),i(5,"mat-icon"),r(6,"person"),n(),i(7,"span"),r(8,"Associer Directeur"),n()(),p(9,"mat-divider"),i(10,"button",38)(11,"mat-icon"),r(12,"delete"),n(),i(13,"span"),r(14,"Supprimer"),n()()}}var je=class a{http=d(q);message=d(H);stateService=d(ye);dialog=d(ke);xSmallOrSmall=ie(()=>this.stateService.XSmallOrSmall());unsubscribe$=new C;loading=!1;allUDepartments=[];filteredDepartments=[];paginatedDepartments=[];totalLength=0;currentPage=0;pageSizeOptions=[6,10,15,20];pageSize=this.pageSizeOptions[0];searchKeyword=new _("");roles=De;user;loader=!1;constructor(){this.stateService.setHeader(new Ce("GESTION DES DIRECTIONS","Liste des toutes les directions","event_seat"))}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){this.onGet(),this.setupSearch()}onGet(){this.loading=!0,this.http.url="departments",this.unsubscribe$.next(),this.http.get().pipe(M(this.unsubscribe$)).subscribe({next:e=>{this.allUDepartments=e,this.filteredDepartments=e},error:e=>{this.loading=!1,this.message.openSnackBar(e,"Fermer",800)},complete:()=>{this.loading=!1,this.totalLength=this.filteredDepartments.length,this.updatePaginated()}})}setupSearch(){this.searchKeyword.valueChanges.pipe(M(this.unsubscribe$)).subscribe(e=>{this.applyFilter(e)})}applyFilter(e){let t=e?e.toLowerCase().trim():"";this.filteredDepartments=this.allUDepartments.filter(o=>o.designation.toLowerCase().includes(t)),this.totalLength=this.filteredDepartments.length,this.currentPage=0,this.updatePaginated()}updatePaginated(){let e=this.currentPage*this.pageSize,t=e+this.pageSize;this.paginatedDepartments=this.filteredDepartments.slice(e,t)}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.updatePaginated()}onAddDialog(e){let t=new K;t.disableClose=!0,t.data={title:"Ajouter une direction",department:e,target:"add"},this.dialog.open(D,t).afterClosed().subscribe(m=>{m&&(this.allUDepartments.push(m),this.applyFilter(this.searchKeyword.value))})}onUpdateDialog(e){let t=new K;t.disableClose=!0,t.data={title:"Modifier une direction",department:e,target:"edit"},this.dialog.open(D,t).afterClosed().subscribe(m=>{if(m){let s=this.filteredDepartments.findIndex(Q=>Q.id===m.id);s!==-1&&(this.filteredDepartments[s]=m,this.updatePaginated())}})}onAsignDir(e){let t=new K;t.disableClose=!0,t.data={title:"Rechercher un utilisateur"},t.minWidth=this.xSmallOrSmall()?"96vw":"57vw",this.dialog.open(Ve,t).afterClosed().subscribe(m=>{this.openQuestion(e,m)})}openQuestion(e,t){this.dialog.open(Ge,{data:{message:`Souhaitez-vous vraiment associer  ${t.full_name} comme ${e.designation} ?`,buttonText:{ok:"Oui",cancel:"Non"}}}).afterClosed().subscribe(m=>{m&&(this.loader=!0,this.http.url=`users/${e.id}/dir`,this.http.update({director_id:t.id}).subscribe({next:s=>{},error:()=>{this.loader=!1,this.message.openSnackBar("Une erreur est survenue, veuillez r\xE9essayer.","Fermer",4e3)},complete:()=>{this.loader=!1,this.onGet(),this.message.openSnackBar("Op\xE9ration effectu\xE9e avec succ\xE8s !","Fermer",4e3)}}))})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=y({type:a,selectors:[["app-department-component"]],decls:25,vars:10,consts:[["menu","matMenu"],[1,"flex","items-center","justify-between","md:h-16","md:px-4","border-b","border-b-gray-300","md:border-b-0","py-2","md:py-0",3,"ngClass"],[1,"flex","gap-2"],[1,"text-lg"],["mat-icon-button","","matTooltip","Nouveau courrier",3,"click"],["mat-icon-button","","matTooltip","Imprimer"],[1,"flex","flex-wrap","my-4","md:mt-6"],[1,"w-full","lg:w-4/12"],[1,"relative","w-full"],["type","text","placeholder","Rechercher un courrier par mot cl\xE9",1,"w-full","p-3","pl-5","pr-15","text-lg","border-2","border-gray-300","md:rounded-full","outline-none","transition","duration-300","focus:border-blue-500","focus:text-gray-700","bg-white","h-[45px]","lg:h-[49px]",3,"formControl"],[1,"absolute","right-4","top-1/2","transform","-translate-y-1/2","text-gray-500","text-lg"],[1,"w-full","lg:w-8/12","flex","justify-end","items-center","flex-wrap","mt-3","md:mt-0"],["value","add"],[1,"flex","justify-center"],["yPosition","below",3,"overlapTrigger"],["matMenuContent",""],["showFirstLastButtons","",1,"mt-10",3,"page","length","pageSize","pageSizeOptions","pageIndex"],["matTooltip","Nouveau groupe","value","add","aria-label","Text align center"],["color","primary"],["matTooltip","Liste des proclamateurs","value","print","aria-label","Text align center"],[1,"flex","flex-col","md:mt-6"],[1,"overflow-x-auto"],[1,"inline-block","min-w-full","align-middle"],[1,"overflow-hidden","border-y","border-gray-200","dark:border-gray-700","md:rounded-lg"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-700"],[1,"bg-gray-50","dark:bg-gray-800"],["scope","col",1,"px-4","py-3.5","text-sm","font-normal","text-left","rtl:text-right","text-gray-500","dark:text-gray-400"],["scope","col",1,"px-12","py-3.5","text-sm","font-normal","text-left","rtl:text-right","text-gray-500","dark:text-gray-400"],["scope","col",1,"relative","py-3.5","px-4"],[1,"sr-only"],[1,"bg-white","divide-y","divide-gray-200","dark:divide-gray-700","dark:bg-gray-900"],["mode","indeterminate"],[1,"px-4","py-2.5","text-sm","whitespace-nowrap"],[1,"text-gray-700","dark:text-gray-200"],[1,"text-gray-800","dark:text-white"],[1,"px-12","py-2.5","text-sm","whitespace-nowrap"],["mat-icon-button","",3,"matMenuTriggerFor","matMenuTriggerData"],["mat-menu-item","",3,"click"],["mat-menu-item",""]],template:function(t,o){if(t&1){let m=W();i(0,"section",1)(1,"div",2),p(2,"app-back-component"),n(),f(3,ct,2,1,"span",3),i(4,"div")(5,"button",4),c("click",function(){return v(m),S(o.onAddDialog())}),i(6,"mat-icon"),r(7,"add"),n()(),i(8,"button",5)(9,"mat-icon"),r(10,"print"),n()()()(),i(11,"section",6)(12,"div",7)(13,"div",8),p(14,"input",9),i(15,"mat-icon",10),r(16,"search"),n()()(),i(17,"div",11),f(18,ut,11,0,"mat-button-toggle-group",12),n()(),f(19,gt,2,0,"div",13)(20,xt,22,1),i(21,"mat-menu",14,0),X(23,bt,15,0,"ng-template",15),n(),i(24,"mat-paginator",16),c("page",function(Q){return v(m),S(o.onPageChange(Q))}),n()}t&2&&(x("ngClass",o.xSmallOrSmall()?"":"u-bg-header-main"),l(3),h(o.xSmallOrSmall()?-1:3),l(11),x("formControl",o.searchKeyword),l(4),h(o.xSmallOrSmall()?-1:18),l(),h(o.loading?19:20),l(2),x("overlapTrigger",!1),l(3),x("length",o.totalLength)("pageSize",o.pageSize)("pageSizeOptions",o.pageSizeOptions)("pageIndex",o.currentPage))},dependencies:[Oe,Fe,Be,Re,Pe,Ae,Ne,$e,Le,N,R,_e,Se,ze,E,ne,T,k,F,I,w,P,O,B,le,A,ue,pe,ce,ge,L,$,z,Me,U,ve,V,G,j,Ue],encapsulation:2})};export{je as DepartmentComponent};
